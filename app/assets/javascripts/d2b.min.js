/* Copyright Â© 2013-2015 Academic Dashboards, All Rights Reserved. */var d2b=d2b||{};d2b.createNameSpace=function(a){var b=a.split("."),c=d2b;"d2b"===b[0]&&(b=b.slice(1));for(var d=0;d<b.length;d++){var e=b[d];"undefined"==typeof c[e]&&(c[e]={}),c=c[e]}return c},d2b.createNameSpace("d2b.CHARTS"),d2b.createNameSpace("d2b.DASHBOARDS"),d2b.createNameSpace("d2b.UTILS"),d2b.createNameSpace("d2b.UTILS.CHARTPAGE"),d2b.createNameSpace("d2b.UTILS.AXISCHART.TYPES"),d2b.createNameSpace("d2b.SVG"),d2b.createNameSpace("d2b.CONSTANTS"),d2b.CONSTANTS={DEFAULTWIDTH:function(){return 960},DEFAULTHEIGHT:function(){return 540},DEFAULTMARGIN:function(){return{left:0,right:0,top:0,bottom:0}},DEFAULTFORCEDMARGIN:function(){return{left:30,bottom:20,right:30,top:20}},DEFAULTCOLOR:function(){return d3.scale.category10()},DEFAULTEVENTS:function(){return{elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){}}},ANIMATIONLENGTHS:function(){return{normal:500,"short":200,"long":1e3}}},d2b.chartEvents=function(){return{}},d2b.CHARTS.axisChart=function(){var a={};a.width=d2b.CONSTANTS.DEFAULTWIDTH(),a.height=d2b.CONSTANTS.DEFAULTHEIGHT(),a.innerHeight=a.height,a.innerWidth=a.width,a.outerHeight=a.height,a.outerWidth=a.width,a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.generateRequired=!0,a.selection=d3.select("body"),a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={types:[],labels:{}},a.xFormat=function(a){return d3.round(a,2)},a.yFormat=function(a){return d3.round(a,2)},a.events=d2b.UTILS.chartEvents(),a.legend=d2b.UTILS.LEGENDS.legend().active(!0).color(a.color),a.legendOrientation="bottom",a.legendData={data:{items:[]}},a.controls=d2b.UTILS.CONTROLS.controls(),a.rotate=!1,a.controlsData={hideLegend:{label:"Hide Legend",type:"checkbox",visible:!1,enabled:!1},lockYAxis:{label:"Lock Y-Axis",type:"checkbox",visible:!1,enabled:!1,domain:[0,1]},lockXAxis:{label:"Lock X-Axis",type:"checkbox",visible:!1,enabled:!1,domain:[0,1]}};for(type in d2b.UTILS.AXISCHART.TYPES)if(d2b.UTILS.AXISCHART.TYPES[type].tools){var b=d2b.UTILS.AXISCHART.TYPES[type].tools();if(b&&b.controlsData)for(control in b.controlsData)a.controlsData[control]=b.controlsData[control]}a.tooltipLayout=0,a.tooltip=d2b.SVG.tooltip(),a.tooltip.update=function(){a.tooltip.layout(a.rotate||a.axis.x().axis.scale().rangeBand||a.axis.y().axis.scale().rangeBand?0:a.tooltipLayout),a.tooltip.x(a.axis.scale("x")).y(a.axis.scale("y")).start()},a.axis=d2b.SVG.axis(),a.pGraphData={},a.pTypeData={},a.graphs={},a.graphs.planes=["foreground","background"],a.graphs.filterVisible=function(a){return a.p.visible},a.graphs.init=function(){this.planes.forEach(function(b){a.selection.types[b].type.graph=a.selection.types[b].type.selectAll("g.d2b-axis-chart-"+b+"-graph").data(function(b){return b.graphs.filter(a.graphs.filterVisible)},function(a){return a.p.key}),a.selection.types[b].type.graph.enter().append("g").attr("class","d2b-axis-chart-"+b+"-graph").each(function(a){a.p[b]=this}).style("opacity",0),a.selection.types[b].type.graph.transition().duration(a.animationDuration).style("opacity",1),a.selection.types[b].type.graph.exit().transition().duration(a.animationDuration).style("opacity",0).remove()})},a.types={},a.types.planes=["foreground","background","general"],a.types.setProperties=function(){a.currentChartData.types.forEach(function(b){var c=b.graphs.filter(a.graphs.filterVisible),d=d3.selectAll(c.map(function(a){return a.p.background})),e=d3.selectAll(c.map(function(a){return a.p.foreground}));d2b.UTILS.applyProperties.call(b.p.d2bType,b.properties),b.p.d2bType.animationDuration(a.animationDuration).x(a.axis.scale("x").reversed(a.rotate)).y(a.axis.scale("y").reversed(a.rotate)).width(a.innerWidth).height(a.innerHeight).color(a.color).tooltipSVG(a.tooltip).xFormat(a.xFormat).yFormat(a.yFormat).general(d3.select(b.p.general)).foreground(e).background(d).data(c)})},a.types.filterVisible=function(b){return b.graphs.filter(a.graphs.filterVisible).length>0},a.types.init=function(){var b={};this.planes.forEach(function(c){a.selection.types[c].type=a.selection.types[c].selectAll("g.d2b-axis-type-"+c).data(a.currentChartData.types.filter(a.types.filterVisible),function(a){return a.type}),b[c]=a.selection.types[c].type.enter().append("g").attr("class",function(a){return"d2b-axis-type-"+c+" d2b-"+a.type}).each(function(a){a.p[c]=this}),a.selection.types[c].type.exit().transition().duration(a.animationDuration).style("opacity",0).remove()}),b.general.each(function(b){b.p.d2bType=d2b.UTILS.AXISCHART.TYPES[b.type](b.type).axisChart(c).controls(a.controlsData),a.events.translateEvents(b.p.d2bType)}),a.graphs.init(),this.setProperties()},a.types.update=function(){a.currentChartData.types.forEach(function(a){a.p.d2bType.update()})},a.axes={},a.axes.update=function(){this.setLabels(),this.setDomain(),a.rotate&&this.rotate(),a.axis.width(a.innerWidth).height(a.innerHeight),a.selection.axes.transition().duration(a.animationDuration).call(a.axis),a.rotate&&this.rotate();var b=a.axis.box();a.forcedMargin.left+=b.padding.left,a.forcedMargin.right+=b.padding.right,a.selection.types.transition().duration(a.animationDuration).attr("transform","translate("+b.padding.left+","+b.padding.top+")"),a.selection.types.tracker.transition().duration(a.animationDuration).attr("width",b.innerWidth).attr("height",b.innerHeight),d2b.UTILS.CHARTS.HELPERS.updateDimensions(a)},a.axes.rotate=function(){var b=a.axis.x().orientation,c=a.axis.x2().orientation,d=a.axis.y().orientation,e=a.axis.y2().orientation;a.axis.x({orientation:d}),a.axis.y({orientation:b}),a.axis.x2({orientation:e}),a.axis.y2({orientation:c});var f=a.axis.x().axis.scale().domain;f(f().reverse())},a.axes.setDomain=function(){var b=[],c=[],d=a.axis.x().axis.scale(),e=a.axis.y().axis.scale();a.currentChartData.types.forEach(function(a){a.p.d2bType.xValues&&(b=b.concat(a.p.d2bType.xValues())),a.p.d2bType.yValues&&(c=c.concat(a.p.d2bType.yValues()))}),d.domain(a.controlsData.lockXAxis.enabled?a.controlsData.lockXAxis.domain:d2b.UTILS.domain(b,d,a.xPadding)),e.domain(a.controlsData.lockYAxis.enabled?a.controlsData.lockYAxis.domain:d2b.UTILS.domain(c,e,a.yPadding))},a.axes.setLabels=function(){a.axis.x({labelOutside:a.currentChartData.labels.x}),a.axis.y({labelOutside:a.currentChartData.labels.y})},a.legend.updateData=function(){a.controlsData.hideLegend.enabled?a.legendData={data:{items:[]}}:a.legendData.data.items=[].concat.apply([],a.currentChartData.types.map(function(a){return a.graphs.filter(function(a){return!a.notInLegend}).map(function(a,b){return a.open=!a.p.visible,a})})),d2b.UTILS.CHARTS.HELPERS.updateLegend(a),!a.legend.computedHeight()||"left"!=a.legendOrientation&&"right"!=a.legendOrientation||(a.forcedMargin[a.legendOrientation]+=10)},a.legend.mouseover=function(b,c){if(c.p.visible){var d=[];d.push(c.p.background),d.push(c.p.foreground),d.push(c.type.p.background),d.push(c.type.p.foreground),d.push(c.type.p.general),d.forEach(function(a){a&&a.parentNode&&a.parentNode.appendChild(a)}),a.selection.types.foreground.type.graph.transition().duration(a.animationDuration/2).style("opacity",.2),a.selection.types.background.type.graph.transition().duration(a.animationDuration/2).style("opacity",.2),d3.select(c.p.background).transition().duration(a.animationDuration/2).style("opacity",1),d3.select(c.p.foreground).transition().duration(a.animationDuration/2).style("opacity",1)}},a.legend.mouseout=function(){a.selection.types.foreground.type.graph.transition().duration(a.animationDuration/2).style("opacity",1),a.selection.types.background.type.graph.transition().duration(a.animationDuration/2).style("opacity",1)},a.legend.click=function(b,d){d.p.visible=!d.p.visible;var e=!0;a.currentChartData.types.forEach(function(a){a.graphs.forEach(function(a){e===!0&&a.p.visible&&(e=!1)})}),e&&a.legend.resetHidden(),c.update()},a.legend.dblClick=function(b,d){a.currentChartData.types.forEach(function(a){a.graphs.forEach(function(a){a.p.visible=a.p.key===d.p.key})}),c.update()},a.legend.resetHidden=function(){a.currentChartData.types.forEach(function(a){a.graphs.forEach(function(a){a.p.visible=!0})})},a.transformTypesContainers=function(){a.rotate?(a.selection.types.background.transition().duration(a.animationDuration).attr("transform","translate("+a.innerWidth+", 0),rotate(90)"),a.selection.types.foreground.transition().duration(a.animationDuration).attr("transform","translate("+a.innerWidth+", 0),rotate(90)")):(a.selection.types.background.transition().duration(a.animationDuration).attr("transform",""),a.selection.types.foreground.transition().duration(a.animationDuration).attr("transform",""))},a.initMargin=function(){a.padding?a.forcedMargin={top:d2b.UTILS.visualLength(a.padding.top,a.height),bottom:d2b.UTILS.visualLength(a.padding.bottom,a.height),left:d2b.UTILS.visualLength(a.padding.left,a.width),right:d2b.UTILS.visualLength(a.padding.right,a.width)}:a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN()};var c={};return c.select=d2b.UTILS.CHARTS.MEMBERS.select(c,a,function(){a.generateRequired=!0}),c.selection=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"selection",function(){a.generateRequired=!0}),c.width=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"width"),c.height=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"height"),c.tooltipLayout=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"tooltipLayout"),c.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"animationDuration",function(){a.legend.animationDuration(a.animationDuration),a.controls.animationDuration(a.animationDuration);for(type in a.pTypeData)a.pTypeData[type].d2bType&&a.pTypeData[type].d2bType.animationDuration(a.animationDuration)}),c.legendOrientation=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"legendOrientation"),c.axis=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"axis"),c.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(c,a,"xFormat"),c.yFormat=d2b.UTILS.CHARTS.MEMBERS.format(c,a,"yFormat"),c.pGraphData=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"persistentChartData"),c.padding=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"padding"),c.xPadding=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"xPadding"),c.yPadding=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"yPadding"),c.controls=d2b.UTILS.CHARTS.MEMBERS.controls(c,a),c.on=d2b.UTILS.CHARTS.MEMBERS.events(c,a),c.color=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"color",function(){a.legend.color(a.color)}),c.rotate=function(b){return a.rotate=b,c},c.data=function(b){return arguments.length?(a.currentChartData.types=b.data.types||a.currentChartData.types,a.currentChartData.labels=b.data.labels||a.currentChartData.labels,a.currentChartData.types.forEach(function(b){b.p=a.pTypeData[b.type]=a.pTypeData[b.type]||{key:b.type},b.graphs.forEach(function(c){var d;c.key=c.key||c.label,c.type=b,d=c.type.type+"-"+c.key,c.p=a.pGraphData[d]=a.pGraphData[d]||{key:d,visible:!0},"boolean"==typeof c.visible&&(c.p.visible=c.visible,c.visible=null)})}),c):a.currentChartData},c.generate=function(b){a.generateRequired=!1,d2b.UTILS.CHARTS.HELPERS.generateDefaultSVG(a),a.legend.selection(a.selection.legend),a.controls.selection(a.selection.controls).on("change.d2b-change",function(b,d){a.controlsData[b.key].enabled=b.state,c.update()}),a.selection.main=a.selection.group.append("g").attr("class","d2b-axis-chart"),a.selection.axes=a.selection.main.append("g").attr("class","d2b-axes"),a.selection.types=a.selection.main.append("g").attr("class","d2b-axis-types").call(a.tooltip.tracker),a.selection.types.tracker=a.selection.types.append("rect").style("fill-opacity",0),a.selection.types.background=a.selection.types.append("g").attr("class","d2b-axis-types-background"),a.selection.types.foreground=a.selection.types.append("g").attr("class","d2b-axis-types-foreground"),a.selection.types.general=a.selection.types.append("g").attr("class","d2b-axis-types-general"),a.selection.types.tooltip=a.selection.types.append("g").attr("class","d2b-axis-types-tooltip-area").style("opacity",0).call(a.tooltip.container),a.legend.on("element-mouseover",a.legend.mouseover).on("element-mouseout",a.legend.mouseout).on("element-click",a.legend.click).on("element-dblclick",a.legend.dblClick);var d=a.animationDuration;return c.animationDuration(0).update(b).animationDuration(d)},c.update=function(b){return a.generateRequired?c.generate(b):(a.initMargin(),a.outerWidth=a.width,a.outerHeight=a.height,a.selection.svg.attr("width",a.width).attr("height",a.height),a.selection.group.transition().duration(a.animationDuration).attr("transform","translate("+a.forcedMargin.left+","+a.forcedMargin.top+")"),d2b.UTILS.CHARTS.HELPERS.updateDimensions(a),d2b.UTILS.CHARTS.HELPERS.updateControls(a),a.legend.updateData(),a.selection.main.transition().duration(a.animationDuration).attr("transform","translate("+a.forcedMargin.left+","+a.forcedMargin.top+")"),d2b.UTILS.CHARTS.HELPERS.updateDimensions(a),a.tooltip.reset(),a.types.init(),a.axes.update(),a.types.update(),a.tooltip.update(),a.transformTypesContainers(),d3.timer.flush(),a.events.dispatch("update",a.selection),b&&b(),c)},c},d2b.CHARTS.bubbleChart=function(){var a={};a.width=d2b.CONSTANTS.DEFAULTWIDTH(),a.height=d2b.CONSTANTS.DEFAULTHEIGHT(),a.svgHeight=a.height-55,a.innerHeight=a.height,a.innerWidth=a.width,a.generateRequired=!0,a.selection=d3.select("body"),a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.legend=new d2b.UTILS.LEGENDS.legend,a.controls=new d2b.UTILS.CONTROLS.controls,a.legendOrientation="right",a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={},a.xFormat=function(a){return a},a.current={grouping:null,colorGrouping:null},a.changeLegendWidth=250,a.bubbleRadius=d3.scale.linear(),a.colorChange=d3.scale.threshold().domain([-.25,-.05,-.001,.001,.05,.25]).range(["#d84b2a","#ee9586","#e4b7b2","#888","#beccae","#9caf84","#7aa25c"]),a.changeScaleLegend=d3.scale.ordinal().domain([-1,-.25,-.05,0,.05,.25,1]).rangeBands([0,a.changeLegendWidth]),a.changeScaleAxis=d3.scale.linear().domain([-.25,.25]),a.changeGroupsScale=d3.scale.ordinal(),a.groupsScales={x:d3.scale.ordinal(),y:d3.scale.ordinal(),fontSize:d3.scale.linear().range([10,30]).domain([0,500])},a.formatPercent=d3.format("%"),a.bubbleChange=function(b){var c="";return isNaN(b.change)||(b.change>=0?c="(+"+a.formatPercent(b.change)+")":b.change<0&&(c="("+a.formatPercent(b.change)+")")),a.xFormat(b.value)+" "+c},a.tooltip=function(b){return"<b>"+b.label+":</b> "+a.bubbleChange(b)},a.longestGroupsTick=0,changeAxis=d3.svg.axis().orient("top").tickFormat(function(b){if(b>.25||-.25>b)return"";if(a.controlsData.sortByChange.enabled){if(.25==b)return a.formatPercent(b)+" or higher";if(b==-.25)return a.formatPercent(b)+" or lower"}return a.formatPercent(b)}),a.groupsAxis=d3.svg.axis().scale(a.changeGroupsScale).orient("left"),a.controlsData={hideLegend:{label:"Hide Legend",type:"checkbox",visible:!1,enabled:!1},sortByChange:{label:"Sort By Change",type:"checkbox",visible:!1,enabled:!1},colorByChange:{label:"Color By Change",type:"checkbox",visible:!1,enabled:!1}},a.events=d2b.UTILS.chartEvents(),a.forceTick=function(a){var b=.095*a.alpha;this.nodeElements.each(function(a,c){a.group&&(a.y+=(a.group.focus.y-a.y)*b,a.x+=(a.group.focus.x-a.x)*b)})},a.updateNodeGrouping=function(b,c){c||(c="grouping"),a.currentChartData.nodes.forEach(function(a,d){a[c]=b})},a.updateNodeGroup=function(b){a.currentChartData.nodes.forEach(function(b,c){b.group=a.current.grouping.groups[b.enrollments[b.grouping.index]]})},a.updateRadiusScale=function(b){a.bubbleRadius.range([0,Math.min(a.innerHeight,a.innerWidth)/4]).domain([0,Math.sqrt(b.total/Math.PI)])},a.radius=function(b){return Math.max(3,a.bubbleRadius(Math.sqrt(b/Math.PI)))},a.updateGroupingButtons=function(){a.selection.buttonsWrapper.buttons.button=a.selection.buttonsWrapper.buttons.selectAll("ul").data(a.currentChartData.groupings,function(a,b){return"unique"==a.key?Math.floor(65536*(1+Math.random())):a.key&&"auto"!=a.key?a.key:a.label});var b=a.selection.buttonsWrapper.buttons.button.enter().append("ul");b.append("li").attr("class","d2b-button").on("click.d2b-click",function(b,d){a.current.grouping=b,a.updateNodeGrouping(b),a.updateNodeGroup(),c.update()}).call(a.events.addElementDispatcher,"main","d2b-bubble-grouping-button"),b.append("li").attr("class","d2b-color-button").on("click.d2b-click",function(b,d){a.current.colorGrouping=b,a.updateNodeGrouping(b,"colorGrouping"),c.update()}).call(a.events.addElementDispatcher,"main","d2b-color-by-grouping-button"),a.selection.buttonsWrapper.buttons.button.exit().transition().duration(a.animationDuration).style("opacity",0).remove(),a.selection.buttonsWrapper.buttons.button.grouping=a.selection.buttonsWrapper.buttons.button.select("li.d2b-button").text(function(a){return a.label}).classed("d2b-selected",function(b,c){return b==a.current.grouping}),a.selection.buttonsWrapper.buttons.button.color=a.selection.buttonsWrapper.buttons.button.select("li.d2b-color-button").html('<i class="fa fa-paint-brush"></i>').classed("d2b-selected",function(b,c){return b==a.current.colorGrouping})},a.updateControls=function(){var b=d2b.UTILS.getValues(a.controlsData).filter(function(a){return a.visible});b.map(function(a){a.data={state:a.enabled,label:a.label,key:a.key}}),a.controls.data(b).width(a.innerWidth).update(),a.selection.controls.transition().duration(a.animationDuration).attr("transform","translate("+(a.forcedMargin.left+a.innerWidth-a.controls.computedWidth())+","+a.forcedMargin.top+")")},a.updateLegend=function(){var b;b=a.controlsData.hideLegend.enabled?{data:{items:[]}}:a.controlsData.colorByChange.enabled?{data:{items:[]}}:a.current.colorGrouping.hideLegend?{data:{items:[]}}:{data:{items:d3.set(a.current.grouping.nodes.map(function(a){return a.enrollments[a.colorGrouping.index]})).values().map(function(b){return"null"==b?{label:"Non-"+a.current.colorGrouping.label}:{label:b}})}},a.innerHeight=a.svgHeight-a.forcedMargin.top-a.forcedMargin.bottom,"right"==a.legendOrientation||"left"==a.legendOrientation?a.legend.orientation("vertical").data(b).height(a.innerHeight).update():a.legend.orientation("horizontal").data(b).width(a.innerWidth).update();var c;c="right"==a.legendOrientation?"translate("+(a.forcedMargin.left+a.innerWidth-a.legend.computedWidth())+","+((a.innerHeight-a.legend.computedHeight())/2+a.forcedMargin.top)+")":"left"==a.legendOrientation?"translate("+a.forcedMargin.left+","+((a.innerHeight-a.legend.computedHeight())/2+a.forcedMargin.top)+")":"top"==a.legendOrientation?"translate("+(a.forcedMargin.left+(a.innerWidth-a.legend.computedWidth())/2)+","+a.forcedMargin.top+")":"translate("+(a.forcedMargin.left+(a.innerWidth-a.legend.computedWidth())/2)+","+(a.innerHeight+a.forcedMargin.top-a.legend.computedHeight())+")",a.selection.legend.transition().duration(a.animationDuration).attr("transform",c)},a.updateViews=function(){(a.controlsData.sortByChange.enabled||a.controlsData.colorByChange.enabled)&&a.selection.changeAxis.transition().duration(a.animationDuration).style("opacity",1),(a.controlsData.sortByChange.enabled||!a.controlsData.colorByChange.enabled)&&a.selection.changeAxis.legend.transition().duration(a.animationDuration).style("opacity",0),a.controlsData.sortByChange.enabled?a.selection.group.groups.transition().duration(a.animationDuration).style("opacity",0):(b(),a.selection.group.groups.transition().duration(a.animationDuration).style("opacity",1)),a.controlsData.colorByChange.enabled?a.selection.buttonsWrapper.buttons.button.color.style("display","none"):a.selection.buttonsWrapper.buttons.button.color.style("display","block"),a.longestGroupsTick=0,a.controlsData.sortByChange.enabled?(a.changeGroupsScale.domain(Object.keys(a.current.grouping.groups)).rangeBands([0,a.innerHeight-60]),a.selection.groupsAxis.call(a.groupsAxis),a.selection.groupsAxis.selectAll(".tick text").each(function(b){a.longestGroupsTick<this.getComputedTextLength()&&(a.longestGroupsTick=this.getComputedTextLength())}),a.groupsAxis.tickSize(-a.innerWidth+a.forcedMargin.left+a.longestGroupsTick),a.selection.groupsAxis.transition().duration(a.animationDuration).call(a.groupsAxis).style("opacity",1).attr("transform","translate("+(a.forcedMargin.left+a.longestGroupsTick-20)+","+(a.forcedMargin.top+60)+")"),a.changeScaleAxis.range([0,a.innerWidth-80-a.longestGroupsTick]),changeAxis.tickSize(-a.innerHeight+30).scale(a.changeScaleAxis),a.selection.changeAxis.transition().duration(a.animationDuration).style("opacity",1).attr("transform","translate("+(a.forcedMargin.left+30+a.longestGroupsTick)+","+(20+a.forcedMargin.top+a.controls.computedHeight())+")"),a.selection.changeAxis.axis.transition().duration(a.animationDuration).call(changeAxis)):a.controlsData.colorByChange.enabled?(a.selection.groupsAxis.transition().duration(a.animationDuration).style("opacity",0),a.selection.changeAxis.legend.transition().delay(a.animationDuration/4).duration(a.animationDuration).style("opacity",1),changeAxis.tickSize(15).scale(a.changeScaleLegend),a.selection.changeAxis.transition().duration(a.animationDuration).style("opacity",1).attr("transform","translate("+(a.width-a.changeLegendWidth-20)+","+(20+a.forcedMargin.top+a.controls.computedHeight())+")"),a.selection.changeAxis.axis.transition().duration(a.animationDuration).call(changeAxis)):(a.selection.changeAxis.transition().duration(a.animationDuration).style("opacity",0),a.selection.groupsAxis.transition().duration(a.animationDuration).style("opacity",0))},a.asyncLoop=function(a,b,c){var d=0,e=!1,f=!1,g={next:function(){return e&&f&&c?c():void(a>d?(d++,b(g)):(e=!0,c&&c()))},iteration:function(){return d-1},"break":function(a){e=!0,f=a}};return g.next(),g},a.updateBubbles=function(){a.selection.group.bubbles.bubble=a.selection.group.bubbles.selectAll("g.d2b-bubble").data(a.current.grouping.nodes.sort(function(a,b){return d3.ascending(b.value,a.value)}),function(a,b){return"unique"==a.key?Math.floor(65536*(1+Math.random())):a.key&&"auto"!=a.key?a.key:a.label});var b=a.selection.group.bubbles.bubble.enter().append("g").attr("class","d2b-bubble").call(d2b.UTILS.bindTooltip,a.tooltip,function(a){return a}).call(a.events.addElementDispatcher,"main","d2b-bubble");b.append("circle").style("fill",function(b){return d2b.UTILS.getColor(a.color,"label",[{label:b.enrollments[b.colorGrouping.index]}])(b)}).style("stroke",function(b){return a.color(b.enrollments[b.colorGrouping.index])}).attr("r",0),a.selection.group.bubbles.bubble.circle=a.selection.group.bubbles.bubble.select("circle");var c=a.selection.group.bubbles.bubble.circle.transition().duration(a.animationDuration).attr("r",function(b){return a.radius(b.value)});if(a.current.groups&&a.current.groups.forEach(function(b){b.nodeElements=a.selection.group.bubbles.bubble.filter(function(c){return c.group==b&&c.enrollments[a.current.grouping.index]})}),a.controlsData.colorByChange.enabled?c.style("fill",function(b){return a.colorChange(b.change)}).style("stroke",function(b){return d3.rgb(a.colorChange(b.change)).darker(1)}):c.style("fill",function(b){return b.enrollments[b.colorGrouping.index]?d2b.UTILS.getColor(a.color,"label",[{label:b.enrollments[b.colorGrouping.index]}])(b):d2b.UTILS.getColor(a.color,"label",[{label:"Non-"+a.current.colorGrouping.label}])(b)}).style("stroke",function(b){return b.enrollments[b.colorGrouping.index]?d3.rgb(a.color(b.enrollments[b.colorGrouping.index])).darker(1):d3.rgb(a.color("Non-"+a.current.colorGrouping.label)).darker(1)}),a.controlsData.sortByChange.enabled){var d=a.changeScaleAxis.range();a.selection.group.bubbles.bubble.transition().duration(1.5*a.animationDuration).each(function(b){b.x=20+Math.min(d[1],Math.max(d[0],a.changeScaleAxis(b.change)))+(a.longestGroupsTick+10)+a.forcedMargin.left,b.y=a.changeGroupsScale(b.enrollments[b.grouping.index])+a.changeGroupsScale.rangeBand()/2+60+a.forcedMargin.top}).attr("transform",function(a,b){return"translate("+a.x+","+a.y+")"})}else a.current.groups.forEach(function(b){b.force.size([a.innerWidth,a.innerHeight]).start(),a.asyncLoop(300,function(a){b.force.alpha()<.025&&a["break"](!0);a.iteration();b.force.tick(),a.next()},function(){b.force.stop(),b.nodeElements.transition().duration(1.5*a.animationDuration).attr("transform",function(a){return"translate("+a.x+","+a.y+")"})})});b.size()&&a.selection.group.bubbles.bubble.size()>b.size()&&a.selection.group.bubbles.bubble.each(function(b){a.selection.group.bubbles.node().appendChild(this)}),a.selection.group.bubbles.bubble.exit().transition().duration(a.animationDuration).style("opacity",0).attr("transform",function(a){return"translate(0,0)"}).remove().select("circle").attr("r",0)};var b=function(){a.current.groups=[];for(key in a.current.grouping.groups)a.current.groups.push(a.current.grouping.groups[key]);var b=a.innerWidth/a.innerHeight,c=Math.min(a.current.groups.length,Math.max(1,Math.round(Math.sqrt(a.current.groups.length)*b))),d=Math.ceil(a.current.groups.length/c);a.selection.group.groups.group=a.selection.group.groups.selectAll("g").data(a.current.groups),a.groupsScales.x.domain(d3.range(0,c)).rangeBands([0,a.innerWidth]),a.groupsScales.y.domain(d3.range(0,d)).rangeBands([0,a.innerHeight-100]);var e=a.selection.group.groups.group.enter().append("g").style("opacity",0);e.append("text").attr("class","d2b-group-title"),e.append("text").attr("class","d2b-group-total"),a.selection.group.groups.group.each(function(b,d){b.total=d3.sum(b.nodes.map(function(a){return a.value})),b.focus={x:a.groupsScales.x(d%c)+a.groupsScales.x.rangeBand()/2,y:a.groupsScales.y(Math.floor(d/c))+100+a.groupsScales.y.rangeBand()/2},b.force||(b.force=d3.layout.force().links([]).gravity(0).friction(.9).charge(function(b){return-Math.pow(a.radius(b.value),2)/9}).nodes(b.nodes).on("tick",a.forceTick.bind(b))),b.force.stop()}).transition().duration(a.animationDuration).attr("transform",function(b,d){return"translate("+(a.groupsScales.x(d%c)+a.groupsScales.x.rangeBand()/2)+","+(a.groupsScales.y(Math.floor(d/c))+100)+")"}).style("opacity",1),a.selection.group.groups.selectAll(".focus").remove();var f=Math.min(30,Math.max(8,a.groupsScales.fontSize((a.innerWidth+a.innerHeight)/a.current.groups.length)));a.selection.group.groups.group.total=a.selection.group.groups.group.select("text.d2b-group-total").text(function(b){return a.xFormat(b.total)}).style("font-size",f+"px"),a.selection.group.groups.group.title=a.selection.group.groups.group.select("text.d2b-group-title").text(function(a){return a.label}).attr("dy",0).attr("y",f).style("font-size",f+"px").call(d2b.UTILS.textWrap,a.groupsScales.x.rangeBand()-10),a.selection.group.groups.group.exit().transition().duration(a.animationDuration).style("opacity",0).remove()},c={};return c.select=d2b.UTILS.CHARTS.MEMBERS.select(c,a,function(){a.generateRequired=!0}),c.selection=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"selection",function(){a.generateRequired=!0}),c.width=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"width"),c.height=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"height",function(){a.svgHeight=a.height-55}),c.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"animationDuration",function(){a.legend.animationDuration(a.animationDuration),a.controls.animationDuration(a.animationDuration)}),c.legendOrientation=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"legendOrientation"),c.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"tooltip"),c.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(c,a,"xFormat"),c.yFormat=d2b.UTILS.CHARTS.MEMBERS.format(c,a,"yFormat"),c.controls=d2b.UTILS.CHARTS.MEMBERS.controls(c,a),c.on=d2b.UTILS.CHARTS.MEMBERS.events(c,a),c.color=d2b.UTILS.CHARTS.MEMBERS.prop(c,a,"color",function(){a.legend.color(a.color)}),c.data=function(b,d){if(!arguments.length)return a.currentChartData;d&&(a.currentChartData={},a.generateRequired=!0),a.currentChartData=b.data,a.currentChartData.nodes=a.currentChartData.nodes.filter(function(a){return a.value>0}),a.currentChartData.groupings.forEach(function(b,c){b.index=c,b.nodes=a.currentChartData.nodes.filter(function(a){return a.enrollments[c]}),b.groups={},b.total=0,b.nodes.forEach(function(a){b.total+=a.value,b.groups[a.enrollments[c]]||(b.groups[a.enrollments[c]]={nodes:[],label:a.enrollments[c]}),b.groups[a.enrollments[c]].nodes.push(a)})});var e=a.current.grouping;return a.current.grouping=a.currentChartData.groupings[0],e&&a.currentChartData.groupings.forEach(function(b){e.label==b.label&&(a.current.grouping=b)}),a.updateNodeGrouping(a.current.grouping),a.updateNodeGroup(),e=a.current.colorGrouping,a.current.colorGrouping=a.currentChartData.groupings.filter(function(a){return a.default_color_grouping})[0],e?a.currentChartData.groupings.forEach(function(b){e.label==b.label&&(a.current.colorGrouping=b)}):a.current.colorGrouping||(a.current.colorGrouping=a.currentChartData.groupings[0]),a.updateNodeGrouping(a.current.colorGrouping,"colorGrouping"),c},c.generate=function(b){a.generateRequired=!1,a.selection.selectAll("*").remove(),a.selection.buttonsWrapper=a.selection.append("div").attr("class","d2b-bubble-chart-buttons-wrapper"),a.selection.buttonsWrapper.buttons=a.selection.buttonsWrapper.append("ul").attr("class","d2b-buttons"),a.selection.svg=a.selection.append("svg").attr("class","d2b-bubble-chart d2b-svg d2b-container"),a.selection.group=a.selection.svg.append("g"),a.selection.group.bubbles=a.selection.group.append("g").attr("class","d2b-bubbles"),a.selection.changeAxis=a.selection.group.append("g").attr("class","d2b-change-axis-legend"),a.selection.changeAxis.legend=a.selection.changeAxis.append("g"),a.selection.changeAxis.axis=a.selection.changeAxis.append("g"),a.selection.group.groups=a.selection.group.append("g").attr("class","d2b-groups"),a.selection.groupsAxis=a.selection.group.append("g").attr("class","d2b-groups-axis"),a.selection.changeAxis.legend.rect=a.selection.changeAxis.legend.selectAll("rect").data([-.25,-.05,0,.05,.25,1]),a.selection.changeAxis.legend.rect.enter().append("rect").style("fill",function(b){return a.colorChange(b-.01)}).attr("x",function(b){return a.changeScaleLegend(b)-a.changeScaleLegend.rangeBand()/2}).attr("width",a.changeScaleLegend.rangeBand()).attr("height",10).attr("y",-15),a.selection.legend=a.selection.group.append("g").attr("class","d2b-legend"),a.selection.controls=a.selection.group.append("g").attr("class","d2b-controls"),a.controls.selection(a.selection.controls).on("change",function(b,d){a.controlsData[b.key].enabled=b.state,("sort"==b.key||"hideLegend"==b.key)&&(newData=!0),c.update()}),a.legend.color(a.color).selection(a.selection.legend);var d=a.animationDuration;return c.animationDuration(0).update(b).animationDuration(d),c},c.update=function(b){return a.generateRequired?c.generate(b):(a.selection.svg.attr("width",a.width).attr("height",a.svgHeight),a.updateGroupingButtons(),a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.innerWidth=a.width-a.forcedMargin.right-a.forcedMargin.left,a.updateControls(),a.forcedMargin.top+=a.controls.computedHeight()+10,a.updateLegend(),"right"==a.legendOrientation||"left"==a.legendOrientation?a.forcedMargin[a.legendOrientation]+=a.legend.computedWidth():a.forcedMargin[a.legendOrientation]+=a.legend.computedHeight(),a.innerHeight=a.svgHeight-a.forcedMargin.top-a.forcedMargin.bottom,a.innerWidth=a.width-a.forcedMargin.left-a.forcedMargin.right,a.updateViews(),a.updateRadiusScale(a.current.grouping),a.updateBubbles(),d3.timer.flush(),a.events.dispatch("update",a.selection),b&&b(),c)},c},d2b.CHARTS.factChart=function(){var a={};a.width=d2b.CONSTANTS.DEFAULTWIDTH(),a.height=d2b.CONSTANTS.DEFAULTHEIGHT(),a.innerHeight=a.height,a.innerWidth=a.width,a.outerHeight=a.height,a.outerWidth=a.width,a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.generateRequired=!0,a.selection=d3.select("body"),a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={},a.xFormat=function(a){return a},a.events=d2b.UTILS.chartEvents(),a.selectedFact=null,a.x=d3.scale.ordinal(),a.y=d3.scale.ordinal(),a.textScale=d3.scale.linear().range([15,30]).domain([100,1e3]),a.textScale.custom=function(a){var b=this.range(),c=this(a);return c<b[0]?b[0]:c>b[1]?b[1]:c},a.updateFact=function(b,c){b.select("text.d2b-fact-label").style("font-size",c+"px").text(function(a){
return a.label}).each(function(a){a.labelWidth=this.getComputedTextLength()}).transition().duration(a.animationDuration).attr("y",-.5*c);var d=3;b.select("rect").transition().duration(a.animationDuration).attr("width",function(a){return a.labelWidth}).attr("height",d).attr("x",function(a){return-a.labelWidth/2}).attr("y",-d/2).style("fill","#ccc"),b.select("text.d2b-fact-value").style("font-size",2*c+"px").text(function(b){return a.xFormat(b.value)}).transition().duration(a.animationDuration).attr("y",2*c)},a.showMainFacts=function(){a.selection.subFacts.style("pointer-events","none").selectAll("*").transition().duration(a.animationDuration).style("opacity",0).remove();var c=a.currentChartData.facts.length,d=a.textScale.custom(Math.min(a.innerWidth,a.innerHeight)/c),e=d2b.UTILS.grid(a.innerWidth,a.innerHeight,c);a.x.domain(d3.range(0,e.columns)).rangeBands([0,a.innerWidth]),a.y.domain(d3.range(0,e.rows)).rangeBands([0,a.innerHeight]),a.selection.fact=a.selection.main.selectAll("g.d2b-fact").data(a.currentChartData.facts);var f=a.selection.fact.enter().append("g").attr("class","d2b-fact").call(a.events.addElementDispatcher,"main","d2b-fact");f.append("text").attr("class","d2b-fact-label"),f.append("text").attr("class","d2b-fact-value"),f.append("rect").attr("class","d2b-fact-bar");a.selection.fact.style("pointer-events","all").transition().duration(a.animationDuration).style("opacity",1).attr("transform",function(b,c){return"translate("+(a.x(c%e.columns)+a.x.rangeBand()/2)+","+(a.y(Math.floor(c/e.columns))+a.y.rangeBand()/2)+")"});a.updateFact(a.selection.fact,d),a.selection.fact.exit().transition().duration(a.animationDuration).style("opacity",0).remove(),a.selection.fact.each(function(c){var d=d3.select(this);return!c.subFacts||c.subFacts.length<1?void d.style("cursor","auto").on("mouseover.d2b-mouseover",null).on("mouseout.d2b-mouseout",null).on("click.d2b-click",null):void d.style("cursor","pointer").on("mouseover.d2b-mouseover",function(){d.select("rect").transition().duration(a.animationDuration/2).style("fill","#333")}).on("mouseout.d2b-mouseout",function(){d.select("rect").transition().duration(a.animationDuration/2).style("fill","#ccc")}).on("click.d2b-click",function(){var d=d3.select(this);a.selectedFact?(a.selection.fact.style("pointer-events","all").transition().duration(a.animationDuration).style("opacity",1),a.selectedFact=null):(a.selection.fact.style("pointer-events","none").transition().duration(a.animationDuration).style("opacity",0),d.style("pointer-events","all").transition().duration(a.animationDuration).style("opacity",1),a.selectedFact=d,a.selectedFact.data=c),b.update()})})},a.showSubFacts=function(){var b=a.currentChartData.facts.length,c=a.textScale.custom(Math.min(a.innerWidth,a.innerHeight)/b);a.selectedFact.transition().duration(a.animationDuration).attr("transform","translate("+a.innerWidth/2+","+c+")"),a.updateFact(a.selectedFact,c);var d=3*c;a.forcedMargin.top+=d,a.innerHeight-=a.forcedMargin.top,a.selection.subFacts.style("pointer-events","all").transition().duration(a.animationDuration).style("opacity",1).attr("transform","translate(0,"+d+")");var e=a.selectedFact.data.subFacts.length,f=d2b.UTILS.grid(a.innerWidth,a.innerHeight,e);a.x.domain(d3.range(0,f.columns)).rangeBands([0,a.innerWidth]),a.y.domain(d3.range(0,f.rows)).rangeBands([0,a.innerHeight]),a.selection.subFact=a.selection.subFacts.selectAll("g.d2b-sub-fact").data(a.selectedFact.data.subFacts);var g=a.selection.subFact.enter().append("g").attr("class","d2b-sub-fact").style("opacity",0).attr("transform",function(b,c){return"translate("+a.x(c%f.columns)+","+a.y(Math.floor(c/f.columns))+")"});g.append("g").attr("class","d2b-sub-fact-chart").each(function(b){this.pieChart=new d2b.CHARTS.pieChart,this.pieChart.select(this).color(a.color).donutRatio(.6).controls({hideLegend:{enabled:!0}})}),g.append("text").attr("class","d2b-sub-fact-label"),a.selection.subFact.transition().duration(a.animationDuration).attr("transform",function(b,c){return"translate("+a.x(c%f.columns)+","+a.y(Math.floor(c/f.columns))+")"}).delay(a.animationDuration/1.5).style("opacity",.9),a.selection.subFact.select("g.d2b-sub-fact-chart").each(function(b){a.events.translateEvents(this.pieChart),this.pieChart.animationDuration(a.animationDuration).width(a.x.rangeBand()).height(a.y.rangeBand()).data({data:{values:b.values}}).update()}),a.selection.subFact.select("text.d2b-sub-fact-label").text(function(a){return a.label}).transition().duration(a.animationDuration).attr("x",a.x.rangeBand()/2).attr("y",a.y.rangeBand()/2)};var b={};return b.select=d2b.UTILS.CHARTS.MEMBERS.select(b,a,function(){a.generateRequired=!0}),b.selection=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"selection",function(){a.generateRequired=!0}),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration"),b.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(b,a,"xFormat"),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.color=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"color",function(){a.selection.subFact&&a.selection.subFact.each(function(b){this.pieChart.color(a.color)})}),b.data=function(c,d){return arguments.length?(d&&(a.currentChartData={}),a.currentChartData=c.data,b):a.currentChartData},b.generate=function(c){a.generateRequired=!1,a.selection.selectAll("*").remove(),a.selection.svg=a.selection.append("svg").attr("class","d2b-svg d2b-container"),a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.selection.group=a.selection.svg.append("g").attr("transform","translate("+a.forcedMargin.left+","+a.forcedMargin.top+")"),a.selection.main=a.selection.group.append("g").attr("class","d2b-fact-chart"),a.selection.subFacts=a.selection.main.append("g").attr("class","d2b-sub-facts");var d=a.animationDuration;return b.animationDuration(0).update(c).animationDuration(d),b},b.update=function(c){return a.generateRequired?b.generate(c):(a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.outerWidth=a.width,a.outerHeight=a.height,a.selection.svg.attr("width",a.width).attr("height",a.height),d2b.UTILS.CHARTS.HELPERS.updateDimensions(a),a.selectedFact?a.showSubFacts():a.showMainFacts(),d3.timer.flush(),a.events.dispatch("update",a.selection),c&&c(),b)},b},d2b.CHARTS.funnelChart=function(){var a={};a.width=d2b.CONSTANTS.DEFAULTWIDTH(),a.height=d2b.CONSTANTS.DEFAULTHEIGHT(),a.innerHeight=a.height,a.innerWidth=a.width,a.outerHeight=a.height,a.outerWidth=a.width,a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.generateRequired=!0,a.selection=d3.select("body"),a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={},a.xFormat=function(a){return a},a.events=d2b.UTILS.chartEvents(),a.coneHeight=d3.scale.linear(),a.coneCurve=15,a.heightCoeff=.9,a.funnel=function(){a.coneHeight.range([0,a.innerHeight*a.heightCoeff]).domain([0,d3.sum(a.currentChartData.values,function(a){return a.value})]);var b=a.innerWidth,c=a.innerWidth/4,d=(b-c)/(a.innerHeight*a.heightCoeff),e=b,f=0;return a.currentChartData.values.forEach(function(b){var c=a.coneHeight(b.value),g=e;b.pinched&&(e-=c*d);var h=e,i={start:a.innerWidth/2-g/2,end:a.innerWidth/2+g/2,mid:a.innerWidth/2};b.top="M"+i.start+",0 Q"+i.mid+","+a.coneCurve+" "+i.end+",0 M"+i.end+",0 Q"+i.mid+","+-a.coneCurve+" "+i.start+",0",i={start:a.innerWidth/2-h/2,end:a.innerWidth/2+h/2,mid:a.innerWidth/2},b.bottom="M"+i.start+","+c+" Q"+i.mid+","+(c+a.coneCurve)+" "+i.end+","+c+" M"+i.end+","+c+" Q"+i.mid+","+(c-a.coneCurve)+" "+i.start+","+c,b.center=a.innerWidth/2-g/2+",0 "+(a.innerWidth/2-h/2)+","+c+" "+(a.innerWidth/2+h/2)+","+c+" "+(a.innerWidth/2+g/2)+",0 ",b.y=f,b.height=c,b.width=h,f+=c}),a.currentChartData.values},a.showText=function(b){this.select(".d2b-cone-note-group").style("opacity",0).attr("transform",function(b){return"translate("+a.innerWidth/2+","+b.height+")"}),this.select(".d2b-cone-text-group").style("opacity",1).attr("transform",function(b){return"translate("+a.innerWidth/2+","+(b.height/2+a.coneCurve-15)+")"})},a.showNote=function(b){this.select(".d2b-cone-note-group").style("opacity",1).attr("transform",function(b){return"translate("+a.innerWidth/2+","+(1.5*a.coneCurve+(b.height-b.noteHeight)/2)+")"}),this.select(".d2b-cone-text-group").style("opacity",0).attr("transform",function(b){return"translate("+a.innerWidth/2+",0)"})},a.coneMouseover=function(b){var c=this,d=!1,e=20;a.selection.funnel.cone.each(function(){var b=d3.select(this).transition().duration(2*d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]);this==c?(b.attr("transform",function(a){return"translate(0,"+a.y+")"}).call(a.showNote),d=!0):d?b.attr("transform",function(a){return"translate(0,"+(a.y-e)+")"}):b.attr("transform",function(a){return"translate(0,"+(a.y+e)+")"})})},a.coneMouseout=function(b){a.selection.funnel.cone.transition().duration(2*d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).call(a.showText).attr("transform",function(a){return"translate(0,"+a.y+")"})},a.enterCones=function(){var b=a.selection.funnel.cone.enter().append("g").attr("class","d2b-cone").style("opacity",0).call(a.events.addElementDispatcher,"main","d2b-cone").on("mouseout.d2b-mouseout",a.coneMouseout).on("mouseover.d2b-mouseover",a.coneMouseover);b.append("path").attr("class","d2b-cone-bottom"),b.append("polygon").attr("class","d2b-cone-center"),b.append("path").attr("class","d2b-cone-top");var c=b.append("g").attr("class","d2b-cone-note-group"),d=(c.append("text").attr("class","d2b-cone-note"),b.append("g").attr("class","d2b-cone-text-group")),e=d.append("text").attr("class","d2b-cone-text");e.append("tspan").attr("class","d2b-cone-label"),e.append("tspan").attr("class","d2b-cone-value").attr("x",0).attr("y",20),a.selection.funnel.cone.bottom=a.selection.funnel.cone.select(".d2b-cone-bottom"),a.selection.funnel.cone.top=a.selection.funnel.cone.select(".d2b-cone-top"),a.selection.funnel.cone.center=a.selection.funnel.cone.select(".d2b-cone-center"),a.selection.funnel.cone.textGroup=a.selection.funnel.cone.select(".d2b-cone-text-group"),a.selection.funnel.cone.text=a.selection.funnel.cone.select(".d2b-cone-text"),a.selection.funnel.cone.label=a.selection.funnel.cone.select(".d2b-cone-label"),a.selection.funnel.cone.value=a.selection.funnel.cone.select(".d2b-cone-value"),a.selection.funnel.cone.noteGroup=a.selection.funnel.cone.select(".d2b-cone-note-group"),a.selection.funnel.cone.note=a.selection.funnel.cone.select(".d2b-cone-note"),b.size()&&a.selection.funnel.cone.each(function(){this.parentNode.appendChild(this)})},a.updateCones=function(){a.selection.funnel.transition().duration(a.animationDuration).attr("transform",function(){return"translate(0,"+a.innerHeight*(1-a.heightCoeff)/2+")"});var b=a.selection.funnel.cone.transition().duration(a.animationDuration).attr("transform",function(a){return"translate(0,"+a.y+")"}).style("opacity",1).call(a.showText);a.selection.funnel.cone.note.attr("dy",0).attr("y",0).text(function(a){return a.note}).each(function(a){d3.select(this).call(d2b.UTILS.textWrap,a.width-10),a.noteHeight=this.getBBox().height}),b.select(".d2b-cone-label").text(function(a){return a.label}),b.select(".d2b-cone-value").text(function(b){return a.xFormat(b.value)}),b.select(".d2b-cone-bottom").attr("d",function(a){return a.bottom}).style("fill",function(b){return a.color(b.label)}),b.select(".d2b-cone-center").attr("points",function(a){return a.center}).style("fill",function(b){return a.color(b.label)}),b.select(".d2b-cone-top").attr("d",function(a){return a.top}).style("fill",function(b){return d3.rgb(a.color(b.label)).darker(1.2)})},a.exitCones=function(){a.selection.funnel.cone.exit().transition().duration(a.animationDuration).style("opacity",0).remove()};var b={};return b.select=d2b.UTILS.CHARTS.MEMBERS.select(b,a,function(){a.generateRequired=!0}),b.selection=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"selection",function(){a.generateRequired=!0}),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.coneCurve=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"coneCurve"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration"),b.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(b,a,"xFormat"),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.data=function(c,d){return arguments.length?(d&&(a.currentChartData={}),a.currentChartData=c.data,b):a.currentChartData},b.generate=function(c){a.generateRequired=!1,a.selection.selectAll("*").remove(),a.selection.svg=a.selection.append("svg").attr("class","d2b-svg d2b-container"),a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.selection.group=a.selection.svg.append("g").attr("transform","translate("+a.forcedMargin.left+","+a.forcedMargin.top+")"),a.selection.main=a.selection.group.append("g").attr("class","d2b-funnel-chart"),a.selection.funnel=a.selection.main.append("g").attr("class","d2b-funnel");var d=a.animationDuration;return b.animationDuration(0).update(c).animationDuration(d),b},b.update=function(c){return a.generateRequired?b.generate(c):(a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.outerWidth=a.width,a.outerHeight=a.height,a.selection.svg.attr("width",a.width).attr("height",a.height),d2b.UTILS.CHARTS.HELPERS.updateDimensions(a),a.selection.funnel.cone=a.selection.funnel.selectAll("g.d2b-cone").data(a.funnel(a.currentChartData.values)._reverse(),function(a,b){return"unique"==a.key?Math.floor(65536*(1+Math.random())):a.key&&"auto"!=a.key?a.key:a.label}),a.enterCones(),a.updateCones(),a.exitCones(),d3.timer.flush(),a.events.dispatch("update",a.selection),c&&c(),b)},b},d2b.CHARTS.gaugeChart=function(){var a={};a.width=d2b.CONSTANTS.DEFAULTWIDTH(),a.height=d2b.CONSTANTS.DEFAULTHEIGHT(),a.innerHeight=a.height,a.innerWidth=a.width,a.outerHeight=a.height,a.outerWidth=a.width,a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.generateRequired=!0,a.selection=d3.select("body"),a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={},a.xFormat=function(a){return a},a.events=d2b.UTILS.chartEvents(),a.percentFormat=d2b.UTILS.numberFormat({precision:2,units:{after:"%"}}),a.percent=0,a.arc=d3.svg.arc().startAngle(function(a,b){return a.start}).endAngle(function(a,b){return a.end}).innerRadius(function(a,b){return a.inner}).outerRadius(function(a,b){return a.outer}),a.tooltip=function(b){return null!=b.value?"<b>"+b.label+":</b> "+a.xFormat(b.value)+" ("+100*b.percent+"%)":"<b>"+b.label+":</b> "+100*b.percent+"%"},a.getPercent=function(){return null!=a.currentChartData.percent?a.currentChartData.percent:null!=a.currentChartData.value&&null!=a.currentChartData.total?a.currentChartData.value/a.currentChartData.total:0},a.getData=function(){return[{label:a.currentChartData.label,value:a.currentChartData.value,percent:a.percent,start:-Math.PI/2,end:Math.PI*a.percent-Math.PI/2,color:d2b.UTILS.getColor(a.color,"label")(a.currentChartData),filled:!0},{percent:a.percent,start:Math.PI*a.percent-Math.PI/2,end:Math.PI/2,color:"#ddd",filled:!1}]},a.setNewArc=function(a,b,c){a.each(function(a){this.newArc={start:a.start,end:a.end,inner:b,outer:c}})},a.arcMouseover=function(b){var c=d3.select(this).select("path");c.call(a.setNewArc,a.radius.inner,1.03*a.radius.outer).transition().duration(a.animationDuration/4).call(d2b.UTILS.TWEENS.arcTween,a.arc)},a.arcMouseout=function(b){var c=d3.select(this).select("path");c.call(a.setNewArc,a.radius.inner,a.radius.outer).transition().duration(a.animationDuration/4).call(d2b.UTILS.TWEENS.arcTween,a.arc)};var b={};return b.select=d2b.UTILS.CHARTS.MEMBERS.select(b,a,function(){a.generateRequired=!0}),b.selection=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"selection",function(){a.generateRequired=!0}),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration"),b.color=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"color"),b.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(b,a,"xFormat"),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"tooltip"),b.data=function(c,d){return arguments.length?(d&&(a.currentChartData={}),a.currentChartData=c.data,b):a.currentChartData},b.generate=function(c){a.generateRequired=!1,a.selection.selectAll("*").remove(),a.selection.svg=a.selection.append("svg").attr("class","d2b-template-chart d2b-svg d2b-container"),a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.selection.group=a.selection.svg.append("g"),a.selection.main=a.selection.group.append("g").attr("class","d2b-gauge-chart"),a.selection.arcs=a.selection.main.append("g"),a.selection.arcHeader=a.selection.main.append("text").attr("class","d2b-gauge-arc-header"),a.selection.arcLabels=a.selection.main.append("g").attr("class","d2b-gauge-arc-labels"),a.selection.arcLabels.start=a.selection.arcLabels.append("text").attr("y",20).text("0%"),a.selection.arcLabels.end=a.selection.arcLabels.append("text").attr("y",20).text("100%"),a.selection.arcLabels.percent=a.selection.arcLabels.append("text").attr("class","d2b-gauge-arc-percent").text("0%");var d=a.animationDuration;return b.animationDuration(0).update(c).animationDuration(d),b},b.update=function(c){if(a.generateRequired)return b.generate(c);a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.outerWidth=a.width,a.outerHeight=a.height,a.innerWidth=a.outerWidth-a.forcedMargin.left-a.forcedMargin.right,a.innerHeight=a.outerHeight-a.forcedMargin.top-a.forcedMargin.bottom,a.selection.svg.attr("width",a.width).attr("height",a.height);var d=a.currentChartData.label?20:0,e=20;a.radius={},a.radius.outer=Math.min(2*a.innerHeight-2*d-2*e,a.innerWidth)/2,a.radius.inner=.8*a.radius.outer,a.forcedMargin.top=a.forcedMargin.top+a.innerHeight/2+a.radius.outer/2-e/2+d/2,a.forcedMargin.left=a.forcedMargin.left+a.innerWidth/2,a.selection.group.transition().duration(a.animationDuration).attr("transform","translate("+a.forcedMargin.left+","+a.forcedMargin.top+")"),d2b.UTILS.CHARTS.HELPERS.updateDimensions(a),a.percent=a.getPercent(),a.selection.arcs.arc=a.selection.arcs.selectAll("g").data(a.getData());var f=a.selection.arcs.arc.enter().append("g");return f.append("path").style("fill",function(a){return a.color}),f.filter(function(a){return a.filled}).on("mouseover.d2b-mouseover",a.arcMouseover).on("mouseout.d2b-mouseout",a.arcMouseout).call(a.events.addElementDispatcher,"main","d2b-arc"),a.selection.arcs.arc.filter(function(a){return a.filled}).call(d2b.UTILS.bindTooltip,a.tooltip,function(a){return a}),a.selection.arcs.arc.path=a.selection.arcs.arc.select("path").call(a.setNewArc,a.radius.inner,a.radius.outer).transition().duration(a.animationDuration).call(d2b.UTILS.TWEENS.arcTween,a.arc).style("fill",function(a){return a.color}).attr("class","d2b-arc"),a.selection.arcLabels.percent.transition().duration(a.animationDuration).tween("text",function(b){var c=this;c._current||(c._current=0);var d=d3.interpolate(c._current,a.percent);return function(a){c._current=d(a),c.textContent=d3.format("%")(d(a))}}).attr("font-size",.5*a.radius.inner+"px"),a.selection.arcLabels.start.transition().duration(a.animationDuration).attr("x",-(a.radius.outer-(a.radius.outer-a.radius.inner)/2)),a.selection.arcLabels.end.transition().duration(a.animationDuration).attr("x",a.radius.outer-(a.radius.outer-a.radius.inner)/2),a.selection.arcHeader.text(a.currentChartData.label).transition().duration(a.animationDuration).attr("y",-a.radius.outer-10),d3.timer.flush(),a.events.dispatch("update",a.selection),c&&c(),b},b},d2b.CHARTS.iframeChart=function(){var a={};a.width=d2b.CONSTANTS.DEFAULTWIDTH(),a.height=d2b.CONSTANTS.DEFAULTHEIGHT(),a.generateRequired=!0,a.selection=d3.select("body"),a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={},a.events=d2b.UTILS.chartEvents();var b={};return b.select=d2b.UTILS.CHARTS.MEMBERS.select(b,a,function(){a.generateRequired=!0}),b.selection=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"selection",function(){a.generateRequired=!0}),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration"),b.color=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"color"),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.data=function(c,d){return arguments.length?(d&&(a.currentChartData={}),a.generateRequired=!0,a.currentChartData=c.data,b):a.currentChartData},b.generate=function(c){a.generateRequired=!1,a.selection.selectAll("*").remove(),a.selection.div=a.selection.append("div").attr("class","d2b-iframe-chart d2b-container"),a.selection.div.iframe=a.selection.div.append("iframe").attr("class","d2b-iframe").attr("src",a.currentChartData.url);var d=a.animationDuration;return b.animationDuration(0).update(c).animationDuration(d),b},b.update=function(c){return a.generateRequired?b.generate(c):(a.selection.div.iframe.transition().duration(a.animationDuration).attr("width",a.width).attr("height",a.height),d3.timer.flush(),a.events.dispatch("update",a.selection),c&&c(),b)},b},d2b.CHARTS.mapChart=function(){var a={};a.width=d2b.CONSTANTS.DEFAULTWIDTH(),a.height=d2b.CONSTANTS.DEFAULTHEIGHT(),a.innerHeight=a.height,a.innerWidth=a.width,a.outerHeight=a.height,a.outerWidth=a.width,a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.generateRequired=!0,a.selection=d3.select("body"),a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={},a.xFormat=function(a){return a},a.events=d2b.UTILS.chartEvents(),a.legend=new d2b.UTILS.LEGENDS.legend,a.legendOrientation="bottom",a.legendData={data:{items:[]}},a.controls=new d2b.UTILS.CONTROLS.controls,a.controlsData={hideLegend:{label:"Hide Legend",type:"checkbox",visible:!1,enabled:!1}},a.filterSet={},a.topoPaths=[{key:"countries",file:"countries.topo.json"},{key:"states",file:"states.topo.json"}],a.topoData={},a.filteredTopoData={},a.topoDataReady=!1,a.projection="equirectangular",a.drawCountries=function(b){a.selection.countries.country=a.selection.countries.selectAll("g.d2b-country").data(a.filteredTopoData.countries.features,function(a){return a.properties.GU_A3}),a.selection.countries.country.enter().append("g").attr("class","d2b-country").style("opacity",0).append("path"),a.selection.countries.country.path=a.selection.countries.country.select("path"),a.selection.countries.country.transition().duration(a.animationDuration).style("opacity",1).select("path").attr("d",b).style("fill","black"),a.selection.countries.country.exit().transition().duration(a.animationDuration).style("opacity",0).remove()},a.pathFit=function(b){var c=d3.geo.centroid(b),d=150,e=[a.innerWidth/2,a.innerHeight/2],f=d3.geo[a.projection]().scale(d).translate(e);"albersUsa"!=a.projection&&f.center(c);var g=d3.geo.path().projection(f),h=g.bounds(b),i=d*a.innerWidth/(h[1][0]-h[0][0]),j=d*a.innerHeight/(h[1][1]-h[0][1]),d=j>i?i:j,e=[a.innerWidth-(h[0][0]+h[1][0])/2,a.innerHeight-(h[0][1]+h[1][1])/2];return f.scale(d).translate(e),"albersUsa"!=a.projection&&f.center(c),g=g.projection(f)},a.setTopoData=function(c){a.topoDataReady=!1,d2b.UTILS.load(a.topoPaths,function(d){a.topoData=d,a.filteredTopoData=JSON.parse(JSON.stringify(a.topoData)),a.filteredTopoData.states.objects.states_simplified.geometries=a.topoData.states.objects.states_simplified.geometries.filter(function(b){return Object.keys(a.filterSet.states||{}).map(function(c){return a.filterSet.states[c].split(",").indexOf(b.properties[c])>-1}).concat([!0]).every(function(a){return 1==a})}),a.filteredTopoData.states=topojson.feature(a.filteredTopoData.states,a.filteredTopoData.states.objects.states_simplified),a.filteredTopoData.countries.objects.countries_simplified.geometries=a.topoData.countries.objects.countries_simplified.geometries.filter(function(b){return Object.keys(a.filterSet.countries||{}).map(function(c){return a.filterSet.countries[c].split(",").indexOf(b.properties[c])>-1}).concat([!0]).every(function(a){return 1==a})}),a.filteredTopoData.countries=topojson.feature(a.filteredTopoData.countries,a.filteredTopoData.countries.objects.countries_simplified),a.topoDataReady=!0,a.updateRequired&&(b.update(),a.updateRequired=!1),c&&c()})};var b={};return b.select=d2b.UTILS.CHARTS.MEMBERS.select(b,a,function(){a.generateRequired=!0}),b.selection=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"selection",function(){a.generateRequired=!0}),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.projection=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"projection"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration",function(){a.legend.animationDuration(a.animationDuration),a.controls.animationDuration(a.animationDuration)}),b.legendOrientation=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"legendOrientation"),b.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(b,a,"xFormat"),b.controls=d2b.UTILS.CHARTS.MEMBERS.controls(b,a),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.filter=function(c){return a.filterSet=c,a.setTopoData(),b},b.data=function(c,d){return arguments.length?(d&&(a.currentChartData={}),a.currentChartData=c.data,b):a.currentChartData},b.generate=function(c){return a.generateRequired=!1,d2b.UTILS.CHARTS.HELPERS.generateDefaultSVG(a),a.legend.color(a.color).selection(a.selection.legend),a.controls.selection(a.selection.controls).on("change",function(c,d){a.controlsData[c.key].enabled=c.state,b.update()}),a.selection.main=a.selection.group.append("g").attr("class","d2b-main-chart"),a.selection.countries=a.selection.main.append("g").attr("class","d2b-countries"),a.setTopoData(function(){var d=a.animationDuration;b.animationDuration(0).update(c).animationDuration(d)}),b},b.update=function(c){if(a.generateRequired)return b.generate(c);if(a.topoDataReady){a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.outerWidth=a.width,a.outerHeight=a.height,a.selection.svg.attr("width",a.width).attr("height",a.height),d2b.UTILS.CHARTS.HELPERS.updateDimensions(a),d2b.UTILS.CHARTS.HELPERS.updateControls(a),a.controlsData.hideLegend.enabled?a.legendData={data:{items:[]}}:a.legendData.data.items=[{label:"item 1"},{label:"item 2"},{label:"item 3"},{label:"item 4"},{label:"item 5"},{label:"item 6"}],d2b.UTILS.CHARTS.HELPERS.updateLegend(a);var d=a.pathFit(a.filteredTopoData.countries);a.selection.main.transition().duration(a.animationDuration).attr("transform","translate("+a.forcedMargin.left+","+a.forcedMargin.top+")"),d2b.UTILS.CHARTS.HELPERS.updateDimensions(a),a.drawCountries(d),d3.timer.flush()}else a.updateRequired=!0;return a.events.dispatch("update",a.selection),c&&c(),b},b},d2b.CHARTS.multiChart=function(){var a={};a.width=d2b.CONSTANTS.DEFAULTWIDTH(),a.height=d2b.CONSTANTS.DEFAULTHEIGHT(),a.generateRequired=!0,a.selection=d3.select("body"),a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.currentChartData={},a.current={chart:{}},a.previous={chart:null},a.d2bChart,a.events=d2b.UTILS.chartEvents();var b=function(b,c){a.previous.chart=a.current.chart,a.current.chart=b,f.update()},c=function(){a.selection.buttonsWrapper.buttons.button=a.selection.buttonsWrapper.buttons.selectAll("li").data(a.currentChartData.charts,function(a){return"unique"==a.key?Math.floor(65536*(1+Math.random())):a.key&&"auto"!=a.key?a.key:a.label}),a.selection.buttonsWrapper.buttons.button.enter().append("li").on("click.d2b-click",b),a.selection.buttonsWrapper.buttons.button.text(function(a){return a.label}).classed("d2b-selected",function(b){return b==a.current.chart}),a.selection.buttonsWrapper.buttons.button.exit().remove()},d=function(b){if(a.current.chart.properties)for(key in a.current.chart.properties)b&&b.skip&&b.skip.indexOf(key)>-1||"data"!=key&&(a.current.chart.properties[key].args?a.d2bChart[key].apply(this,a.current.chart.properties[key].args):a.d2bChart[key](a.current.chart.properties[key]));a.events.translateEvents(a.d2bChart)},e=function(){a.selection.chartWrapper.chart?a.current.chart!=a.previous.chart&&(a.current.chart.type==a.previous.chart.type?(a.d2bChart.data(a.current.chart.properties.data),d({skip:["controls"]})):(a.selection.chartWrapper.chart.transition().duration(a.animationDuration).style("opacity",0).remove(),a.selection.chartWrapper.chart=a.selection.chartWrapper.append("div").attr("class","d2b-multi-chart-chart").style("opacity",0),a.d2bChart=a.current.chart.chart,a.d2bChart.selection(a.selection.chartWrapper.chart).data(JSON.parse(JSON.stringify(a.current.chart.data))),a.selection.chartWrapper.chart.transition().duration(a.animationDuration).style("opacity",1),d())):(a.selection.chartWrapper.chart=a.selection.chartWrapper.append("div").attr("class","d2b-multi-chart-chart").style("opacity",1),a.d2bChart=a.current.chart.chart,a.d2bChart.data(a.current.chart.properties.data).selection(a.selection.chartWrapper.chart),d()),a.d2bChart.width(a.innerWidth).height(a.innerHeight).update(),a.previous.chart=a.current.chart},f={};return f.select=d2b.UTILS.CHARTS.MEMBERS.select(f,a,function(){a.generateRequired=!0}),f.selection=d2b.UTILS.CHARTS.MEMBERS.prop(f,a,"selection",function(){a.generateRequired=!0}),f.width=d2b.UTILS.CHARTS.MEMBERS.prop(f,a,"width"),f.height=d2b.UTILS.CHARTS.MEMBERS.prop(f,a,"height"),f.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(f,a,"animationDuration"),f.on=d2b.UTILS.CHARTS.MEMBERS.events(f,a),f.data=function(b,c){if(!arguments.length)return a.currentChartData;c&&(a.currentChartData={});var d=!0;if(a.current.chart.key){var e=b.data.charts.filter(function(b){return a.current.chart.key==b.key})[0];e&&(d=!1,a.current.chart=e)}return d&&(a.current.chart=b.data.charts[0]),a.currentChartData=b.data,a.currentChartData.charts.forEach(function(a){a.chart=new d2b.CHARTS[a.type]}),f},f.generate=function(b){a.generateRequired=!1,a.selection.selectAll("*").remove(),a.selection.buttonsWrapper=a.selection.append("div").attr("class","d2b-multi-chart-buttons-wrapper"),a.selection.buttonsWrapper.buttons=a.selection.buttonsWrapper.append("ul").attr("class","d2b-buttons"),a.selection.chartWrapper=a.selection.append("div").attr("class","d2b-multi-chart d2b-container");var c=a.animationDuration;return f.animationDuration(0).update(b).animationDuration(c),f},f.update=function(b){return a.generateRequired?f.generate(b):(a.innerWidth=a.width,a.innerHeight=a.height-50,a.selection.chartWrapper.style("width",a.innerWidth+"px").style("height",a.innerHeight+"px"),c(),e(),d3.timer.flush(),b&&b(),f)},f},d2b.CHARTS.pieChart=function(){var a={};a.width=d2b.CONSTANTS.DEFAULTWIDTH(),a.height=d2b.CONSTANTS.DEFAULTHEIGHT(),a.innerHeight=a.height,a.innerWidth=a.width,a.outerHeight=a.height,a.outerWidth=a.width,a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.generateRequired=!0,a.selection=d3.select("body"),a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={},a.xFormat=function(a){return a},a.events=d2b.UTILS.chartEvents(),a.legend=new d2b.UTILS.LEGENDS.legend,a.legend.active(!0),a.legendOrientation="bottom",a.legendData={data:{items:[]}},a.controls=new d2b.UTILS.CONTROLS.controls,a.controlsData={hideLegend:{label:"Hide Legend",type:"checkbox",visible:!1,enabled:!1}},a.tooltipContent=function(b){return"<b>"+b.label+":</b> "+a.xFormat(b.value)+" ("+d3.round(100*b.value/a.pieTotal,1)+"%)"},a.donutRatio=0,a.arc=d3.svg.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,a.start))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,a.end))}).outerRadius(function(a){return Math.max(0,a.outer)}).innerRadius(function(a){return Math.max(0,a.inner)}),a.arcText=d3.svg.arc(),a.pie=d3.layout.pie().value(function(b){var c=a.persistentData.hiddenArcs[b.key]?0:b.value;return a.pieTotal+=c,c}).sort(null),a.pieTotal=1,a.persistentData={focusedArc:null,hiddenArcs:{}},a.arcKey=function(a,b){return"unique"==a.key?Math.floor(65536*(1+Math.random())):a.key&&"auto"!=a.key?a.key:a.label},a.arcEnter=function(){a.r=.93*(Math.min(a.outerWidth,a.outerHeight)/2),a.pieTotal=0,a.selection.pie.datum(a.currentChartData.values),
a.selection.pie.arc=a.selection.pie.selectAll("g").data(a.pie,function(a){return a.data.key});var b=a.selection.pie.arc.enter().append("g").attr("class","d2b-arc").style("opacity",0).call(a.events.addElementDispatcher,"main","d2b-arc");b.append("path").each(function(b){this.oldArc={start:b.startAngle,end:b.startAngle,inner:a.r*a.donutRatio,outer:a.r}}),b.append("text").attr("y",6).each(function(b){this.oldPosition={start:b.startAngle,end:b.startAngle,inner:a.r*a.donutRatio,outer:a.r}})},a.arcUpdate=function(){a.selection.pie.arc.call(d2b.UTILS.bindTooltip,a.tooltipContent,function(a){return a.data},function(b){return d2b.UTILS.getColor(a.color,"label")(b.data)}).transition().duration(a.animationDuration/1.5).style("opacity",1),a.selection.pie.arc.path=a.selection.pie.arc.select("path").each(function(b){this.newArc={start:b.startAngle,end:b.endAngle,inner:a.r*a.donutRatio,outer:b.data.key==a.persistentData.focusedArc?1.04*a.r:a.r}}).on("mouseover.d2b-mouseover",function(c){a.persistentData.focusedArc=c.data.key,b.update()}).on("mouseout.d2b-mouseover",function(c){a.persistentData.focusedArc=null,b.update()}),a.selection.pie.arc.path.transition=a.selection.pie.arc.path.transition().duration(a.animationDuration/1.5).style("opacity",1).style("fill",function(b){return d2b.UTILS.getColor(a.color,"label")(b.data)}).call(d2b.UTILS.TWEENS.arcTween,a.arc),a.selection.pie.arc.text=a.selection.pie.arc.select("text").transition().duration(a.animationDuration/1.5).tween("text",function(b){var c=this;c._current||(c._current=0);var d=d3.interpolate(c._current,b.data.value/a.pieTotal);return function(a){c._current=d(a),c.textContent=d3.format("%")(d(a))}}).style("opacity",function(b){return b.data.value/a.pieTotal<.03||a.persistentData.hiddenArcs[b.data.key]?0:1}).attrTween("transform",function(b){var c=this;c.newPosition={start:b.startAngle,end:b.endAngle,inner:a.r*a.donutRatio,outer:a.r};var d=d3.interpolate(c.oldPosition,c.newPosition);return function(b){return c.oldPosition=d(b),"translate("+a.arc.centroid(c.oldPosition)+")"}})},a.arcExit=function(){a.selection.pie.arc.exit().transition().duration(a.animationDuration).style("opacity",0).remove().select("path").each(function(b){this.newArc={start:b.endAngle,end:b.endAngle,inner:a.r*a.donutRatio,outer:a.r}}).call(d2b.UTILS.TWEENS.arcTween,a.arc)};var b={};return b.select=d2b.UTILS.CHARTS.MEMBERS.select(b,a,function(){a.generateRequired=!0}),b.selection=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"selection",function(){a.generateRequired=!0}),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration",function(){a.legend.animationDuration(a.animationDuration),a.controls.animationDuration(a.animationDuration)}),b.legendOrientation=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"legendOrientation"),b.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(b,a,"xFormat"),b.controls=d2b.UTILS.CHARTS.MEMBERS.controls(b,a),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.color=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"color",function(){a.legend.color(a.color)}),b.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"tooltip"),b.donutRatio=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"donutRatio"),b.data=function(c,d){return arguments.length?(d&&(a.currentChartData={}),a.currentChartData=c.data,a.currentChartData.values.forEach(function(b){b.key=a.arcKey(b)}),b):a.currentChartData},b.generate=function(c){a.generateRequired=!1,d2b.UTILS.CHARTS.HELPERS.generateDefaultSVG(a),a.legend.color(a.color).selection(a.selection.legend).on("element-mouseover.d2b-mouseover",function(c,d){a.persistentData.focusedArc=d.key,b.update()}).on("element-mouseout.d2b-mouseover",function(c,d){a.persistentData.focusedArc=null,b.update()}).on("element-click",function(c,d){a.persistentData.hiddenArcs[d.key]=!a.persistentData.hiddenArcs[d.key];var e=!0;if(a.currentChartData.values.forEach(function(b){1!=e||a.persistentData.hiddenArcs[b.key]||(e=!1)}),e)for(var f in a.persistentData.hiddenArcs)a.persistentData.hiddenArcs[f]=!1;b.update()}).on("element-dblclick",function(c,d){a.currentChartData.values.forEach(function(b){a.persistentData.hiddenArcs[b.key]=b.key!=d.key}),b.update()}),a.controls.selection(a.selection.controls).on("change",function(c,d){a.controlsData[c.key].enabled=c.state,b.update()}),a.selection.pie=a.selection.group.append("g").attr("class","d2b-pie-chart");var d=a.animationDuration;return b.animationDuration(0).update(c).animationDuration(d),b},b.update=function(c){return a.generateRequired?b.generate(c):(a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.outerWidth=a.width,a.outerHeight=a.height,a.selection.svg.attr("width",a.width).attr("height",a.height),d2b.UTILS.CHARTS.HELPERS.updateDimensions(a),d2b.UTILS.CHARTS.HELPERS.updateControls(a),a.controlsData.hideLegend.enabled?a.legendData={data:{items:[]}}:a.legendData={data:{items:a.currentChartData.values.map(function(b){return b.open=a.persistentData.hiddenArcs[b.key],b})}},d2b.UTILS.CHARTS.HELPERS.updateLegend(a),a.selection.pie.transition().duration(a.animationDuration).attr("transform","translate("+(a.forcedMargin.left+a.innerWidth/2)+","+(a.forcedMargin.top+a.innerHeight/2)+")"),d2b.UTILS.CHARTS.HELPERS.updateDimensions(a),a.arcEnter(),a.arcUpdate(),a.arcExit(),d3.timer.flush(),a.events.dispatch("update",a.selection),c&&c(),b)},b},d2b.CHARTS.sankeyChart=function(){var a={};a.width=d2b.CONSTANTS.DEFAULTWIDTH(),a.height=d2b.CONSTANTS.DEFAULTHEIGHT(),a.innerHeight=a.height,a.innerWidth=a.width,a.generateRequired=!0,a.selection=d3.select("body"),a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.legend=new d2b.UTILS.LEGENDS.legend,a.controls=new d2b.UTILS.CONTROLS.controls,a.legendOrientation="bottom",a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.events=d2b.UTILS.chartEvents(),a.currentChartData={nodes:[],links:[]},a.sankey=d3.sankey(),a.nodePadding=30,a.nodeWidth=15,a.layout=20,a.minLinkWidth=1,a.controlsData={hideLegend:{label:"Hide Legend",type:"checkbox",visible:!1,enabled:!1}},a.xFormat=function(a){return a},a.nodeTooltip=function(b){return"<b>"+b.name+" : </b>"+a.xFormat(b.value)},a.linkTooltip=function(b){return"<b>"+b.source.name+' <i class="fa fa-arrow-right"></i> '+b.target.name+": </b>"+a.xFormat(b.value)};var b={};return b.select=d2b.UTILS.CHARTS.MEMBERS.select(b,a,function(){a.generateRequired=!0}),b.selection=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"selection",function(){a.generateRequired=!0}),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration",function(){a.legend.animationDuration(a.animationDuration),a.controls.animationDuration(a.animationDuration)}),b.legendOrientation=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"legendOrientation"),b.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(b,a,"xFormat"),b.controls=d2b.UTILS.CHARTS.MEMBERS.controls(b,a),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.color=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"color",function(){a.legend.color(a.color)}),b.nodePadding=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"nodePadding"),b.layout=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"layout"),b.minLinkWidth=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"minLinkWidth"),b.nodeTooltip=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"nodeTooltip"),b.linkTooltip=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"linkTooltip"),b.data=function(c,d){return arguments.length?(d&&(a.currentChartData={nodes:[],links:[]},a.generateRequired=!0),c.data.nodes&&(a.currentChartData.nodes=c.data.nodes),c.data.links&&(a.currentChartData.links=c.data.links),c.data.labels&&(a.currentChartData.labels=c.data.labels),c.data.columnHeaders&&(a.currentChartData.columnHeaders=c.data.columnHeaders),b):a.currentChartData},b.generate=function(c){a.generateRequired=!1,a.selection.selectAll("*").remove(),a.selection.svg=a.selection.append("svg").attr("class","d2b-sankey-chart d2b-svg d2b-container"),a.selection.group=a.selection.svg.append("g"),a.selection.group.sankey=a.selection.group.append("g").attr("class","d2b-sankey"),a.selection.group.sankey.links=a.selection.group.sankey.append("g").attr("class","d2b-sankey-links"),a.selection.group.sankey.nodes=a.selection.group.sankey.append("g").attr("class","d2b-sankey-nodes"),a.selection.group.labels=a.selection.group.append("g").attr("class","d2b-sankey-labels"),a.selection.group.labels.source=a.selection.group.labels.append("g").attr("class","d2b-sankey-label-source"),a.selection.group.labels.source.text=a.selection.group.labels.source.append("text").attr("y",23),a.selection.group.labels.destination=a.selection.group.labels.append("g").attr("class","d2b-sankey-label-destination"),a.selection.group.labels.destination.text=a.selection.group.labels.destination.append("text").attr("y",23),a.selection.group.columnHeaders=a.selection.group.append("g").attr("class","d2b-sankey-column-headers"),a.selection.controls=a.selection.group.append("g").attr("class","d2b-controls"),a.controls.selection(a.selection.controls).on("change",function(c,d){a.controlsData[c.key].enabled=c.state,("sort"==c.key||"hideLegend"==c.key)&&(newData=!0),b.update()}),a.selection.legend=a.selection.group.append("g").attr("class","d2b-legend"),a.legend.color(a.color).selection(a.selection.legend);var d=a.animationDuration;return b.animationDuration(0).update(c).animationDuration(d),b},b.update=function(c){if(a.generateRequired)return b.generate(c);a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.innerWidth=a.width-a.forcedMargin.right-a.forcedMargin.left,d2b.UTILS.CHARTS.HELPERS.updateControls(a),a.innerHeight=a.height-a.forcedMargin.top-a.forcedMargin.bottom,a.controlsData.hideLegend.enabled?a.legendData={data:{items:[]}}:a.legendData={data:{items:d3.set(a.currentChartData.nodes.map(function(a){return a.colorKey||a.name})).values().map(function(a){return{label:a}})}},d2b.UTILS.CHARTS.HELPERS.updateLegend(a),a.innerHeight=a.height-a.forcedMargin.top-a.forcedMargin.bottom,a.innerWidth=a.width-a.forcedMargin.left-a.forcedMargin.right;var d={source:a.selection.group.labels.source.transition().duration(a.animationDuration),destination:a.selection.group.labels.destination.transition().duration(a.animationDuration)};a.currentChartData.labels?(a.selection.group.labels.transition().duration(a.animationDuration).attr("transform","translate("+a.forcedMargin.left+","+a.forcedMargin.top+")"),a.currentChartData.labels.source?(d.source.style("opacity",1),a.selection.group.labels.source.text.text(a.currentChartData.labels.source)):d.source.style("opacity",0),a.currentChartData.labels.destination?(d.destination.style("opacity",1),a.selection.group.labels.destination.text.text(a.currentChartData.labels.destination)):d.destination.style("opacity",0),d.source.attr("transform","translate(0,0)"),d.destination.attr("transform","translate("+a.innerWidth+",0)"),a.forcedMargin.top+=35):(d.source.style("opacity",0),d.destination.style("opacity",0));var e,f;a.currentChartData.columnHeaders&&a.currentChartData.columnHeaders.length>0&&(f=d3.scale.linear().domain([0,a.currentChartData.columnHeaders.length-1]).range([0,a.innerWidth-a.nodeWidth]),a.selection.group.columnHeaders.transition().duration(a.animationDuration).attr("transform","translate("+a.forcedMargin.left+","+a.forcedMargin.top+")"),e=a.selection.group.columnHeaders.selectAll("g.d2b-sankey-column-header").data(a.currentChartData.columnHeaders),e.enter().append("g").style("opacity",0).attr("transform",function(b,c){return"translate("+(f(c)+a.nodeWidth/2)+",0)"}).attr("class","d2b-sankey-column-header").append("text").attr("y",16).attr("x",function(b,c){return 0==c?-a.nodeWidth/2:c==a.currentChartData.columnHeaders.length-1?a.nodeWidth/2:void 0}),e.select("text").text(function(a){return a}),e.transition().duration(a.animationDuration).style("opacity",1).attr("transform",function(b,c){return"translate("+(f(c)+a.nodeWidth/2)+",0)"}),e.exit().transition().duration(a.animationDuration).style("opacity",0).remove(),a.forcedMargin.top+=25),a.innerHeight=a.height-a.forcedMargin.top-a.forcedMargin.bottom,a.sankey.size([a.innerWidth,a.innerHeight]).nodeWidth(a.nodeWidth).nodePadding(a.nodePadding).nodes(a.currentChartData.nodes).links(a.currentChartData.links).layout(a.layout);var g=a.selection.group.sankey.nodes.selectAll("g.d2b-sankey-node").data(a.currentChartData.nodes.filter(function(a){return a.value}),function(a,b){return"unique"==a.key?Math.floor(65536*(1+Math.random())):a.key&&"auto"!=a.key?a.key:b}),h=g.enter().append("g").attr("class","d2b-sankey-node").attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).style("opacity",0).call(a.events.addElementDispatcher,"main","d2b-sankey-node");h.append("rect"),h.append("text");var i=g.select("text").text(function(a){return a.shortName});g.call(d2b.UTILS.bindTooltip,a.nodeTooltip,function(a){return a}).transition().duration(a.animationDuration).attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).style("opacity",1),g.select("rect").transition().duration(a.animationDuration).attr("width",a.sankey.nodeWidth()).attr("height",function(a){return Math.max(0,a.dy)}),i.transition().duration(a.animationDuration).style("text-anchor",function(b){return b.x<a.innerWidth/2?"start":"end"}).attr("x",function(b){return b.x<a.innerWidth/2?a.sankey.nodeWidth()+5:-5}).attr("y",function(a){return a.dy/2+5});var j=a.selection.group.sankey.links.selectAll("g.d2b-sankey-link").data(a.currentChartData.links.filter(function(a){return a.value}),function(a,b){return"unique"==a.key?Math.floor(65536*(1+Math.random())):a.key&&"auto"!=a.key?a.key:b}),k=j.enter().append("g").attr("class","d2b-sankey-link").style("opacity",0).call(a.events.addElementDispatcher,"main","d2b-sankey-node");return k.append("path"),k.append("text"),j.exit().transition().duration(a.animationDuration).style("opacity",0).remove(),g.exit().transition().duration(a.animationDuration).style("opacity",0).remove(),j.call(d2b.UTILS.bindTooltip,a.linkTooltip,function(a){return a}).transition().duration(a.animationDuration).style("opacity",1),j.select("path").style("stroke",function(b){return b.colorBy?a.color(b[b.colorBy].colorKey?b[b.colorBy].colorKey:b[b.colorBy].name):"#777"}).transition().style("stroke-width",function(b){return Math.max(b.dy,a.minLinkWidth)}).duration(a.animationDuration).attr("d",a.sankey.link()),a.selection.svg.attr("width",a.width).attr("height",a.height),a.selection.group.sankey.transition().duration(a.animationDuration).attr("transform","translate("+a.forcedMargin.left+","+a.forcedMargin.top+")"),d3.timer.flush(),a.events.dispatch("update",a.selection),c&&c(),b},b},d2b.CHARTS.sunburstChart=function(){var a={};a.width=d2b.CONSTANTS.DEFAULTWIDTH(),a.height=d2b.CONSTANTS.DEFAULTHEIGHT(),a.innerHeight=a.height,a.innerWidth=a.width,a.outerHeight=a.height,a.outerWidth=a.width,a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.generateRequired=!0,a.selection=d3.select("body"),a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={data:{partition:{}}},a.xFormat=function(a){return a},a.events=d2b.UTILS.chartEvents(),a.legend=(new d2b.UTILS.LEGENDS.legend).color(a.color),a.legendOrientation="bottom",a.legendData={data:{items:[]}},a.controls=new d2b.UTILS.CONTROLS.controls,a.breadcrumbs=new d2b.UTILS.breadcrumbs,a.breadcrumbs.scale(6),a.partitionData,a.currentRoot,a.newData=!0,a.arc=d3.svg.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,a.start))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,a.end))}).innerRadius(function(a){return Math.max(0,a.inner)}).outerRadius(function(a){return Math.max(0,a.outer)}),a.radius={},a.y={children:d3.scale.pow().exponent(.8),parents:d3.scale.linear()},a.x=d3.scale.linear().range([0,2*Math.PI]),a.controlsData={invert:{label:"Invert",type:"checkbox",visible:!1,enabled:!1},sort:{label:"Sort",type:"checkbox",visible:!1,enabled:!1},hideLegend:{label:"Hide Legend",type:"checkbox",visible:!1,enabled:!1}},a.getAncestors=function(a){for(var b=[],c=a;c.parent;)b.unshift(c),c=c.parent;return b.unshift(c),b},a.arcFill=function(b){var c=a.getAncestors(b).reverse();if(b.colorKey)return a.color(b.colorKey);var d=c.length;for(i=0;i<d;i++)if(c[i].top)return d3.rgb(d2b.UTILS.getColor(a.color,"name")(c[i])).brighter(.3*i);return a.color(b.name)},a.arcMouseover=function(b){var c=a.getAncestors(b);a.selection.arcs.arc.filter(function(a){return c.indexOf(a)>=0}).classed("d2b-transparent",!1),a.selection.arcs.arc.filter(function(a){return c.indexOf(a)<0}).classed("d2b-transparent",!0),a.updateBreadcrumbs(c)},a.arcMouseover.children=function(b){a.setSunburstTooltip(b,!0)},a.arcMouseover.parents=function(b){a.setSunburstTooltip(b,!1)},a.sunburstMouseout=function(b){a.resetBreadcrumbs(),a.selection.arcs.arc.classed("d2b-transparent",!1),a.resetSunburstTooltip()},a.resetSunburstTooltip=function(){a.setSunburstTooltip(a.currentRoot,!1)},a.setSunburstTooltip=function(b,c){var d=b.name,e=a.xFormat(b.value);c&&(e+=" / "+d3.format(".2%")(b.value/a.currentRoot.value)),a.selection.tooltip.text.selectAll("*").remove(),a.selection.tooltip.text.append("tspan").text(d),a.selection.tooltip.text.append("tspan").attr("y",30).attr("x",0).text(e)},a.arcClick=function(b){a.currentRoot=b,a.updateArcs()},a.getZoomParentDomain=function(a){var b=a,c=[1,0];do c[0]>b.y&&(c[0]=b.y),c[1]<b.y+b.dy&&(c[1]=b.y+b.dy),b=b.parent;while(b);return c},a.getZoomChildDomain=function(b,c){return c?(c[0]>b.y&&(c[0]=b.y),c[1]<b.y+b.dy&&(c[1]=b.y+b.dy)):c=[1,0],b.children&&b.children.forEach(function(b){return a.getZoomChildDomain(b,c)}),c},a.updateArcs=function(){var b=a.getAncestors(a.currentRoot),c={};c.parents=a.selection.arcs.arc.path.filter(function(a){return b.indexOf(a)>=0}).on("mouseover.updateTooltip",a.arcMouseover.parents),a.x.domain([a.currentRoot.x,a.currentRoot.x+a.currentRoot.dx]),a.y.parents.domain(a.getZoomParentDomain(a.currentRoot)),a.y.children.domain(a.getZoomChildDomain(a.currentRoot));c.parents.each(function(b){this.newArc={start:a.x(b.x),end:a.x(b.x+b.dx),inner:a.y.parents(b.y),outer:a.y.parents(b.y+b.dy)},this.oldArc||(this.oldArc={start:this.newArc.start,end:this.newArc.start,inner:this.newArc.inner,outer:this.newArc.outer})}),c.children=a.selection.arcs.arc.path.filter(function(a){return b.indexOf(a)<0}).on("mouseover.updateTooltip",a.arcMouseover.children),c.children.each(function(b){this.newArc={start:a.x(b.x),end:a.x(b.x+b.dx),inner:a.y.children(b.y),outer:a.y.children(b.y+b.dy)},this.oldArc||(this.oldArc={start:this.newArc.start,end:this.newArc.start,inner:this.newArc.inner,outer:this.newArc.outer})}),a.selection.arcs.arc.exit().transition().duration(1.5*a.animationDuration).style("opacity",0).remove().select("path").each(function(a){this.newArc={start:this.oldArc.start,end:this.oldArc.start,inner:this.oldArc.inner,outer:this.oldArc.outer}}).call(d2b.UTILS.TWEENS.arcTween,a.arc);var d=a.selection.arcs.arc.path.transition().duration(1.5*a.animationDuration).call(d2b.UTILS.TWEENS.arcTween,a.arc);d.each("end",function(a){this.oldArc=this.newArc})},a.setupNewData=function(){var b;a.newData=!1,b=a.controlsData.sort.enabled?d3.layout.partition().value(function(a){return a.size}):d3.layout.partition().value(function(a){return a.size}).sort(function(a,b){return a.index-b.index}),a.partitionData=b.nodes(a.currentChartData.partition);var c=a.partitionData.filter(function(a){return a.top});a.controlsData.hideLegend.enabled?a.legendData={data:{items:[]}}:a.legendData={data:{items:d3.set(c.map(function(a){return a.name})).values().map(function(a){return{label:a}})}}},a.resetBreadcrumbs=function(){var b={data:{items:[]}};a.breadcrumbs.data(b).update()},a.saveIndicies=function(b){var c=0;if(b.children)for(c=0;c<b.children.length;c++)b.children[c].index=c,a.saveIndicies(b.children[c])},a.updateBreadcrumbs=function(b){var c={data:{items:b.map(function(a,b){return{label:a.name,key:b+","+a.name,data:a}})}};a.breadcrumbs.data(c).update();var d=a.breadcrumbs.selection();d.breadcrumb.path.attr("stroke-width",1.5).style("fill-opacity",.2).style("stroke-opacity",.7).style("fill",function(b){return a.arcFill(b.data)}).style("stroke",function(b){return d3.rgb(a.arcFill(b.data)).darker(1)})};var b={};return b.select=d2b.UTILS.CHARTS.MEMBERS.select(b,a,function(){a.generateRequired=!0}),b.selection=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"selection",function(){a.generateRequired=!0}),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration",function(){a.legend.animationDuration(a.animationDuration),a.controls.animationDuration(a.animationDuration)}),b.legendOrientation=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"legendOrientation"),b.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(b,a,"xFormat"),b.controls=d2b.UTILS.CHARTS.MEMBERS.controls(b,a),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.color=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"color",function(){a.legend.color(a.color)}),b.data=function(c,d){return arguments.length?(d&&(a.currentChartData={},a.generateRequired=!0),a.newData=!0,a.currentChartData=c.data,a.saveIndicies(a.currentChartData.partition),a.currentRoot=a.currentChartData.partition,b):a.currentChartData},b.generate=function(c){a.generateRequired=!1,d2b.UTILS.CHARTS.HELPERS.generateDefaultSVG(a),a.selection.main=a.selection.group.append("g").attr("class","d2b-sunburst").on("mouseout.d2b-mouseout",a.sunburstMouseout),a.selection.arcs=a.selection.main.append("g").attr("class","d2b-sunburst-arcs"),a.selection.tooltip=a.selection.main.append("g").attr("class","d2b-sunburst-tooltip"),a.selection.tooltip.text=a.selection.tooltip.append("text"),a.selection.breadcrumbs=a.selection.group.append("g").attr("class","d2b-sunburst-breadcrumbs"),a.controls.selection(a.selection.controls).on("change",function(c,d){a.controlsData[c.key].enabled=c.state,("sort"==c.key||"hideLegend"==c.key)&&(a.newData=!0),b.update()}),a.legend.selection(a.selection.legend),a.breadcrumbs.selection(a.selection.breadcrumbs);var d=a.animationDuration;return b.animationDuration(0).update(c).animationDuration(d),b},b.update=function(c){if(a.generateRequired)return b.generate(c);a.newData&&a.setupNewData(),a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.outerWidth=a.width,a.outerHeight=a.height,a.selection.svg.attr("width",a.width).attr("height",a.height),d2b.UTILS.CHARTS.HELPERS.updateDimensions(a),d2b.UTILS.CHARTS.HELPERS.updateControls(a),a.selection.breadcrumbs.transition().duration(a.animationDuration).attr("transform","translate("+a.forcedMargin.left+",0)"),a.breadcrumbs.width(a.innerWidth).update(),d2b.UTILS.CHARTS.HELPERS.updateLegend(a),a.selection.main.transition().duration(a.animationDuration).attr("transform","translate("+(a.forcedMargin.left+a.innerWidth/2)+","+(a.forcedMargin.top+a.innerHeight/2)+")"),a.radius.outer=Math.min(a.innerWidth,a.innerHeight)/2,a.radius.inner=a.radius.outer/3,a.controlsData.invert.enabled?(a.y.children.range([a.radius.outer-.17*(a.radius.outer-a.radius.inner),a.radius.inner]),a.y.parents.range([a.radius.outer,a.radius.outer-.13*(a.radius.outer-a.radius.inner)])):(a.y.children.range([a.radius.inner+.17*(a.radius.outer-a.radius.inner),a.radius.outer]),a.y.parents.range([a.radius.inner,a.radius.inner+.13*(a.radius.outer-a.radius.inner)])),a.selection.arcs.arc=a.selection.arcs.selectAll("g.d2b-sunburst-arc").data(a.partitionData,function(b,c){return"unique"==b.key?Math.floor(65536*(1+Math.random())):b.key&&"auto"!=b.key?b.key:a.getAncestors(b).map(function(a){return a.name}).join("-")});{var d=a.selection.arcs.arc.enter().append("g").attr("class","d2b-sunburst-arc").style("opacity",0).call(a.events.addElementDispatcher,"main","d2b-arc");d.append("path").on("mouseover.d2b-mouseover",a.arcMouseover)}return a.selection.arcs.arc.transition().duration(a.animationDuration).style("opacity",""),a.selection.arcs.arc.path=a.selection.arcs.arc.select("path").style("fill",a.arcFill),a.selection.arcs.arc.path.on("click.d2b-click",a.arcClick).classed("d2b-pointer-element",!0),a.updateArcs(),a.resetSunburstTooltip(),d3.timer.flush(),a.events.dispatch("update",a.selection),c&&c(),b},b},d2b.CHARTS.tableChart=function(){var a={};a.width=d2b.CONSTANTS.DEFAULTWIDTH(),a.height=d2b.CONSTANTS.DEFAULTHEIGHT(),a.innerHeight=a.height,a.innerWidth=a.width,a.outerHeight=a.height,a.outerWidth=a.width,a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.generateRequired=!0,a.selection=d3.select("body"),a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={},a.xFormat=function(a){return a},a.events=d2b.UTILS.chartEvents(),a.tooltip=function(b){return"<b>"+b.label+"</b>: "+a.xFormat(b.value)},a.selectedRow=null,a.updateSubFacts=function(b,c,d,e,f,g,h){var i=c.selectAll("g.d2b-table-subFact").data(d),j=i.enter().append("g").attr("class","d2b-table-subFact");return j.append("g").attr("class","d2b-table-subFact-chart"),j.append("text").attr("class","d2b-table-subFact-label"),a.updateSubFact(i,e,f,g,h),i.exit().transition().duration(a.animationDuration).style("opacity",0).remove(),i},a.updateSubFact=function(b,c,d,e,f){b.select("text.d2b-table-subFact-label").text(function(a){return a.label}).transition().duration(a.animationDuration).attr("y",-4).attr("x",(c.rangeBand()-d)/2),b.each(function(a){a.x=d3.scale.linear(),a.x.domain([0,d3.sum(a.values,function(a){return a.value})]).range([0,c.rangeBand()-d]);var b=0;a.values.forEach(function(c){c.xPos=b,c.width=a.x(c.value),b+=c.width})});var g=b.select("g").selectAll("g").data(function(a){return a.values}),h=g.enter().append("g").call(a.events.addElementDispatcher,"main","d2b-table-row-sub-fact");h.append("rect"),h.append("text").attr("class","d2b-subFact-value-label");var i=g.call(d2b.UTILS.bindTooltip,a.tooltip,function(a){return a}).transition().duration(a.animationDuration);i.select("rect").attr("x",function(a){return a.xPos}).attr("width",function(a){return a.width}).attr("height",e).style("fill",d2b.UTILS.getColor(a.color,"label")),i.select("text.d2b-subFact-value-label").style("opacity",+f).attr("y",e/2+4).attr("x",function(a){return a.xPos+a.width/2}).text(function(a){return a.label.substring(0,a.width/10)}),g.exit().transition().duration(a.animationDuration).style("opacity",0).remove()},a.showRow=function(){a.selection.table.row=a.selection.table.selectAll("g.d2b-table-row").data(a.currentChartData.rows),a.selection.table.row.select("tspan.d2b-label").text(function(a){return a.label+" "}),a.selection.table.row.select("tspan.d2b-value").text(function(b){return a.xFormat(b.value)}),a.selectedRow.data=a.selectedRow[0][0].__data__,a.forcedMargin.top+=20,a.innerHeight=a.outerHeight-a.forcedMargin.top;var b=a.selectedRow.transition().duration(a.animationDuration).style("opacity",1).attr("transform",function(b,c){return"translate(0,"+a.forcedMargin.top+")"});b.select("rect.d2b-row-border").attr("width",a.innerWidth),b.select("rect.d2b-row-background").attr("height",a.innerHeight);var c=a.selectedRow.select(".d2b-table-subFacts"),d=d3.scale.ordinal();d.domain([0]).rangeBands([0,a.innerWidth]);var e=d3.scale.ordinal();e.domain(d3.range(0,a.selectedRow.data.subFacts.length)).rangeBands([5,a.innerHeight]),a.updateSubFacts(a.selectedRow,c,a.selectedRow.data.subFacts,d,0,e.rangeBand()/2,!0).transition().duration(a.animationDuration).attr("transform",function(a,b){return"translate(0,"+(e(b)+e.rangeBand()/2)+")"})},a.showTable=function(){var c=.03*a.innerWidth,d=a.innerHeight/a.currentChartData.rows.length;a.selection.table.row=a.selection.table.selectAll("g.d2b-table-row").data(a.currentChartData.rows);var e=a.selection.table.row.enter().append("g").call(a.events.addElementDispatcher,"main","d2b-table-row").attr("class","d2b-table-row");e.append("rect").attr("class","d2b-row-background"),e.append("rect").attr("class","d2b-row-border");var f=e.append("text").attr("class","d2b-table-row-label");f.append("tspan").attr("class","d2b-label"),f.append("tspan").attr("class","d2b-value"),e.append("g").attr("class","d2b-table-subFacts");var g=a.selection.table.row.transition().duration(a.animationDuration).style("opacity",1).attr("transform",function(a,b){return"translate(0,"+(b*d+d/2)+")"});g.select("rect.d2b-row-border").attr("width",a.innerWidth).attr("height",1.5).attr("y",5),g.select("rect.d2b-row-background").attr("width",a.innerWidth).attr("height",30).attr("y",-22);var h=0;a.selection.table.row.select("tspan.d2b-label").text(function(a){return a.label+" "}),a.selection.table.row.select("tspan.d2b-value").text(function(b){return a.xFormat(b.value)}),a.selection.table.row.select("text.d2b-table-row-label").each(function(){h=Math.max(this.getComputedTextLength(),h)}),a.selection.table.row.style("pointer-events","all").each(function(b){var d=d3.select(this),e=d3.scale.ordinal(),f=d.select("text.d2b-table-row-label"),g=d.select("g.d2b-table-subFacts");b.subFacts.length>0?(f.transition().duration(a.animationDuration).style("text-anchor","start").attr("x",0),d.style("cursor","pointer")):(f.transition().duration(a.animationDuration).style("text-anchor","middle").attr("x",a.innerWidth/2),d.style("cursor","auto")),e.domain(d3.range(0,b.subFacts.length)).rangeBands([h+c,a.innerWidth+c]),a.updateSubFacts(d,g,b.subFacts,e,c,5,!1).transition().duration(a.animationDuration).attr("transform",function(a,b){return"translate("+e(b)+",-2)"})}).on("click.d2b-click",function(c,d){var e=d3.select(this);a.selectedRow?a.selectedRow=null:c.subFacts.length>0&&(a.selection.table.row.style("pointer-events","none").transition().duration(a.animationDuration).style("opacity",0),e.style("pointer-events","all"),a.selectedRow=e),b.update()})};var b={};return b.select=d2b.UTILS.CHARTS.MEMBERS.select(b,a,function(){a.generateRequired=!0}),b.selection=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"selection",function(){a.generateRequired=!0}),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.color=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"color"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration"),b.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(b,a,"xFormat"),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"tooltip"),b.data=function(c,d){return arguments.length?(d&&(a.currentChartData={}),a.currentChartData=c.data,a.currentChartData.rows.forEach(function(a){a.subFacts=a.subFacts||[]}),b):a.currentChartData},b.generate=function(c){a.generateRequired=!1,a.selection.selectAll("*").remove(),a.selection.svg=a.selection.append("svg").attr("class","d2b-svg d2b-container"),a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.selection.group=a.selection.svg.append("g").attr("transform","translate("+a.forcedMargin.left+","+a.forcedMargin.top+")"),a.selection.main=a.selection.group.append("g").attr("class","d2b-table-chart"),a.selection.table=a.selection.main.append("g").attr("class","d2b-table");var d=a.animationDuration;return b.animationDuration(0).update(c).animationDuration(d),b},b.update=function(c){return a.generateRequired?b.generate(c):(a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.outerWidth=a.width,a.outerHeight=a.height,a.selection.svg.attr("width",a.width).attr("height",a.height),d2b.UTILS.CHARTS.HELPERS.updateDimensions(a),a.selectedRow?a.showRow():a.showTable(),d3.timer.flush(),a.events.dispatch("update",a.selection),c&&c(),b)},b},d2b.CHARTS.templateChart=function(){var a={};a.width=d2b.CONSTANTS.DEFAULTWIDTH(),a.height=d2b.CONSTANTS.DEFAULTHEIGHT(),a.innerHeight=a.height,a.innerWidth=a.width,a.outerHeight=a.height,a.outerWidth=a.width,a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.generateRequired=!0,a.selection=d3.select("body"),a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={},a.xFormat=function(a){return a},a.events=d2b.UTILS.chartEvents(),a.legend=d2b.UTILS.LEGENDS.legend(),a.legendOrientation="bottom",a.legendData={data:{items:[]}},
a.controls=d2b.UTILS.CONTROLS.controls(),a.controlsData={hideLegend:{label:"Hide Legend",type:"checkbox",visible:!1,enabled:!1}};var b={};return b.select=d2b.UTILS.CHARTS.MEMBERS.select(b,a,function(){a.generateRequired=!0}),b.selection=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"selection",function(){a.generateRequired=!0}),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration",function(){a.legend.animationDuration(a.animationDuration),a.controls.animationDuration(a.animationDuration)}),b.legendOrientation=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"legendOrientation"),b.xFormat=d2b.UTILS.CHARTS.MEMBERS.format(b,a,"xFormat"),b.controls=d2b.UTILS.CHARTS.MEMBERS.controls(b,a),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.color=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"color",function(){a.legend.color(a.color)}),b.data=function(c,d){return arguments.length?(d&&(a.currentChartData={}),a.currentChartData=c.data,b):a.currentChartData},b.generate=function(c){a.generateRequired=!1,d2b.UTILS.CHARTS.HELPERS.generateDefaultSVG(a),a.legend.color(a.color).selection(a.selection.legend),a.controls.selection(a.selection.controls).on("change",function(c,d){a.controlsData[c.key].enabled=c.state,b.update()}),a.selection.main=a.selection.group.append("g").attr("class","d2b-main-chart");var d=a.animationDuration;return b.animationDuration(0).update(c).animationDuration(d),b},b.update=function(c){return a.generateRequired?b.generate(c):(a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.outerWidth=a.width,a.outerHeight=a.height,a.selection.svg.attr("width",a.width).attr("height",a.height),d2b.UTILS.CHARTS.HELPERS.updateDimensions(a),d2b.UTILS.CHARTS.HELPERS.updateControls(a),a.controlsData.hideLegend.enabled?a.legendData={data:{items:[]}}:a.legendData.data.items=[{label:"item 1"},{label:"item 2"},{label:"item 3"},{label:"item 4"},{label:"item 5"},{label:"item 6"}],d2b.UTILS.CHARTS.HELPERS.updateLegend(a),a.selection.main.transition().duration(a.animationDuration).attr("transform","translate("+a.forcedMargin.left+","+a.forcedMargin.top+")"),d2b.UTILS.CHARTS.HELPERS.updateDimensions(a),d3.timer.flush(),a.events.dispatch("update",a.selection),c&&c(),b)},b},d2b.DASHBOARDS.dashboard=function(){var a=d2b.CONSTANTS.DEFAULTWIDTH(),b=d2b.CONSTANTS.DEFAULTMARGIN(),c=210,d=a-c,e=!0,f=d3.select("body"),g=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,h=(d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),new d2b.UTILS.dashboardCategory),i=new d2b.UTILS.chartPage,j=new d2b.UTILS.CONTROLS.htmlControls,k={},l=!1,m=!1,n={};n.array=[],n.position=-1,n.pushNew=function(a){n.array=n.array.slice(0,n.position+1),n.position++,n.array.push({category:a.category,section:a.section})};var o={section:{},category:{}},p=!0,q={},r=d2b.CONSTANTS.DEFAULTPALETTE,s=function(a,b,c){a.forEach(function(a,d){a.categoryName=b,a.sectionName=c,a.index=d})},t=function(a,b){a&&a.forEach(function(a){a.sectionName=b,a.pages||(a.pages=[]),s(a.pages,a.name,a.sectionName)})},u=function(a,b,c){b.forEach(function(b){b.key&&(k[b.key]=b),t(b.categories,b.name),b.position=a.concat([{section:b,sectionGroup:c}]),b.sections&&u(a.concat([{section:b,sectionGroup:c}]),b.sections),b.sectionGroups&&v(a.concat([{section:b,sectionGroup:c}]),b.sectionGroups)})},v=function(a,b){b.forEach(function(b){b.sections&&u(a,b.sections,b)})},w=function(a){u([],[a.dashboard.topSection])},x=function(){f.container.header.breadcrumbs.svg.selectAll(".d2b-breadcrumb-sub-section-group-section").transition().duration(g/2).style("opacity",0),f.container.header.breadcrumbs.svg.selectAll(".d2b-breadcrumb").each(function(){this.expanded=!1}),f.container.header.breadcrumbs.svg.style("height","28px")},y=function(){var a=7,b=f.container.header.breadcrumbs.svg.selectAll("g.d2b-breadcrumb").data(o.section.position,function(a){return a.section.name}),c=b.enter().append("g").style("opacity",0).attr("class","d2b-breadcrumb");c.append("path").attr("class","d2b-breadcrumb-background"),c.append("path").attr("class","d2b-breadcrumb-foreground"),c.append("text").text(function(a){return a.section.name}).attr("y",17).attr("x",15),b.each(function(c,d){var e,h=this,i=d3.select(h),j=i.select("text"),k=i.select("path.d2b-breadcrumb-foreground"),l=i.select("path.d2b-breadcrumb-background"),m=j.node().getBBox().width+25;if(i.select("g.d2b-breadcrumb-triangle").remove(),c.section!=o.section?i.classed("d2b-innactive",!1).on("click.d2b-click",function(a){D(a.section)}):i.classed("d2b-innactive",!0).on("click.d2b-click",null),c.sectionGroup){var n=i.selectAll("g.d2b-breadcrumb-sub-section-group-section").data(c.sectionGroup.sections.filter(function(a){return a!=c.section}));h.dyExpanded=0,h.expanded=!1;var p=n.enter().append("g").style("opacity",0).attr("class","d2b-breadcrumb-sub-section-group-section");p.append("path").attr("class","d2b-breadcrumb-background"),p.append("path").attr("class","d2b-breadcrumb-foreground"),p.append("text").attr("y",17).attr("x",15).text(function(a){return a.name}),n.each(function(b){var c=d3.select(this),d=c.select("path.d2b-breadcrumb-foreground"),e=c.select("path.d2b-breadcrumb-background"),f=c.select("text"),g=f.node().getBBox().width+25;d.attr("d","M 0 0 L "+a+" 12.5 L 0 25 L "+g+" 25 L "+(g+a)+" 12.5 L "+g+" 0 L 0 0 Z").attr("transform","translate(4,0)"),e.attr("d","M 0 0 L "+a+" 12.5 L 0 25 L "+g+" 25 L "+(g+a)+" 12.5 L "+g+" 0 L 0 0 Z")}).on("click.d2b-click",function(a){d3.event.stopPropagation(),D(a)}).attr("transform",function(a,b){return"translate(0,"+28*(b+1)+")"}),h.dyExpanded=32*(n.size()+5),m+=15,e=i.append("g").attr("class","d2b-breadcrumb-triangle").on("click.d2b-click",function(){d3.event.stopPropagation(),h.expanded?(n.transition().duration(g/2).style("opacity",0),f.container.header.breadcrumbs.svg.style("height","27px")):(x(),f.container.header.breadcrumbs.svg.style("height",Math.max(25,h.dyExpanded)+"px"),n.transition().duration(g/2).delay(function(a,b){return 20*b}).style("opacity",1)),h.expanded=!h.expanded}),e.append("rect").attr("width",20).attr("height",24).attr("y",.5).attr("transform","translate("+(m-20)+",0)"),e.append("path").attr("d","M 0 0 L 9 0 L 4.5 5 L 0 0 Z").attr("transform","translate("+(m-15)+",11)")}var q=a,r=a;0==d&&(q=0),d+1==b.size()&&(r=0),k.transition().duration(g).attr("transform","translate(4,0)").attr("d","M 0 0 L "+q+" 12.5 L 0 25 L "+m+" 25 L "+(m+r)+" 12.5 L "+m+" 0 L 5 0 Z"),l.transition().duration(g).attr("d","M 0 0 L "+q+" 12.5 L 0 25 L "+m+" 25 L "+(m+r)+" 12.5 L "+m+" 0 L 5 0 Z"),this.dx=m});var d=0;b.transition().duration(g).attr("transform",function(a){var b="translate("+d+",1)";return d+=this.dx+7,b}).style("opacity",1),b.exit().transition().duration(g).style("opacity",0).remove()},z=function(){var a=f.container.header.navigation.categoryTabs.selectAll("li.d2b-category-tab").data(o.section.categories);a.enter().append("li").attr("class","d2b-category-tab").on("click.d2b-click",E),a.text(function(a){return a.name}).each(function(a){a==o.category?d3.select(this).classed("d2b-innactive",!0).on("click.d2b-click",null):d3.select(this).classed("d2b-innactive",!1).on("click.d2b-click",E)}),a.exit().transition().duration(g).style("opacity",0).remove()},A=function(){var a=f.container.sidebar.subSections.selectAll("li.d2b-sub-section").data(o.section.sections);a.enter().append("li").style("opacity",0).attr("class","d2b-sub-section").on("click.d2b-click",D),a.text(function(a){return a.name}).transition().duration(g).style("opacity",1),a.exit().transition().duration(g).style("opacity",0).remove()},B=function(){var a=o.section.sectionGroups.filter(function(a){return a.sections.length>0}),b=f.container.sidebar.subSectionGroups.selectAll("li.d2b-sub-section-group").data(a);b.enter().append("li").style("opacity",0).attr("class","d2b-sub-section-group"),b.transition().duration(g).style("opacity",1),b.text(function(a){return a.name}).each(C),b.exit().transition().duration(g).style("opacity",0).remove()},C=function(a){if(a.sections&&!(a.sections.length<1)){var b=d3.select(this);b.selectAll("*").remove();var c=b.append("ul").datum(a).attr("class","d2b-sub-section-group-sections"),d=c.selectAll("li.d2b-sub-section-group-section").data(function(a){return a.sections});d.enter().append("li").attr("class","d2b-sub-section-group-section"),d.on("click.d2b-click",D),d.text(function(a){return a.name})}},D=function(a){x(),o.section=a,o.section.sections||(o.section.sections=[]),o.section.sectionGroups||(o.section.sectionGroups=[]),o.section.categories||(o.section.categories=[]);var b=a.categories.filter(function(a){return a.name==o.category.name});return E(b.length>0?b[0]:a.categories[0])},E=function(a){return o.category=a,n.pushNew(o),h.animateFrom("right").data({data:o.category}),p=!0,F.update()},F={};return F.select=function(a){return f=d3.select(a),e=!0,F},F.selection=function(a){return arguments.length?(f=a,e=!0,F):f},F.width=function(b){return arguments.length?(a=b,d=a-210,h.width(d),i.width(d),p=!0,F):a},F.margin=function(a){return arguments.length?(a.left&&(b.left=a.left),a.right&&(b.right=a.right),a.top&&(b.top=a.top),a.bottom&&(b.bottom=a.bottom),F):b},F.palette=function(a){return arguments.length?(r=a,F):r},F.animationDuration=function(a){return arguments.length?(g=a,h.animationDuration(g),F):g},F.data=function(a,b){return arguments.length?(b&&(e=!0,q={}),q=a,w(q),F):g},F.generate=function(a){return e=!1,f.selectAll("*").remove(),f.container=f.append("div").attr("class","d2b-dashboard d2b-container"),f.container.header=f.container.append("div").attr("class","d2b-header"),f.container.header.navigation=f.container.header.append("div").attr("class","d2b-navigation"),f.container.header.navigation.home=f.container.header.navigation.append("div").attr("class","d2b-navigation-home"),f.container.header.navigation.home.append("i").attr("class","fa fa-home"),f.container.header.navigation.arrows=f.container.header.navigation.append("div").attr("class","d2b-navigation-arrows"),f.container.header.navigation.arrows.left=f.container.header.navigation.arrows.append("div").attr("id","d2b-left-arrow"),f.container.header.navigation.arrows.right=f.container.header.navigation.arrows.append("div").attr("id","d2b-right-arrow"),f.container.header.navigation.arrows.left.append("i").attr("class","fa fa-chevron-left"),f.container.header.navigation.arrows.right.append("i").attr("class","fa fa-chevron-right"),f.container.header.navigation.categoryTabs=f.container.header.navigation.append("ul").attr("class","d2b-category-tabs"),f.container.header.navigation.logo=f.container.header.navigation.append("img").attr("class","d2b-dashboard-logo"),f.container.header.breadcrumbs=f.container.header.append("div").attr("class","d2b-dashboard-breadcrumbs"),f.container.header.breadcrumbs.svg=f.container.header.breadcrumbs.append("svg").attr("class","d2b-dashboard-breadcrumbs-svg"),f.container.sidebar=f.container.append("div").attr("class","d2b-dashboard-sidebar"),f.container.sidebar.sectionNav=f.container.sidebar.append("div").attr("class","d2b-sidebar-section-nav d2b-sidebar-container"),f.container.sidebar.sectionsHeader=f.container.sidebar.sectionNav.append("div").attr("class","d2b-sidebar-header").text("Go To"),f.container.sidebar.subSections=f.container.sidebar.sectionNav.append("ul").attr("class","d2b-sub-sections"),f.container.sidebar.subSectionGroups=f.container.sidebar.sectionNav.append("ul").attr("class","d2b-sub-section-groups"),f.container.sidebar.filters=f.container.sidebar.append("div").attr("class","d2b-sidebar-filters d2b-sidebar-container"),f.container.sidebar.filtersHeader=f.container.sidebar.filters.append("div").attr("class","d2b-sidebar-header").text("Filter By"),j.selection(f.container.sidebar.filters).on("change",function(a){p=!0,F.update()}),f.container.content=f.container.append("div").attr("class","d2b-dashboard-content"),f.container.content.dashboardCategory=f.container.content.append("div").attr("class","d2b-dashboard-category"),h.selection(f.container.content.dashboardCategory).on("page-change.d2b-page-change",function(a,b,c){var d=l;a.controls||(a.controls=[]),a.controls.length>0?(l=!1,f.container.sidebar.filters.style("display","block")):(l=!0,f.container.sidebar.filters.style("display","none")),j.data(a).update(function(){});var e=null;c>b?e="right":b>c&&(e="left"),i.selection(h.chartPageSelection()).data(a).animateFrom(e).update(function(){d!=l&&F.update()}).animateFrom(null)}),D(q.dashboard.topSection),F.update(a),F},F.update=function(b){return e?F.generate(b):(o.section==q.dashboard.topSection?f.container.header.navigation.home.classed("d2b-innactive",!0).on("click.d2b-click",null):f.container.header.navigation.home.classed("d2b-innactive",!1).on("click.d2b-click",function(){D(q.dashboard.topSection)}),n.position+1==n.array.length?f.container.header.navigation.arrows.right.classed("d2b-innactive",!0).on("click.d2b-click",null):f.container.header.navigation.arrows.right.classed("d2b-innactive",!1).on("click.d2b-click",function(){p=!0,n.position++,o={category:n.array[n.position].category,section:n.array[n.position].section},x(),h.animateFrom("right").data({data:o.category}),F.update()}),0==n.position?f.container.header.navigation.arrows.left.classed("d2b-innactive",!0).on("click.d2b-click",null):f.container.header.navigation.arrows.left.classed("d2b-innactive",!1).on("click.d2b-click",function(){p=!0,n.position--,o={category:n.array[n.position].category,section:n.array[n.position].section},x(),h.animateFrom("left").data({data:o.category}),F.update()}),f.container.transition().delay(g).duration(g).style("width",a+"px"),z(),y(),0==o.section.sections.length&&0==o.section.sectionGroups.length?(m=!0,f.container.sidebar.sectionNav.style("display","none")):(m=!1,f.container.sidebar.sectionNav.style("display","block")),A(),B(),c=l&&m?10:210,d=a-c,f.container.content.style("width",d+"px"),f.container.content.transition().duration(g).style("margin-left",c-10+"px"),p&&(p=!1,h.width(d).update().animateFrom(null),i.width(d).update()),d3.timer.flush(),b&&b(),F)},F};var colorbrewer={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},RdGn:{7:["#e71007","#c71007","#a71007","#871007","#888","#1a8850","#1aa850","#1ac850","#1ae850"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],
10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}};d3.sankey=function(){function a(){n.forEach(function(a){a.sourceLinks=[],a.targetLinks=[]}),o.forEach(function(a){var b=a.source,c=a.target;"number"==typeof b&&(b=a.source=n[a.source]),"number"==typeof c&&(c=a.target=n[a.target]),b.sourceLinks.push(a),c.targetLinks.push(a)})}function b(){n.forEach(function(a){a.value=Math.max(d3.sum(a.sourceLinks,i),d3.sum(a.targetLinks,i))})}function c(){for(var a,b=n,c=0;b.length;)a=[],b.forEach(function(b){b.x=c,b.dx=k,b.sourceLinks.forEach(function(b){a.indexOf(b.target)<0&&a.push(b.target)})}),b=a,++c;d(c),e((m[0]-k)/(c-1))}function d(a){n.forEach(function(b){b.sourceLinks.length||(b.x=a-1)})}function e(a){n.forEach(function(b){b.x*=a})}function f(a){function b(){var a=d3.min(g,function(a){return(m[1]-(a.length-1)*l)/d3.sum(a,i)});g.forEach(function(b){b.forEach(function(b,c){b.y=c,b.dy=b.value*a})}),o.forEach(function(b){b.dy=b.value*a})}function c(a){function b(a){return h(a.source)*a.value}g.forEach(function(c,d){c.forEach(function(c){if(c.targetLinks.length){var d=d3.sum(c.targetLinks,b)/d3.sum(c.targetLinks,i);c.y+=(d-h(c))*a}})})}function d(a){function b(a){return h(a.target)*a.value}g.slice().reverse().forEach(function(c){c.forEach(function(c){if(c.sourceLinks.length){var d=d3.sum(c.sourceLinks,b)/d3.sum(c.sourceLinks,i);c.y+=(d-h(c))*a}})})}function e(){g.forEach(function(a){var b,c,d,e=0,g=a.length;for(a.sort(f),d=0;g>d;++d)b=a[d],c=e-b.y,c>0&&(b.y+=c),e=b.y+b.dy+l;if(c=e-l-m[1],c>0)for(e=b.y-=c,d=g-2;d>=0;--d)b=a[d],c=b.y+b.dy+l-e,c>0&&(b.y-=c),e=b.y})}function f(a,b){return a.y-b.y}var g=d3.nest().key(function(a){return a.x}).sortKeys(d3.ascending).entries(n).map(function(a){return a.values});b(),e();for(var j=1;a>0;--a)d(j*=.99),e(),c(j),e()}function g(){function a(a,b){return a.source.y-b.source.y}function b(a,b){return a.target.y-b.target.y}n.forEach(function(c){c.sourceLinks.sort(b),c.targetLinks.sort(a)}),n.forEach(function(a){var b=0,c=0;a.sourceLinks.forEach(function(a){a.sy=b,b+=a.dy}),a.targetLinks.forEach(function(a){a.ty=c,c+=a.dy})})}function h(a){return a.y+a.dy/2}function i(a){return a.value}var j={},k=24,l=8,m=[1,1],n=[],o=[];return j.nodeWidth=function(a){return arguments.length?(k=+a,j):k},j.nodePadding=function(a){return arguments.length?(l=+a,j):l},j.nodes=function(a){return arguments.length?(n=a,j):n},j.links=function(a){return arguments.length?(o=a,j):o},j.size=function(a){return arguments.length?(m=a,j):m},j.layout=function(d){return a(),b(),c(),f(d),g(),j},j.relayout=function(){return g(),j},j.link=function(){function a(a){var c=a.source.x+a.source.dx,d=a.target.x,e=d3.interpolateNumber(c,d),f=e(b),g=e(1-b),h=a.source.y+a.sy+a.dy/2,i=a.target.y+a.ty+a.dy/2;return"M"+c+","+h+"C"+f+","+h+" "+g+","+i+" "+d+","+i}var b=.5;return a.curvature=function(c){return arguments.length?(b=+c,a):b},a},j},d2b.MATH={},d2b.MATH.mean=function(a,b,c){var d=0,e=0;return c=d3.functor(c||1),b=d3.functor(b||function(a){return a}),a.filter(function(a){return!isNaN(d2b.number(c(a)))&&!isNaN(d2b.number(b(a)))}).forEach(function(a){var f=c(a),g=b(a);d+=f,e+=g*f}),a.length&&d?e/d:void 0},d2b.MATH.median=function(a,b,c){c=d3.functor(c||1),b=d3.functor(b||function(a){return a});var d,e=[],f=a.filter(function(a){return 0!==c(a)&&!isNaN(d2b.number(c(a)))&&!isNaN(d2b.number(b(a)))}).sort(function(a,c){return d3.ascending(b(a),b(c))});d=Math.round(d3.sum(f,function(a){return c(a)})/2*1e12)/1e12;var g=0,h=!1;return f.forEach(function(a){h&&(e.push(b(a)),h=!1),g+=c(a),g===d&&(e.push(b(a)),h=!0),g>d&&0===e.length&&e.push(b(a))}),a.length?d2b.MATH.mean(e):void 0},d2b.MATH.mode=function(a,b,c){c=d3.functor(c||1),b=d3.functor(b||function(a){return a});var d=[],e=0,f={};return a.forEach(function(a){var g=d2b.number(b(a));isNaN(b(a))||(f[g]=f[g]||0,f[g]+=c(a),f[g]>e?(e=f[b(a)],d=[b(a)]):f[b(a)]==e&&d.push(b(a)))}),a.length?d2b.MATH.mean(d):void 0},d2b.MATH.midpoint=function(a,b){return b=d3.functor(b||function(a){return a}),a.length?d3.mean(d3.extent(a,b)):void 0},d2b.MATH.range=function(a,b){b=d3.functor(b||function(a){return a});var c=d3.extent(a,b);return a.length?c[1]-c[0]:void 0},d2b.MATH.toRadians=function(a){return a*(Math.PI/180)},d2b.MATH.toDegrees=function(a){return a*(180/Math.PI)},d2b.slides=function(){var a=function(){};a.add=function(){},a.remove=function(){},a.next=function(){},a.previous=function(){},a.stop=function(){},a.stop=function(){},a.restart=function(){},a.goTo=function(){}},d2b.SVG.axis=function(){var a={};a.innerTickSize=5,a.padding={top:0,bottom:0,left:0,right:0},a.width=d2b.CONSTANTS.DEFAULTWIDTH(),a.height=d2b.CONSTANTS.DEFAULTHEIGHT(),a.x={key:"x",axis:d3.svg.axis(),orientation:"bottom-outside",hidden:!1,labelOrientation:"outside"},a.y={key:"y",axis:d3.svg.axis(),orientation:"left-outside",hidden:!1,labelOrientation:"outside"},a.x2={key:"x2",axis:d3.svg.axis(),orientation:"top-outside",hidden:!0,labelOrientation:"outside"},a.y2={key:"y2",axis:d3.svg.axis(),orientation:"right-outside",hidden:!0,labelOrientation:"outside"},a.axisKeys=["x","y","x2","y2"],a.events=d2b.UTILS.customEvents(),a.updateScaleRange=function(a,b){a.rangeBand?a.rangeBands(b):a.range(b)},a.getMaxTickBox=function(a){var b=d3.select("body").append("svg").attr("class","d2b-axis").style("opacity",0),c={width:0,height:0};return b.call(a).selectAll(".tick text").each(function(a){var b=this.getBBox();c.width=Math.max(c.width,b.width),c.height=Math.max(c.height,b.height)}),b.remove(),c},a.getLabelHeight=function(a){var b=d3.select("body").append("svg").attr("class","d2b-axis"),c=b.append("text").attr("class","d2b-axis-label "+a).text("Test").style("opacity",0),d=parseInt(window.getComputedStyle(c.node()).fontSize,10);return b.remove(),d},a.initOridinalRanges=function(){a.axisKeys.forEach(function(b){var c=a[b].axis.scale();c.rangeBand&&c.rangeBands([0,1])})},a.initOridinalRanges(),a.updateScale=function(b){var c=b.axis.scale(),d=b.orientation;d=d.split("-");var e=d[0];"right"===e||"left"===e?a.updateScaleRange(c,[a.innerHeight,0]):a.updateScaleRange(c,[0,a.innerWidth])},a.denoteOriginTicks=function(){this.selectAll(".tick text").each(function(a){0===parseFloat(this.textContent)?d3.select(this.parentNode).classed("d2b-origin-tick",!0):d3.select(this.parentNode).classed("d2b-origin-tick",!1)})},a.updateGrid=function(b){var c=d3.transition(d3.select(this)),d=b.axis,e=b.orientation;e=e.split("-");{var f=e[0];d.scale()}"top"===f||"bottom"===f?d.orient("top").tickSize(-a.innerHeight):d.orient("left").tickSize(-a.innerWidth),c.call(d).call(a.denoteOriginTicks).style("opacity",1)},a.updateAxis=function(b){var c=d3.transition(d3.select(this)),d=b.axis,e=a.innerWidth,f=a.innerHeight,g=(d.scale(),"translate(0,0)");d.tickSize(a.innerTickSize);switch(b.orientation){case"left-inside":d.orient("right");break;case"left-outside":d.orient("left");break;case"right-inside":d.orient("left"),g="translate("+e+",0)";break;case"right-outside":d.orient("right"),g="translate("+e+",0)";break;case"top-inside":d.orient("bottom");break;case"top-outside":d.orient("top");break;case"bottom-inside":d.orient("top"),g="translate(0,"+f+")";break;case"bottom-outside":d.orient("bottom"),g="translate(0,"+f+")";break;default:d.orient("bottom"),g="translate(0,"+f+")"}c.call(d).call(a.denoteOriginTicks).style("opacity",1).attr("transform",g)},a.updateLabelInside=function(b){{var c=d3.select(this),d=d3.transition(c),e="",f=a.labelHeightInside;.75*a.labelHeightOutside}switch(b.orientation.split("-")[0]){case"left":e="translate("+f+",5), rotate(-90)";break;case"right":e="translate(-5,5), rotate(-90)";break;case"top":e="translate("+(a.innerWidth-5)+","+f+")";break;case"bottom":e="translate("+(a.innerWidth-5)+",-5)";break;default:e="translate(0,0)"}d.attr("transform",e).text(b.labelInside||"")},a.updateLabelOutside=function(b){var c=d3.select(this),d=d3.transition(c),e="",f=(a.labelHeightInside,.75*a.labelHeightOutside),g=b.orientation.split("-")[0]+"-"+b.labelOrientation;switch(g){case"left-outside":e="translate("+(-a.padding.left+f)+","+a.innerHeight/2+"), rotate(-90)";break;case"right-outside":e="translate("+a.padding.right+","+a.innerHeight/2+"), rotate(-90)";break;case"top-outside":e="translate("+a.innerWidth/2+","+(-a.padding.top+f)+")";break;case"bottom-outside":e="translate("+a.innerWidth/2+","+a.padding.bottom+")";break;default:e="translate(0,0)"}d.attr("transform",e).text(b.labelOutside||"")},a.setPadding=function(b,c){a.padding[b]=Math.max(a.padding[b],c)},a.updatePadding=function(){var b,c,d=1.25;a.customPadding?a.padding=a.customPadding:(a.padding={top:0,bottom:0,left:0,right:0},a.axesVisible.forEach(function(e){b=e.orientation.split("-"),c=a.getMaxTickBox(e.axis),a.setPadding("top",c.height/2),a.setPadding("bottom",c.height/2),a.setPadding("left",c.width/2),a.setPadding("right",c.width/2),"outside"===b[1]&&("right"===b[0]||"left"===b[0]?a.setPadding(b[0],d*c.width+a.innerTickSize):("top"===b[0]||"bottom"===b[0])&&a.setPadding(b[0],c.height+a.innerTickSize)),e.labelOutside&&(a.padding[b[0]]+=1.1*a.labelHeightOutside)}))},a.updateTickCounts=function(b,c){var d;a.axesVisible.forEach(function(a){d=a.tickCountMultiplier||1,a.axis.scale().rangeBand||a.axis.ticks(a.tickCount?a.tickCount:["right","left"].indexOf(a.orientation.split("-")[0])>-1?d*c/60:d*b/75)})};var b=function(b){a.initOridinalRanges(),a.axesAll=[a.x,a.y,a.x2,a.y2],a.axesVisible=a.axesAll.filter(function(a){return!a.hidden}),a.labelHeightOutside=a.labelHeightOutside||a.getLabelHeight("d2b-label-outside"),a.labelHeightInside=a.labelHeightInside||a.getLabelHeight("d2b-label-inside"),a.updatePadding(),a.innerWidth=a.width-a.padding.left-a.padding.right,a.innerHeight=a.height-a.padding.top-a.padding.bottom,a.updateTickCounts(a.innerWidth,a.innerHeight),a.axesAll.forEach(a.updateScale),b.each(function(b,c){var d=d3.select(this),e=d.selectAll("g.d2b-axis-container").data([0]);e._enter=e.enter().append("g").attr("class","d2b-axis-container"),e._update=d3.transition(e).attr("transform","translate("+a.padding.left+","+a.padding.top+")"),e.grid=e.selectAll("g.d2b-axis-grid").data(a.axesVisible,function(a){return a.key}),e.grid._enter=e.grid.enter().append("g").attr("class",function(a){return"d2b-axis-grid d2b-"+a.key}).style("opacity",0).each(a.updateGrid),e.grid._update=d3.transition(e.grid).each(a.updateGrid),e.grid._exit=d3.transition(e.grid.exit()).style("opacity",0).remove(),e.axis=e.selectAll("g.d2b-axis").data(a.axesVisible,function(a){return a.key}),e.axis._enter=e.axis.enter().append("g").style("opacity",0).attr("class",function(a){return"d2b-axis d2b-"+a.key}).each(a.updateAxis),e.axis._update=d3.transition(e.axis).each(a.updateAxis),e.axis._exit=d3.transition(e.axis.exit()).style("opacity",0).remove(),e.axis._enter.append("text").attr("class","d2b-axis-label d2b-label-outside"),e.axis._enter.append("text").attr("class","d2b-axis-label d2b-label-inside"),e.axis.labelOutside=e.axis.select(".d2b-axis-label.d2b-label-outside"),e.axis.labelInside=e.axis.select(".d2b-axis-label.d2b-label-inside"),d3.transition(e.axis.labelOutside).each(a.updateLabelOutside),d3.transition(e.axis.labelInside).each(a.updateLabelInside)})};return b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.width=function(c){return arguments.length?(a.width=c,b):a.width},b.height=function(c){return arguments.length?(a.height=c,b):a.height},b.customPadding=function(c){return arguments.length?("number"==typeof c?a.customPadding={left:c,right:c,top:c,bottom:c}:a.customPadding=c,b):a.customPadding},a.axisKeys.forEach(function(c){b[c]=function(d){return arguments.length?(a[c].labelOutside=d.labelOutside||a[c].labelOutside,a[c].labelInside=d.labelInside||a[c].labelInside,a[c].axis=d.axis||a[c].axis,a[c].tickCount=d.tickCount||a[c].tickCount,a[c].tickCountMultiplier=d.tickCountMultiplier||a[c].tickCountMultiplier,a[c].hidden=null!=d.hidden&&void 0!=d.hidden?d.hidden:a[c].hidden,d.orientation&&(d.orientation=d.orientation.split("-"),a[c].orientation=d.orientation[0]+"-"+d.orientation[1]||"outside"),d.scale&&(a[c].scale=d.scale,a[c].axis.scale(a[c].scale)),b):a[c]}}),b.scale=function(c){var d,c=c.toLowerCase()||"x",e=b[c]().axis,f=e.scale(),g=!1;return d=a.axisKeys.indexOf(c)>-1?function(a){{var e,a;b[c]().orientation.split("-")[0]}"object"==typeof a&&c in a&&(a=a[c]),e=f(a)||0;var h=f.range();return g?e=d3.max(h)-e+d3.min(h)+d.rangeBand()/2:e+=d.rangeBand()/2,e}:function(){return null},d.range=function(){var a=[];return f.rangeBand?(a=f.range(),a=[a[0],a[a.length-1]+f.rangeBand()]):a=f.range(),a},d.domain=function(){return g?f.domain().slice().reverse():f.domain()},d.reversed=function(a){return g=a,d},d.invert=function(a){var b=(f.domain(),f.invert(a));return b=f.invert(a)},d.rangeBand=function(){return f.rangeBand?f.rangeBand():0},d.change=function(a){return c=a.toLowerCase()||"x",e=b[c]().axis,f=e.scale(),d},d},b.box=function(c){return arguments.length?(a.width=c.width||a.width,a.height=c.height||a.height,a.customPadding=c.padding||a.customPadding,b):{width:a.width,height:a.height,innerWidth:a.innerWidth,innerHeight:a.innerHeight,padding:a.padding}},b},d2b.SVG.point=function(){var a={};a.size=d3.functor(150),a.type=d3.functor("circle"),a.active=d3.functor(!1),a.stroke=d3.functor(null),a.strokeWidth=d3.functor("1px"),a.fill=d3.functor(null),a.symbol=d2b.SVG.symbol().type(a.type),a.mouseover=function(b,c){var d=a.size.call(this,b,c)||150,e=a.type.call(this,b,c)||"circle",f=a.strokeWidth.call(this,b,c)||"1px";d=15*Math.pow(d,.5)+d*Math.pow(parseFloat(f),.2),a.symbol.size(d).type(e),d3.select(this).select("path.d2b-point-background").transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("d",a.symbol)},a.mouseout=function(b,c){var d=a.size.call(this,b,c)||150,e=a.type.call(this,b,c)||"circle";a.symbol.size(d).type(e),d3.select(this).select("path.d2b-point-background").transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("d",a.symbol)};var b=function(b){b.each(function(b,c){var d=d3.select(this),e=a.size.call(this,b,c)||150,f=a.type.call(this,b,c)||"circle",g=a.fill.call(this,b,c),h=a.stroke.call(this,b,c),i=a.strokeWidth.call(this,b,c)||"1px",j=a.active.call(this,b,c);a.symbol.size(e).type(f);var k=d.selectAll("path.d2b-point-background").data([b]);backgroundEnter=k.enter().append("path").attr("class","d2b-point-background"),backgroundUpdate=d3.transition(k),backgroundExit=d3.transition(k.exit()),backgroundEnter.attr("d",a.symbol).style("fill","rgba(255,255,255,0)").style("stroke-width",i).style("stroke",h),backgroundUpdate.attr("d",a.symbol).style("stroke",h),backgroundExit.style("opacity",0).remove();var l=d.selectAll("path.d2b-point-foreground").data([b]);foregroundEnter=l.enter().append("path").attr("class","d2b-point-foreground"),foregroundUpdate=d3.transition(l),foregroundExit=d3.transition(l.exit()),foregroundEnter.attr("d",a.symbol).style("stroke-width",i).style("stroke",h).style("fill",g),foregroundUpdate.attr("d",a.symbol).style("fill",g).style("stroke",h),foregroundExit.style("opacity",0).remove(),j?d.on("mouseover.d2b-mouseover",a.mouseover).on("mouseout.d2b-mouseout",a.mouseout):d.on("mouseover.d2b-mouseover",null).on("mouseout.d2b-mouseout",null)})};return b.type=function(c){return arguments.length?(a.type=d3.functor(c),a.symbol.type(a.type),b):a.type},b.size=function(c){return arguments.length?(a.size=d3.functor(c),a.symbol.size(a.size),b):a.size},b.fill=function(c){return arguments.length?(a.fill=d3.functor(c),b):a.fill},b.stroke=function(c){return arguments.length?(a.stroke=d3.functor(c),b):a.stroke},b.strokeWidth=function(c){return arguments.length?(a.strokeWidth=d3.functor(c),b):a.strokeWidth},b.active=function(c){return arguments.length?(a.active=d3.functor(c),b):a.active},b},d2b.SVG.symbol=function(){var a={};a.size=d3.functor(150),a.type=d3.functor("circle"),a.d3Symbol=d3.svg.symbol().type(a.type),a.symbol=a.d3Symbol;var b=function(b,c){var d=a.type.call(this,b,c),e=a.size;return d3.svg.symbolTypes.indexOf(d)>-1?a.symbol=a.d3Symbol.type(d).size(e):d2b.SVG.symbolTypes.indexOf(d)>-1?a.symbol=d2b.SVG.symbols[d]:a.symbol=a.d3Symbol.type("circle").size(e),a.symbol(a.size.call(this,b,c))};return b.size=function(c){return arguments.length?(a.size=d3.functor(c),b):a.size},b.type=function(c){return arguments.length?(a.type=d3.functor(c),b):a.type},b},d2b.SVG.symbols={star:function(a){var b=Math.sin(d2b.MATH.toRadians(36)),c=Math.cos(d2b.MATH.toRadians(36)),d=Math.sin(d2b.MATH.toRadians(54)),e=Math.cos(d2b.MATH.toRadians(54)),f=Math.sin(d2b.MATH.toRadians(18)),g=Math.cos(d2b.MATH.toRadians(18)),h=Math.tan(d2b.MATH.toRadians(18)),i=Math.sqrt(a/(5*c*(b+c/h))),j=i*b+i*c/h;return"M0,"+-j+"L"+i*e+","+-i*d+" "+j*g+","+-j*f+" "+i*g+","+i*f+" "+j*b+","+j*c+" 0,"+i+" "+-j*b+","+j*c+" "+-i*g+","+i*f+" "+-j*g+","+-j*f+" "+-i*e+","+-i*d+" 0,"+-j+"Z"},mars:function(a){var b=Math.sqrt(a/(Math.PI+5/4)),c=Math.sqrt(8),d=Math.sqrt(2),e=.3125*b;return"M"+b/c+",0A"+b+","+b+" 0 1,1 0,"+-b/c+"L"+b*(5/4-1/d)+","+-b*(1/c+5/4-1/d)+" "+(b*(5/4-1/d)-e)+","+-b*(1/c+5/4-1/d)+" "+(b*(5/4-1/d)-e)+","+-b*(1/c+7/4-1/d)+" "+b*(7/4-1/d+1/c)+","+-b*(1/c+7/4-1/d)+" "+b*(7/4-1/d+1/c)+","+(-b*(5/4-1/d)+e)+" "+b*(5/4-1/d+1/c)+","+(-b*(5/4-1/d)+e)+" "+b*(5/4-1/d+1/c)+","+-b*(5/4-1/d)+"Z"},venus:function(a){var b=Math.sqrt(a/(Math.PI+5/4));return"M"+-b/4+","+b/4+"A"+b+","+b+" 0 1,1 "+b/4+","+b/4+"L"+b/4+","+3*b/4+" "+3*b/4+","+3*b/4+" "+3*b/4+","+5*b/4+" "+b/4+","+5*b/4+" "+b/4+","+7*b/4+" "+-b/4+","+7*b/4+" "+-b/4+","+5*b/4+" "+3*-b/4+","+5*b/4+" "+3*-b/4+","+3*b/4+" "+-b/4+","+3*b/4+"Z"},close:function(a){var b=Math.sqrt(a/5),c=Math.sqrt(b*b/2),d=Math.sqrt(.5)*b,e=c+d;return"M0,"+-d+"L"+c+","+-e+" "+e+","+-c+" "+d+",0 "+e+","+c+" "+c+","+e+" 0,"+d+" "+-c+","+e+" "+-e+","+c+" "+-d+",0 "+-e+","+-c+" "+-c+","+-e+" 0,"+-d+"Z"},"rect-horizontal":function(a){var b=3,c=Math.sqrt(a/b),d=c*b;return"M"+-d/2+","+-c/2+"L"+d/2+","+-c/2+" "+d/2+","+c/2+" "+-d/2+","+c/2+"Z"},"rect-vertical":function(a){var b=1/3,c=Math.sqrt(a/b),d=c*b;return"M"+-d/2+","+-c/2+"L"+d/2+","+-c/2+" "+d/2+","+c/2+" "+-d/2+","+c/2+"Z"},"arrow-right":function(a){var b=Math.sqrt(.8*a);return"M"+-b+","+-b/4+"L0,"+-b/4+" 0,"+-3*b/4+" "+b+",0 0,"+3*b/4+" 0,"+b/4+" "+-b+","+b/4+"Z"},"arrow-left":function(a){var b=Math.sqrt(.8*a);return"M"+b+","+-b/4+"L0,"+-b/4+" 0,"+-3*b/4+" "+-b+",0 0,"+3*b/4+" 0,"+b/4+" "+b+","+b/4+"Z"},"arrow-up":function(a){var b=Math.sqrt(.8*a);return"M"+-b/4+","+b+"L"+-b/4+",0 "+-3*b/4+",0 0,"+-b+" "+3*b/4+",0 "+b/4+",0 "+b/4+","+b+"Z"},"arrow-down":function(a){var b=Math.sqrt(.8*a);return"M"+-b/4+","+-b+"L"+-b/4+",0 "+-3*b/4+",0 0,"+b+" "+3*b/4+",0 "+b/4+",0 "+b/4+","+-b+"Z"}},d2b.SVG.symbols["cross-diagonal"]=d2b.SVG.symbols.close,d2b.SVG.symbols.x=d2b.SVG.symbols.close,d2b.SVG.symbolTypes=d3.svg.symbolTypes.concat(["star","close","rect-horizontal","rect-vertical","arrow-right","arrow-left","arrow-up","arrow-down","venus","mars"]),d2b.UTILS.symbol=d2b.SVG.symbol,d2b.UTILS.symbolTypes=d2b.SVG.symbolTypes,d2b.SVG.tooltip=function(){var a={};a.layout=0,a.container=d3.select("body"),a.animationDuration=100,a.graph={},a.refreshLayout={},a.refreshLayout[0]=function(){for(key in a.graph)a.graph[key].call(d2b.UTILS.bindTooltip,a.graph[key].config.content,a.graph[key].config.data,a.graph[key].config.fill)},a.refreshLayout[1]=function(){if(a.tracker&&a.container&&a.x&&a.y){var b=[];for(var c in a.graph)b.push(a.graph[c]);var d=a.container.selectAll(".d2b-tooltip").data(b,function(a){return a.config.key});d._update=d.transition().duration(a.animationDuration),d._enter=d.enter().append("g").attr("class","d2b-tooltip d2b-tooltip-layout-1"),d._enter.append("polyline").style("stroke-width","2px").style("fill","none"),d._enter.append("rect"),d._enter.append("circle").attr("r",3),d._enter.append("text").style("font-size","12px"),d._exit=d.exit().transition().duration(a.animationDuration).style("opacity",0).remove(),a.tracker.on("mouseenter.d2b-tooltip",function(){a.container.transition().duration(a.animationDuration).style("opacity",1)}),a.tracker.on("mouseleave.d2b-tooltip",function(){a.container.transition().duration(a.animationDuration).style("opacity",0)}),a.tracker.on("mousemove.d2b-tooltip",function(){a.mousemoveLayout1(this,d)})}},a.mousemoveLayout1=function(b,c){var d=a.x.range(),e=Math.abs(d[1]-d[0]),f=a.y.range(),g=(Math.abs(f[1]-f[0]),d3.mouse(b)),h=[a.x.invert(g[0]),a.y.invert(g[1])],i="right";e/2<g[0]&&(i="left");var j=a.initCellArray(d3.min(f),d3.max(f));c.each(function(b){var c,d,e,f,g=a.getClosestProperties(h,b),k=15,l=5,m=3,n=5;this.closest=g,elem=d3.select(this),elem.update=elem.transition().duration(a.animationDuration).ease("linear"),c=elem.select("text"),c.update=c.transition().duration(a.animationDuration).ease("linear"),e=elem.select("polyline"),e.update=e.transition().duration(a.animationDuration).ease("linear"),d=elem.select("rect"),d.update=d.transition().duration(a.animationDuration).ease("linear"),f=elem.select("circle"),c.text(this.closest.content);var o=c.node().getBBox();this.offsetY=a.offsetForCollisionResolution(j,a.y(this.closest.y),o.height+2*m+2*n),elem.update.attr("transform","translate("+a.x(this.closest.x)+","+a.y(this.closest.y)+")"),d.attr("width",o.width+2*l).attr("height",o.height+2*m).style("stroke",this.closest.darkFill).style("fill",this.closest.fill),f.style("stroke",this.closest.darkFill),e.style("stroke",this.closest.darkFill),"right"===i?(c.update.attr("transform","translate("+(k+l)+","+(o.height/3.5+this.offsetY)+")").style("text-anchor","start"),d.update.attr("transform","translate("+k+","+(-o.height/2-m+this.offsetY)+")"),e.update.attr("points","0,0 0,"+this.offsetY+" "+k+","+this.offsetY)):(c.update.attr("transform","translate("+(-k-l)+","+(o.height/3.5+this.offsetY)+")").style("text-anchor","end"),d.update.attr("transform","translate("+(-o.width-k-2*l)+","+(-o.height/2-m+this.offsetY)+")"),e.update.attr("points","0,0 0,"+this.offsetY+" "+-k+","+this.offsetY))})},a.initCellArray=function(a,b){a=d3.round(a,0),b=d3.round(b,0),b=Math.max(b,a),a=Math.min(b,a);var c=[],d=a;for(c.top=b,c.bottom=a;b>d;d+=1)c[d]=!1;return c},a.offsetForCollisionResolution=function(b,c,d){var e=a.findClosestOpenOffset(b,c,d);return a.occupyPixels(b,c+e,d),e},a.findClosestOpenOffset=function(a,b,c){var d=0,e=0;b=d3.round(b,0),c=d3.round(c,0);for(var f=d3.round(c/2,0),g=f,h=-f;c>d&&g+b>a.bottom;)a[g+b]&&(d=-1),d+=1,g-=1;for(;c>e&&h+b<a.top;)a[h+b]&&(e=-1),e+=1,h+=1;return h-=f,g+=f,Math.abs(h)<Math.abs(g)&&e>=c?h:d>=c?g:e>d?h:g},a.occupyPixels=function(a,b,c){var d;b=d3.round(b,0);var e=d3.round(c/2,0);for(d=b-e;b+e>=d;d+=1)a[d]=!0},a.getClosestProperties=function(a,b){var c=1/0,d=1/0,e=null;return b.each(function(f,g){var h={};if(h.x="function"==typeof b.config.x?b.config.x.apply(this,arguments):b.config.x||null,h.y="function"==typeof b.config.y?b.config.y.apply(this,arguments):b.config.y||null,null!==h.y&&null!==h.x&&void 0!==h.y&&void 0!==h.x){var i=Math.abs(a[0]-h.x),j=Math.abs(a[1]-h.y);i>c||i===c&&j>d||(h.point=[h.x,h.y],h.data="function"==typeof b.config.data?b.config.data.apply(this,arguments):b.config.data||f,h.content="function"==typeof b.config.content?b.config.content.apply(this,[h.data,g]):f.config.content,h.fill="function"==typeof b.config.fill?b.config.fill.apply(this,arguments):b.config.fill||f,h.darkFill=d3.rgb(h.fill).darker(1),h.data=f,c=i,d=j,e=h)}}),e},a.stop=function(){a.tracker&&(a.tracker.on("mouseenter.d2b-tooltip",null),a.tracker.on("mousemove.d2b-tooltip",null),a.tracker.on("mouseout.d2b-tooltip",null));for(key in a.graph)a.graph[key].call(d2b.UTILS.unbindTooltip);d2b.UTILS.removeTooltip(),a.container.selectAll(".d2b-tooltip").remove()};var b={};return b.container=function(c){return arguments.length?(a.container=c,a.container.transition().duration(a.animationDuration).style("opacity",0),b):a.container},b.tracker=function(c){return arguments.length?(a.tracker=c,b):a.tracker},b.graph=function(c,d){return arguments.length?(a.graph[d.key]=c,a.graph[d.key].config=d,b):a.graph},b.layout=function(c){return arguments.length?(a.layout=c+"",b):a.layout},b.animationDuration=function(c){return arguments.length?(a.animationDuration=c,b):a.animationDuration},b.start=function(){return a.refreshLayout[a.layout](),b},b.stop=function(){return a.stop(),b},b.reset=function(){return a.stop(),a.graph={},b},b.x=function(c){return arguments.length?(a.x=c,b):a.x},b.y=function(c){return arguments.length?(a.y=c,b):a.y},b},d2b.UTILS.AXISCHART.TYPES.area=function(){var a={};a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={},a.xFormat=function(a){return a},a.yFormat=function(a){return a},a.events=d2b.UTILS.chartEvents(),a.x=d3.scale.linear(),a.y=d3.scale.linear(),a.area=d3.svg.area().x(function(b){return a.x(b.x)}).y1(function(b){return a.y(b.yComputed+b.y0Computed)}).y0(function(b){return a.y(b.y0Computed)}),a.point=d2b.SVG.point().size(40).active(!0).fill("white"),a.tooltip=function(b){return a.xFormat(b.data.x)+" : "+a.yFormat(b.data.y)},a.initYComputed=function(a){a.forEach(function(a){a.values.forEach(function(a){a.y0Computed=0,a.yComputed=a.y})})},a.tooltipSVG=d2b.SVG.tooltip();var b={};return b.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"foreground"),b.background=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"background"),b.general=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"general"),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration"),b.x=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"x"),b.y=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"y"),b.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"xFormat"),b.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"yFormat"),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.color=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"color"),b.controls=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"controlsData"),b.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"axisChart"),b.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"tooltip"),b.tooltipSVG=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"tooltipSVG"),b.offset=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"offset"),a.updatePoints=function(b,c){a.foreground.point=c.selectAll("g.d2b-point").data(function(a){return a.values});a.foreground.point.enter().append("g").attr("class","d2b-point").attr("transform",function(b){return"translate("+a.x(b.x)+","+a.y(b.yComputed+b.y0Computed)+")"}).call(a.events.addElementDispatcher,"main","d2b-area-point");a.point.type(function(a,c){return a.symbol||b.symbol||"circle"}).stroke(d2b.UTILS.getColor(a.color,"label",[b])),a.foreground.point.call(a.point),a.foreground.point.call(a.tooltipSVG.graph,{key:b.label,content:a.tooltip,data:function(a){return{data:a,graph:b}},x:function(a){return a.x},y:function(a){return a.yComputed+a.y0Computed},fill:d2b.UTILS.getColor(a.color,"label",[b])}).transition().duration(a.animationDuration).attr("transform",function(b){return"translate("+a.x(b.x)+","+a.y(b.yComputed+b.y0Computed)+")"}),a.foreground.point.exit().transition().duration(a.animationDuration).style("opacity",0).attr("r",0).remove()},a.stack=function(b){a.controlsData.stackAreas.enabled?d3.layout.stack().out(function(a,b,c){a.y0Computed=b,a.yComputed=c}).offset(a.offset||a.controlsData.stackAreas.offset||"zero").values(function(a){return a.values})(b):a.initYComputed(b)},b.xValues=function(){var b=[];return a.currentChartData.forEach(function(a){b=b.concat(a.values.map(function(a){return a.x}))}),b},b.yValues=function(){a.stack(a.currentChartData);var b=[];return a.currentChartData.forEach(function(a){b=b.concat(a.values.map(function(a){return a.yComputed+a.y0Computed})),b=b.concat(a.values.map(function(a){return a.y0Computed}))}),b},b.data=function(c,d){return arguments.length?(d&&(a.currentChartData={}),a.currentChartData=c,b):a.currentChartData},b.update=function(c){return a.stack(a.currentChartData),a.background.each(function(b){var c=d3.select(this),d=c.select("path");0==d.size()&&(d=c.append("path").call(a.events.addElementDispatcher,"main","d2b-area")),a.area.interpolate(b.interpolate||"linear").tension(b.tension||0),d.datum(function(a){return b.values}).style("fill",d2b.UTILS.getColor(a.color,"label",[b])).style("stroke",d2b.UTILS.getColor(a.color,"label",[b])).transition().duration(a.animationDuration).attr("d",a.area)}),a.foreground.each(function(b){var c=d3.select(this);a.updatePoints(b,c)}),d3.timer.flush(),c&&c(),b},b},d2b.UTILS.AXISCHART.TYPES.area.tools=function(){return{controlsData:{stackAreas:{label:"Stack Areas",type:"checkbox",visible:!1,enabled:!1}}}},d2b.UTILS.AXISCHART.TYPES.bar=function(){var a={};a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={},a.xFormat=function(a){return a},a.yFormat=function(a){return a},a.events=d2b.UTILS.chartEvents(),a.groupScale=d3.scale.ordinal(),a.padding="10%",a.updateStackedVals=function(b,c){return a.barSignedHeight(c)<0?(b+=a.barHeight(c),{newValue:b,modifier:-a.barHeight(c)}):(b-=a.barHeight(c),{newValue:b,modifier:0})},a.getLinearRangeBand=function(){var b=a.currentChartData.map(function(a){return a.values.map(function(a){return a.x}).sort()}),c=1/0;return b.forEach(function(a){for(var b=0;b<a.length-1;b++)c=Math.min(Math.abs(a[b+1]-a[b]),c)}),c==1/0?a.width:a.x(Math.min.apply(null,a.x.domain())+c)},a.tooltip=function(b){return a.xFormat(b.data.x)+" : "+a.yFormat(b.data.y)},a.barSignedHeight=function(b){var c,d;return c=a.y(0),d=a.y(b.y),c-d},a.barHeight=function(b){return Math.abs(a.barSignedHeight(b))},a.barY=function(b){var c,d;return c=a.y(0),d=a.y(b.y),Math.min(c,d)},a.buildOut=function(a){var b=[],c=0;return function(d,e,f){c++%a===0&&(b=[0,0]),f>=0?(d.y0=b[1],d.y=f,b[1]+=f):(d.y0=b[0],d.y=f,b[0]+=f)}},a.resetY0=function(){a.currentChartData.forEach(function(a){a.values.forEach(function(a){a.y0=0})})};var b={};return b.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"foreground"),b.background=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"background"),b.general=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"general"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration"),b.x=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"x"),b.y=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"y"),b.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"xFormat"),b.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"yFormat"),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.color=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"color"),b.controls=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"controlsData"),b.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"axisChart"),b.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"tooltip"),b.tooltipSVG=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"tooltipSVG"),b.padding=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"padding"),b.xValues=function(){var b=[];return a.currentChartData.forEach(function(a){b=b.concat(a.values.map(function(a){return a.x}))}),b},b.yValues=function(){a.controlsData.stackBars.enabled?d3.layout.stack().values(function(a){return a.values}).out(a.buildOut(a.currentChartData.length))(a.currentChartData):a.resetY0();var b=[0];return a.currentChartData.forEach(function(a){b=b.concat(a.values.map(function(a){return a.y+a.y0}))}),b},b.data=function(c){return arguments.length?(a.currentChartData=c,b):a.currentChartData},b.update=function(c){a.controlsData.stackBars.enabled?d3.layout.stack().values(function(a){return a.values}).out(a.buildOut(a.currentChartData.length))(a.currentChartData):a.resetY0();var d=a.x.rangeBand();0===a.x.rangeBand()&&(d=a.getLinearRangeBand());var e=d2b.UTILS.visualLength(a.padding,d),f=a.currentChartData.filter(function(a){return!a.center}).map(function(a){return a.label});a.groupScale.domain(f).rangeBands([0+e,d-e]);var g=.01*a.groupScale.rangeBand();return a.background.each(function(b){
var c=d3.select(this),f=c.selectAll("rect").data(b.values,function(a,b){return a.x}),h=f.enter().append("rect").style("fill",d2b.UTILS.getColor(a.color,"label",[b])).call(a.events.addElementDispatcher,"main","d2b-bar");f.each(function(c){c.placement={},a.controlsData.stackBars.enabled?(c.placement.x=a.x(c.x)-d/2+e,c.y>=0?c.placement.y=a.y(c.y+c.y0):c.placement.y=a.y(c.y0),c.placement.dx=d-2*e):c.center||b.center?(c.placement.x=a.x(c.x)-d/2+e,c.placement.y=a.barY(c),c.placement.dx=d-2*e):(c.placement.x=a.x(c.x)-d/2+a.groupScale(b.label)+g,c.placement.y=a.barY(c),c.placement.dx=Math.max(0,a.groupScale.rangeBand()-2*g)),c.placement.dy=a.barHeight(c)}),h.attr("y",a.y(0)).attr("height",0),f.call(a.tooltipSVG.graph,{key:b.label,content:a.tooltip,data:function(a){return{data:a,graph:b}},x:function(b){return a.x.invert(b.placement.x+b.placement.dx/2)},y:function(a){return a.y+a.y0},fill:d2b.UTILS.getColor(a.color,"label",[b])}).transition().duration(a.animationDuration).style("fill",d2b.UTILS.getColor(a.color,"label",[b])).attr("x",function(a){return a.placement.x}).attr("y",function(a){return a.placement.y}).attr("width",function(a){return a.placement.dx}).attr("height",function(a){return a.placement.dy}),f.exit().transition().duration(a.animationDuration).attr("y",a.y(0)).attr("height",0)}),d3.timer.flush(),c&&c(),b},b},d2b.UTILS.AXISCHART.TYPES.bar.tools=function(){return{controlsData:{stackBars:{label:"Stack Bars",type:"checkbox",visible:!1,enabled:!1}}}},d2b.UTILS.AXISCHART.TYPES.bubblePack=function(){var a={};a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.positionType="mean",a.positionTypeX=a.positionType,a.positionTypeY=a.positionType,a.reformatRequired=!0,a.xFormat=function(a){return a},a.yFormat=function(a){return a},a.events=d2b.UTILS.chartEvents(),a.expandedNodes={},a.sizeScale=[1,1],a.size=d3.scale.linear(),a.tooltip=function(b){return""+a.xFormat(b.data.xComputed)+" : "+a.yFormat(b.data.yComputed)+" ("+b.data.sizeComputed+")"},a.breadcrumbs=d2b.UTILS.breadcrumbs().scale(5.5),a.breadcrumbs.reset=function(){var b={data:{items:[]}};a.breadcrumbs.data(b).update()},a.breadcrumbs.set=function(b){var c={data:{items:b.map(function(a,b){return{label:a.name,key:b+","+a.name,data:a}})}};a.breadcrumbs.data(c).update();var d=a.breadcrumbs.selection();d.breadcrumb.path.attr("stroke-width",1.5).style("fill-opacity",.2).style("stroke-opacity",.7).style("fill",function(b){return a.node.fill(b.data)}).attr("stroke",function(b){return a.node.fillDark(b.data)})},a.node={},a.node.getAncestors=function(a){for(var b=[],c=a;c.parent;)b.unshift(c),c=c.parent;return b.unshift(c),b},a.node.resetExpanded=function(b){a.expandedNodes[b.key]=!1,b.children&&b.children.forEach(function(b){a.node.resetExpanded(b)})},a.node.formKey=function(b,c){return b.key=c+b.name,b.parent&&(b.key+=a.node.formKey(b.parent,c)),b.key},a.node.toggleExpanded=function(b){a.breadcrumbs.reset(),a.expandedNodes[b.key]=!a.expandedNodes[b.key],a.expandedNodes[b.key]||a.node.resetExpanded(b),a.axisChart.update()},a.node.mouseover=function(b){a.breadcrumbs.set(a.node.getAncestors(b))},a.node.mouseout=function(b){a.breadcrumbs.reset()},a.node.fill=function(b){return a.color(b.fill)},a.node.fillDark=function(b){return d3.rgb(a.node.fill(b)).darker(1)},a.node.symbol=function(a){return a.symbolType},a.node.getSymbolPathSmall=function(a){return d2b.UTILS.symbol().type(a.symbolType).size(75)(a)},a.point=d2b.SVG.point().type(a.node.symbol).size(function(b){return a.size(b.sizeComputed)}).active(function(a){return a.children&&a.children.length}).fill(a.node.fill).stroke(a.node.fillDark).strokeWidth(function(a){return a.children&&a.children.length?"1.5px":"0px"}),a.bubble={},a.bubble.visibility=function(b){var c=d3.select(this),d=d3.transition(c);c.classed("d2b-hidden",a.expandedNodes[b.key]),d.style("opacity",a.expandedNodes[b.key]?0:.7)},a.bubble.bindClick=function(b){var c=d3.select(this);b.children?c.on("click",a.node.toggleExpanded).style("cursor","pointer"):c.on("click",null).style("cursor","auto")},a.bubble.transform=function(b){return"translate("+a.x(b.xComputed)+","+a.y(b.yComputed)+")"},a.bubble.enterTransform=function(b){return b.parent?b.parent.bubble.attr("transform"):a.bubble.transform(b)},a.bubble.updateChildren=function(b){var c=d3.select(this),d=d3.transition(c);a.expandedNodes[b.key]&&b.children&&b.children.length?a.bubble.update(d3.select(this),b.children):d.selectAll(".d2b-bubble-group").style("opacity",0).remove().selectAll(".d2b-bubble").attr("transform",a.bubble.transform(b))},a.bubble.update=function(b,c){var d=b.selectAll("g.d2b-bubble-group").data(c,a.bubbleKey),e=d.enter().append("g").attr("class","d2b-bubble-group");e.append("g").call(a.events.addElementDispatcher,"main","d2b-bubble").attr("class","d2b-bubble").attr("transform",a.bubble.enterTransform).on("mouseover.d2b-node-mouseover",a.node.mouseover).on("mouseout.d2b-node-mouseout",a.node.mouseout);d.select(".d2b-bubble").each(function(a){a.bubble=d3.select(this)}).each(a.bubble.bindClick).transition().duration(a.animationDuration).call(a.point).attr("transform",a.bubble.transform).each(a.bubble.visibility);d.transition().duration(a.animationDuration).each(a.bubble.updateChildren)},a.expandedBubbleIndicator={},a.expandedBubbleIndicator.enter=function(b){var c=b.enter().append("g").attr("class","d2b-expanded-bubble-indicator").on("click.d2b-click",a.node.toggleExpanded).on("mouseover.d2b-node-mouseover",a.node.mouseover).on("mouseout.d2b-mouseout",a.node.mouseout).call(a.events.addElementDispatcher,"main","d2b-expanded-bubble-indicator");c.append("rect").style("fill",a.node.fill).style("stroke",a.node.fillDark).attr("height",20),c.append("path").style("fill",a.node.fill).attr("transform","translate(10, 10)"),c.append("text").attr("x",20).attr("y",15).text(function(a){return a.name.substring(0,4).trim()})},a.expandedBubbleIndicator.update=function(b,c){var d=b.attr("transform",function(b){var d=d3.select(this),e=d.select("text").node().getComputedTextLength()+30;return d.select("rect").each(function(){this.indicatorWidth=e}),e+=5,c.x+=e,c.x>a.width-20&&(c.y+=25,c.x=e+10),"translate("+(c.x-e)+","+c.y+")"});d.select("rect").attr("width",function(){return this.indicatorWidth}).style("fill",a.node.fill).style("stroke",a.node.fillDark),d.select("path").attr("d",a.node.getSymbolPathSmall).style("fill",a.node.fill),a.breadcrumbsContainer.attr("transform","translate(10,"+(c.y+30)+")")},a.expandedBubbleIndicator.exit=function(a){a.exit().transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).style("opacity",0).remove()},a.cleanSizeScale=function(a){return a?1===a.length?[a[0],a[0]]:a:null===a?[1,1]:void 0},a.getValues=function(b){return b.children?[].concat.apply([],b.children.map(function(b,c){return a.getValues(b)})):b.values?b.values:[b]},a.traverseTree=function(a,b){function c(a){var d=this,e=b.call(d,a);d.children&&"break"!==e&&d.children.forEach(function(a,b){c.call(a,d)})}c.call(a,null)},a.formatData=function(){a.currentChartData&&a.reformatRequired&&(a.currentChartData.forEach(function(b,c){a.traverseTree(b.pack,function(c){this.parent=c,this.key=a.node.formKey(this,b.label),this.values=a.getValues(this),this.sizeComputed=d3.sum(this.values,function(a){return a.size||1}),this.xComputed=d2b.MATH[a.positionTypeX](this.values,function(a){return a.x||0},function(a){return a.size||1}),this.yComputed=d2b.MATH[a.positionTypeY](this.values,function(a){return a.y||0},function(a){return a.size||1}),this.fill=this.colorKey||b.colorKey||b.label,this.symbolType=this.symbol||b.symbol||"circle"})}),a.reformatRequired=!1)},a.sortPack=function(b){var c={expanded:[],visible:[]};return a.traverseTree(b,function(){this.bubble&&this.bubble.classed("d2b-visible",!1).classed("d2b-expanded",!1)}),a.traverseTree(b,function(){return a.expandedNodes[this.key]?(c.expanded.push(this),void(this.bubble&&this.bubble.classed("d2b-expanded",!0))):(c.visible.push(this),this.bubble&&this.bubble.classed("d2b-visible",!0),"break")}),c},a.bubbleKey=function(a){return a.key};var b={};return b.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"foreground"),b.background=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"background"),b.general=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"general"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration"),b.x=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"x"),b.y=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"y"),b.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"xFormat"),b.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"yFormat"),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.color=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"color"),b.controls=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"controlsData"),b.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"axisChart"),b.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"tooltip"),b.tooltipSVG=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"tooltipSVG"),b.sizeScale=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"sizeScale",function(){a.sizeScale=a.cleanSizeScale(a.sizeScale)}),b.positionType=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"positionType",function(){a.positionTypeX=a.positionType,a.positionTypeY=a.positionType,a.reformatRequired=!0}),b.positionTypeX=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"positionTypeX",function(){a.reformatRequired=!0}),b.positionTypeY=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"positionTypeY",function(){a.reformatRequired=!0}),b.xValues=function(){var b=[];return a.formatData(),a.currentChartData.forEach(function(c){a.traverseTree(c.pack,function(){return a.expandedNodes[this.key]?void 0:(b.push(this.xComputed),"break")})}),b},b.yValues=function(){var b=[];return a.formatData(),a.currentChartData.forEach(function(c){a.traverseTree(c.pack,function(c){return a.expandedNodes[this.key]?void 0:(b.push(this.yComputed),"break")})}),b},b.data=function(c){return arguments.length?(a.currentChartData=c,a.reformatRequired=!0,b):a.currentChartData},b.update=function(c){a.formatData(),a.size.domain([0,d3.max(a.currentChartData,function(a){return a.pack.sizeComputed})]),a.breadcrumbsContainer=a.general.select("g.d2b-breadcrumbs"),a.breadcrumbsContainer.size()||(a.breadcrumbsContainer=a.general.append("g").attr("class","d2b-breadcrumbs"),a.breadcrumbs.selection(a.breadcrumbsContainer)),a.breadcrumbs.width(a.width),a.size.range([10*a.sizeScale[0],a.sizeScale[1]*Math.min(a.width,a.height)*10]);var d={x:10,y:10};return a.foreground.each(function(b){var c=d3.select(this);a.bubble.update(c,[b.pack]);var e=a.sortPack(b.pack);c.selectAll(".d2b-visible").call(a.tooltipSVG.graph,{key:b.label,content:a.tooltip,data:function(a){return{data:a,graph:b}},x:function(a){return a.xComputed},y:function(a){return a.yComputed},fill:a.node.fill});var f=c.selectAll("g.d2b-expanded-bubble-indicator").data(e.expanded,function(a){return a.key});a.expandedBubbleIndicator.enter(f),a.expandedBubbleIndicator.update(f,d),a.expandedBubbleIndicator.exit(f),f.call(d2b.UTILS.bindTooltip,a.tooltip,function(a){return{data:a,graph:b}},a.node.fill)}),d3.timer.flush(),c&&c(),b},b},d2b.UTILS.AXISCHART.TYPES.gridMarker=function(){var a={};a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={},a.xFormat=function(a){return a},a.yFormat=function(a){return a},a.events=d2b.UTILS.chartEvents(),a.labelOffset=3,a.point=d2b.SVG.point().size(40).active(!0).fill("white"),a.newGroup=function(b,c){var d=b.append("g").attr("class","d2b-grid-marker-x").call(a.updateMarkers,c,"x",!1);d.append("line").attr("class","d2b-grid-marker-line"),d.append("text").attr("class","d2b-grid-marker-coordinate").attr("transform","rotate(-90)").attr("y",7+a.labelOffset);var e=b.append("g").attr("class","d2b-grid-marker-y").call(a.updateMarkers,c,"y",!1);e.append("line").attr("class","d2b-grid-marker-line"),e.append("text").attr("class","d2b-grid-marker-coordinate").attr("y",7+a.labelOffset);b.append("g").attr("class","d2b-grid-marker-center").call(a.updateCenter,c,!1).call(a.events.addElementDispatcher,"main","d2b-grid-marker");b.append("g").attr("class","d2b-grid-marker-label").call(a.updateLabel,c,!1).append("text")},a.updateMarker={},a.updateMarker.x=function(b,c,d){b.style("opacity",1).attr("transform",function(b){return"translate("+a.x(b.x)+",0)"}).select("line").attr("x1",0).attr("x2",0).attr("y1",c[0]).attr("y2",c[1]).style("stroke",d2b.UTILS.getColor(a.color,"label",[d])),b.select(".d2b-grid-marker-coordinate").attr("x",function(b){return b.invert?-c[0]+a.labelOffset:-a.labelOffset})},a.updateMarker.y=function(b,c,d){b.style("opacity",1).attr("transform",function(b){return"translate("+c[1]+","+a.y(b.y)+")"}).select("line").attr("x1",c[0]).attr("x2",-c[1]).attr("y1",0).attr("y2",0).style("stroke",d2b.UTILS.getColor(a.color,"label",[d])),b.select(".d2b-grid-marker-coordinate").attr("x",function(b){return b.invert?-c[1]+a.labelOffset:-a.labelOffset})},a.updateMarkers=function(b,c,d,e){var f="x",g="y";"y"==d&&(f="y",g="x");var h=a[g].range();b.each(function(b){var d=d3.select(this);e&&(d=d.transition().duration(a.animationDuration)),b[f]?d.call(a.updateMarker[f],h,c):d.style("opacity",0)}),b.select("line").classed("d2b-dashed",function(a){return a.dashed}),b.select("text.d2b-grid-marker-coordinate").classed("d2b-inverted",function(a){return a.invert}).text(function(b){return a[f+"Format"](b[f])})},a.updateLabel=function(b,c,d){var e=a.x.range(),f=a.y.range();this.each(function(b){var c=d3.select(this),g=c.select("text");d&&(c=c.transition().duration(a.animationDuration),g=g.transition().duration(a.animationDuration)),g.text(function(a){return a.label}).attr("y",-a.labelOffset).attr("transform","rotate(0)"),null!=b.x&&null!=b.y?a.x(b.x)>a.width/2?(c.attr("transform","translate("+a.x(b.x)+","+a.y(b.y)+")"),g.style("text-anchor","end").attr("x",a.labelOffset)):(c.attr("transform","translate("+a.x(b.x)+","+a.y(b.y)+")"),g.style("text-anchor","start").attr("x",a.labelOffset)):null!=b.y?b.invert?(c.attr("transform","translate("+e[0]+","+a.y(b.y)+")"),g.style("text-anchor","start").attr("x",a.labelOffset)):(c.attr("transform","translate("+e[1]+","+a.y(b.y)+")"),g.style("text-anchor","end").attr("x",-a.labelOffset)):b.invert?(c.attr("transform","translate("+a.x(b.x)+","+f[0]+")"),g.style("text-anchor","start").attr("x",a.labelOffset).attr("transform","rotate(-90)")):(c.attr("transform","translate("+a.x(b.x)+","+f[1]+")"),g.style("text-anchor","end").attr("x",-a.labelOffset).attr("transform","rotate(-90)"))})},a.updateCenter=function(b,c,d){b.each(function(b){var e=d3.select(this);d&&(e=e.transition().duration(a.animationDuration)),null!=b.y&&null!=b.x?(a.point.type(function(a,b){return a.symbol||c.symbol||"circle"}).stroke(d2b.UTILS.getColor(a.color,"label",[c])),e.style("opacity",1).call(a.point).attr("transform","translate("+a.x(b.x)+","+a.y(b.y)+")")):e.style("opacity",0)})};var b={};return b.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"foreground"),b.background=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"background"),b.general=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"general"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration"),b.x=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"x"),b.y=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"y"),b.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"xFormat"),b.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"yFormat"),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.color=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"color"),b.controls=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"controlsData"),b.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"axisChart"),b.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"tooltip"),b.tooltipSVG=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"tooltipSVG"),b.xValues=function(){var b=[];return a.currentChartData.forEach(function(a){a.values?a.values.forEach(function(a){a.x&&b.push(a.x)}):a.x&&b.push(a.x)}),b},b.yValues=function(){var b=[];return a.currentChartData.forEach(function(a){a.values?a.values.forEach(function(a){a.y&&b.push(a.y)}):a.y&&b.push(a.y)}),b},b.data=function(c){return arguments.length?(a.currentChartData=c,b):a.currentChartData},b.update=function(c){return a.foreground.each(function(b){{var c=d3.select(this),d=b.values||[b],e=c.selectAll("g.d2b-grid-marker").data(d);e.enter().append("g").attr("class","d2b-grid-marker").call(a.newGroup,b)}e.select("g.d2b-grid-marker-x").call(a.updateMarkers,b,"x",!0),e.select("g.d2b-grid-marker-y").call(a.updateMarkers,b,"y",!0),e.select("g.d2b-grid-marker-label").call(a.updateLabel,b,"y",!0);var f=e.select("g.d2b-grid-marker-center");f.call(a.updateCenter,b,!0),e.exit().transition().duration(a.animationDuration).style("opacity",0).remove()}),d3.timer.flush(),c&&c(),b},b},d2b.UTILS.AXISCHART.TYPES.histogram=function(){var a={};a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={},a.xFormat=function(a){return a},a.yFormat=function(a){return a},a.events=d2b.UTILS.chartEvents(),a.hist=d3.layout.histogram(),a.padding="0",a.tooltip=function(b){return a.xFormat(b.data.x)+" - "+a.xFormat(b.data.x+b.data.dx)+": "+a.yFormat(b.data.y)},a.barSignedHeight=function(b){var c,d;return c=a.y(0),d=a.y(b.y),c-d},a.barHeight=function(b){return Math.abs(a.barSignedHeight(b))},a.barY=function(b){var c,d;return c=a.y(0),d=a.y(b.y),Math.min(c,d)};var b={};return b.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"foreground"),b.background=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"background"),b.general=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"general"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration"),b.x=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"x"),b.y=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"y"),b.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"xFormat"),b.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"yFormat"),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.color=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"color"),b.controls=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"controlsData"),b.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"axisChart"),b.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"tooltip"),b.tooltipSVG=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"tooltipSVG"),b.padding=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"padding"),b.xValues=function(){var b=[];return a.currentChartData.forEach(function(a){b=b.concat(a.histData.map(function(a){return a.x}))}),b},b.yValues=function(){var b=[];return a.currentChartData.forEach(function(a){b=b.concat(a.histData.map(function(a){return a.y}))}),b},b.data=function(c){return arguments.length?(a.currentChartData=c,a.currentChartData.forEach(function(b){b.histData=a.hist.bins(b.bins)(b.values)}),b):a.currentChartData},b.update=function(c){return a.background.each(function(b){var c=d3.select(this),d=b.histData.map(function(a){return a.x}),e=[a.x(d3.min(d)),a.x(d3.max(d))],f=1.03*Math.abs(e[0]-e[1])/b.histData.length,g=d2b.UTILS.visualLength(a.padding,f);f-=1*g,c.selectAll("rect");{var h=c.selectAll("rect").data(b.histData,function(a,b){return a.x});h.enter().append("rect").style("fill",d2b.UTILS.getColor(a.color,"label",[b])).attr("y",a.y(0)).attr("height",0).call(a.events.addElementDispatcher,"main","d2b-histogram-bar")}h.call(a.tooltipSVG.graph,{key:b.label,content:a.tooltip,data:function(a){return{data:a,graph:b}},x:function(b){return a.x.invert(a.x(b.x)-g+f/2)},y:function(a){return a.y},fill:d2b.UTILS.getColor(a.color,"label",[b])}).transition().duration(a.animationDuration).style("fill",d2b.UTILS.getColor(a.color,"label",[b])).attr("x",function(b){return a.x(b.x)-g}).attr("width",function(a){return Math.max(0,f)}).attr("y",a.barY).attr("height",a.barHeight),h.exit().transition().duration(a.animationDuration).attr("y",a.y(0)).attr("height",0)}),d3.timer.flush(),c&&c(),b},b},d2b.UTILS.AXISCHART.TYPES.line=function(){var a={};a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={},a.xFormat=function(a){return a},a.yFormat=function(a){return a},a.events=d2b.UTILS.chartEvents(),a.point=d2b.SVG.point().size(40).active(!0).fill("white"),a.line=d3.svg.line().x(function(b){return a.x(b.x)}).y(function(b){return a.y(b.y)}),a.tooltip=function(b){return a.xFormat(b.data.x)+" : "+a.yFormat(b.data.y)};var b={};return b.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"foreground"),b.background=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"background"),b.general=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"general"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration"),b.x=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"x"),b.y=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"y"),b.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"xFormat"),b.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"yFormat"),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.color=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"color"),b.controls=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"controlsData"),b.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"axisChart"),b.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"tooltip"),b.tooltipSVG=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"tooltipSVG"),b.xValues=function(){var b=[];return a.currentChartData.forEach(function(a){b=b.concat(a.values.map(function(a){return a.x}))}),b},b.yValues=function(){var b=[];return a.currentChartData.forEach(function(a){b=b.concat(a.values.map(function(a){return a.y}))}),b},b.data=function(c){return arguments.length?(a.currentChartData=c,b):a.currentChartData},b.update=function(c){return a.background.each(function(b,c){var d=d3.select(this),e=d.select("path");0===e.size()&&(e=d.append("path").call(a.events.addElementDispatcher,"main","d2b-line")),a.line.interpolate(b.interpolate||"linear").tension(b.tension||0),e.style("stroke",d2b.UTILS.getColor(a.color,"label",[b])).datum(function(a){return b.values}).transition().duration(a.animationDuration).attr("d",a.line)}),a.foreground.each(function(b){var c=d3.select(this),d=c.selectAll("g").data(function(a){return a.values});newPoint=d.enter().append("g").attr("transform",function(b){return"translate("+a.x(b.x)+","+a.y(b.y)+")"});var e=d2b.UTILS.getColor(a.color,"label",[b]);a.point.type(function(a,c){return a.symbol||b.symbol||"circle"}).stroke(e),d.call(a.point).call(a.events.addElementDispatcher,"main","d2b-line-point").call(a.tooltipSVG.graph,{key:b.label,content:a.tooltip,data:function(a){return{data:a,graph:b}},x:function(a){return a.x},y:function(a){return a.y},fill:d2b.UTILS.getColor(a.color,"label",[b])}),d.transition().duration(a.animationDuration).attr("transform",function(b){return"translate("+a.x(b.x)+","+a.y(b.y)+")"}),d.exit().transition().duration(a.animationDuration).style("opacity",0).attr("r",0).remove()}),d3.timer.flush(),c&&c(),b},b},d2b.UTILS.AXISCHART.scatter=function(){},d2b.UTILS.AXISCHART.TYPES.template=function(){var a={};a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentChartData={},a.xFormat=function(a){return a},a.yFormat=function(a){return a},a.events=d2b.UTILS.chartEvents(),a.tooltip=function(b){return"<u><b>"+b.graph.label+"</b></u> <br />						<b>x:</b> "+a.xFormat(b.data.x)+"<br />						<b>y:</b> "+a.yFormat(b.data.y)};var b={};return b.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"foreground"),b.background=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"background"),b.general=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"general"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration"),b.x=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"x"),b.y=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"y"),b.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"xFormat"),b.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"yFormat"),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"height"),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.color=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"color"),b.controls=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"controlsData"),b.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"axisChart"),b.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"tooltip"),b.xValues=function(){var a=[];return a},b.yValues=function(){var a=[];return a},b.data=function(c){return arguments.length?(a.currentChartData=c,b):a.currentChartData},b.update=function(c){return a.background.each(function(a){d3.select(this)}),a.foreground.each(function(a){d3.select(this)}),d3.timer.flush(),c&&c(),b},b},d2b.UTILS.AXISCHART.TYPES.template=function(a){var b={};b.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,b.color=d2b.CONSTANTS.DEFAULTCOLOR(),b.currentChartData={},b.xFormat=function(a){return a},b.yFormat=function(a){return a},b.events=d2b.UTILS.chartEvents(),b.tooltip=function(a){return"<u><b>"+a.graph.label+"</b></u> <br />						<b>x:</b> "+b.xFormat(a.data.x)+"<br />						<b>y:</b> "+b.yFormat(a.data.y)};var c={};return c.foreground=d2b.UTILS.CHARTS.MEMBERS.prop(c,b,"foreground"),c.background=d2b.UTILS.CHARTS.MEMBERS.prop(c,b,"background"),c.general=d2b.UTILS.CHARTS.MEMBERS.prop(c,b,"general"),c.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(c,b,"animationDuration"),c.x=d2b.UTILS.CHARTS.MEMBERS.prop(c,b,"x"),c.y=d2b.UTILS.CHARTS.MEMBERS.prop(c,b,"y"),c.xFormat=d2b.UTILS.CHARTS.MEMBERS.prop(c,b,"xFormat"),c.yFormat=d2b.UTILS.CHARTS.MEMBERS.prop(c,b,"yFormat"),c.width=d2b.UTILS.CHARTS.MEMBERS.prop(c,b,"width"),c.height=d2b.UTILS.CHARTS.MEMBERS.prop(c,b,"height"),c.on=d2b.UTILS.CHARTS.MEMBERS.events(c,b),c.color=d2b.UTILS.CHARTS.MEMBERS.prop(c,b,"color"),c.controls=d2b.UTILS.CHARTS.MEMBERS.prop(c,b,"controlsData"),c.axisChart=d2b.UTILS.CHARTS.MEMBERS.prop(c,b,"axisChart"),c.tooltip=d2b.UTILS.CHARTS.MEMBERS.prop(c,b,"tooltip"),c.xValues=function(){if(a&&d2b.UTILS.AXISCHART.TYPES[a].xValues)return d2b.UTILS.AXISCHART.TYPES[a].xValues.call(b,c);var d=[];return d},c.yValues=function(){if(a&&d2b.UTILS.AXISCHART.TYPES[a].yValues)return d2b.UTILS.AXISCHART.TYPES[a].yValues.call(b,c);var d=[];return d},c.data=function(a){return arguments.length?(b.currentChartData=a,c):b.currentChartData},c.update=function(d){return a&&d2b.UTILS.AXISCHART.TYPES[a].update?(d2b.UTILS.AXISCHART.TYPES[a].update.call(b,c),d&&d(),c):(b.background.each(function(a){d3.select(this)}),b.foreground.each(function(a){d3.select(this)}),d3.timer.flush(),d&&d(),c)},c},d2b.UTILS.breadcrumbs=function(){var a,b=d2b.CONSTANTS.DEFAULTWIDTH(),c=(d2b.CONSTANTS.DEFAULTCOLOR(),{items:[]}),d=0,e=0,f=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,g=5,h={elementMouseover:function(){},elementMouseout:function(){},elementClick:function(){}},j={};return j.width=function(a){return arguments.length?(b=a,j):b},j.computedHeight=function(){return e},j.computedWidth=function(){return d},j.selection=function(b){return arguments.length?(a=b,j):a},j.scale=function(a){return arguments.length?(g=a,j):g},j.animationDuration=function(a){return arguments.length?(f=a,j):f},j.on=function(a,b){return a=a.split("."),arguments.length?1==arguments.length?a[1]?h[a[0]][a[1]]:h[a[0]]["default"]:(a[1]?h[a[0]][a[1]]=b:h[a[0]]["default"]=b,j):h},j.data=function(a,b){return arguments.length?(c=a.data,j):c},j.update=function(b){if(!a)return console.warn("breadcrumbs was not given a selection");a.breadcrumb=a.selectAll("g.d2b-breadcrumb").data(c.items,function(a){return a.key?a.key:i});var d=a.breadcrumb.enter().append("g").attr("class","d2b-breadcrumb").style("opacity",0);d.append("path"),d.append("text");var h=g,k=g,l=4*g;a.breadcrumb.text=a.breadcrumb.select("text").text(function(a){return a.label}).attr("x",function(a,b){return 0==b?k+h/2:k+h}).attr("y",2.9*g).style("font-size",2.5*g+"px"),a.breadcrumb.path=a.breadcrumb.select("path");var m=0;return a.breadcrumb.each(function(b,c){var d=d3.select(this);d.text=d.select("text"),d.path=d.select("path");var e=d.text.node().getComputedTextLength()+2*k+h,g=h,i=h;0==c&&(g=0),c==a.breadcrumb.size()-1&&(i=0),d.path.transition().duration(f/2).attr("d","M 0 0 L "+g+" "+l/2+" L 0 "+l+" L "+e+" "+l+" L "+(e+i)+" "+l/2+" L "+e+" 0 L 0 0 Z"),d.transition().duration(f/2).style("opacity",1).attr("transform","translate("+m+",0)"),m+=h+e}),e=l,a.breadcrumb.exit().transition().duration(f/4).style("opacity",0).remove(),j},j},d2b.UTILS.chartAdapter=function(a,b){if(b.chart=new d2b.CHARTS[a],b.properties)for(key in b.properties)b.properties[key].args?b.chart[key].apply(this,b.properties[key].args):b.chart[key](b.properties[key])},d2b.UTILS.chartLayoutAdapter=function(a,b){if(b.chart=new d2b.CHARTS[a],b.chartLayoutData||(b.chartLayoutData={}),b.chartLayout=new d2b.UTILS.CHARTPAGE.chartLayout,b.chartLayout.chart(b.chart).data(b.chartLayoutData),b.properties)for(key in b.properties)b.properties[key].args?b.chart[key].apply(this,b.properties[key].args):b.chart[key](b.properties[key])},d2b.createNameSpace("d2b.UTILS.CHARTS.HELPERS"),d2b.UTILS.CHARTS.HELPERS.updateLegend=function(a){var b=10;a.legend.orientation("right"==a.legendOrientation||"left"==a.legendOrientation?"vertical":"horizontal").data(a.legendData).height(a.innerHeight).width(a.innerWidth).update();var c;c="right"==a.legendOrientation?"translate("+(a.forcedMargin.left+a.innerWidth-a.legend.computedWidth())+","+((a.innerHeight-a.legend.computedHeight())/2+a.forcedMargin.top)+")":"left"==a.legendOrientation?"translate("+a.forcedMargin.left+","+((a.innerHeight-a.legend.computedHeight())/2+a.forcedMargin.top)+")":"top"==a.legendOrientation?"translate("+(a.forcedMargin.left+(a.innerWidth-a.legend.computedWidth())/2)+","+a.forcedMargin.top+")":"translate("+(a.forcedMargin.left+(a.innerWidth-a.legend.computedWidth())/2)+","+(a.innerHeight+a.forcedMargin.top-a.legend.computedHeight())+")",a.selection.legend.transition().duration(a.animationDuration).attr("transform",c);var d;d="right"==a.legendOrientation||"left"==a.legendOrientation?a.legend.computedWidth():a.legend.computedHeight(),d&&(d+=b),a.forcedMargin[a.legendOrientation]+=d,a.innerHeight=a.outerHeight-a.forcedMargin.top-a.forcedMargin.bottom,a.innerWidth=a.outerWidth-a.forcedMargin.left-a.forcedMargin.right},d2b.UTILS.CHARTS.HELPERS.updateControls=function(a){var b=10,c=d2b.UTILS.getValues(a.controlsData).filter(function(a){return a.visible});c.map(function(a){a.data={state:a.enabled,label:a.label,key:a.key}}),a.controls.data(c).width(a.innerWidth).update(),a.selection.controls.transition().duration(a.animationDuration).attr("transform","translate("+(a.forcedMargin.left+a.innerWidth-a.controls.computedWidth())+","+a.forcedMargin.top+")");var d=a.controls.computedHeight();d&&(d+=b),a.forcedMargin.top+=d,a.innerHeight=a.outerHeight-a.forcedMargin.top-a.forcedMargin.bottom},d2b.UTILS.CHARTS.HELPERS.updateDimensions=function(a){a.outerWidth=a.outerWidth-a.forcedMargin.right-a.forcedMargin.left,a.outerHeight=a.outerHeight-a.forcedMargin.top-a.forcedMargin.bottom,a.forcedMargin={top:0,bottom:0,left:0,right:0},a.innerWidth=a.outerWidth,a.innerHeight=a.outerHeight},d2b.UTILS.CHARTS.HELPERS.generateDefaultSVG=function(a){a.selection.selectAll("*").remove(),a.selection.svg=a.selection.append("svg").attr("class","d2b-svg d2b-container"),a.forcedMargin=d2b.CONSTANTS.DEFAULTFORCEDMARGIN(),a.selection.group=a.selection.svg.append("g").attr("transform","translate("+a.forcedMargin.left+","+a.forcedMargin.top+")"),a.selection.legend=a.selection.group.append("g").attr("class","d2b-legend"),a.selection.controls=a.selection.group.append("g").attr("class","d2b-controls")},d2b.UTILS.CHARTPAGE.chartLayout=function(){var a,b,c=d2b.CONSTANTS.DEFAULTWIDTH(),d=d2b.CONSTANTS.DEFAULTHEIGHT(),e={chartLayout:{}},f=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,g=!0,h={};return h.chart=function(a){return arguments.length?(b=a,g=!0,h):b},h.width=function(a){return arguments.length?(c=a,h):c},h.height=function(a){return arguments.length?(d=a,h):d},h.selection=function(b){return arguments.length?(a=b,g=!0,h):a},h.select=function(b){return arguments.length?(a=d3.select(b),g=!0,h):a},h.animationDuration=function(a){return arguments.length?(f=a,b.animationDuration(f),h):f},h.data=function(a,b){
return arguments.length?(b&&(e={chartLayout:{}},g=!0),a.data.chartLayout.footnote&&(e.chartLayout.footnote=a.data.chartLayout.footnote),a.data.chartLayout.rightNotes&&(e.chartLayout.rightNotes=a.data.chartLayout.rightNotes),a.data.chartLayout.leftNotes&&(e.chartLayout.leftNotes=a.data.chartLayout.leftNotes),a.data.chartLayout.title&&(e.chartLayout.title=a.data.chartLayout.title),a.data.chartLayout.titleAlt&&(e.chartLayout.titleAlt=a.data.chartLayout.titleAlt),a.data.chartCallback&&(e.chartCallback=a.data.chartCallback),a.data.chartLayout.info&&(e.chartLayout.info=a.data.chartLayout.info),h):e},h.generate=function(c){a.selectAll("*").remove(),a.wrapper=a.append("div").attr("class","d2b-chart-layout-wrapper"),a.container=a.wrapper.append("div").attr("class","d2b-chart-layout d2b-container"),a.container.header=a.container.append("div").attr("class","d2b-chart-layout-header"),a.container.header.title=a.container.header.append("div").attr("class","d2b-chart-layout-title"),a.container.header.titleAlt=a.container.header.append("div").attr("class","d2b-chart-layout-title-alt"),a.container.header.infoIcon=a.container.header.append("div").attr("class","d2b-chart-layout-info-icon"),a.container.info=a.container.append("div").attr("class","d2b-chart-layout-info"),a.container.chart=a.container.append("div").attr("class","d2b-chart-layout-chart"),b.selection(a.container.chart),a.container.rightNotes=a.container.append("div").attr("class","d2b-chart-layout-right-notes"),a.container.rightNotes.ul=a.container.rightNotes.append("ul"),a.container.leftNotes=a.container.append("div").attr("class","d2b-chart-layout-left-notes"),a.container.leftNotes.ul=a.container.leftNotes.append("ul"),a.container.footnote=a.container.append("div").attr("class","d2b-chart-layout-footnote"),a.container.footnote.div=a.container.footnote.append("div"),a.container.source=a.container.append("div").attr("class","d2b-chart-layout-source").append("ul"),g=!1;var d=f;return h.animationDuration(0).update(c).animationDuration(d),h},h.update=function(i){if(!a)return console.warn("chartLayout was not given a selection");if(!b)return console.warn("chartLayout was not given a chart");if(g)return h.generate(i);var j={top:10,bottom:0,left:0,right:0};a.wrapper.style("width",c+"px").style("height",d+"px"),a.container.header.title.text(e.chartLayout.title),a.container.header.titleAlt.text(e.chartLayout.titleAlt);var k=a.container.header.node().getBoundingClientRect().height;e.chartLayout.title?(a.container.header.style("opacity",1),j.top+=k):a.container.header.style("opacity","0"),e.chartLayout.info?(a.container.header.infoIcon.html('<i class="fa fa-info-circle"></i>').on("click",function(){a.container.info.classed("d2b-visible",!a.container.info.classed("d2b-visible"))}),a.container.info.html(e.chartLayout.info).style("top",k+"px").style("height",d-k+"px")):(a.container.header.infoIcon.selectAll("*").on("click.d2b-click",null).remove(),a.container.info.selectAll("*").remove()),a.container.footnote.div.text(e.chartLayout.footnote),j.bottom+=a.container.footnote.node().getBoundingClientRect().height,a.container.footnote.style("top",d-j.bottom+"px"),!e.chartLayout.rightNotes||e.chartLayout.rightNotes.length<1?e.chartLayout.rightNotes=[]:j.right+=.2*c+5;var l=a.container.rightNotes.ul.selectAll("li.d2b-chart-layout-note").data(e.chartLayout.rightNotes);l.enter().append("li").attr("class","d2b-chart-layout-note").append("div");var m=0;l.select("div").text(function(a){return a}).each(function(a){m+=this.getBoundingClientRect().height}),l.exit().style("opacity",0).remove(),a.container.rightNotes.style("width",.2*c+"px").style("height",d-j.top+"px").style("left",.8*c-5+"px"),l.style("padding-top",Math.max(10,(d-m)/(1.8*l.size()))+"px"),!e.chartLayout.leftNotes||e.chartLayout.leftNotes.length<1?e.chartLayout.leftNotes=[]:j.left+=.2*c;var n=a.container.leftNotes.ul.selectAll("li.d2b-chart-layout-note").data(e.chartLayout.leftNotes);n.enter().append("li").attr("class","d2b-chart-layout-note").append("div");var o=0;n.select("div").text(function(a){return a}).each(function(a){o+=this.getBoundingClientRect().height}),n.exit().style("opacity",0).remove(),a.container.leftNotes.style("width",.2*c+"px").style("left","5px"),n.style("padding-top",Math.max(10,(d-o)/(1.8*n.size()))+"px");var p=c-j.left-j.right-10,q=d-j.top-j.bottom;return a.container.chart.style("left",j.left+5+"px").style("top",j.top+"px").style("width",p+"px").style("height",q+"px"),b.width(p).height(q).animationDuration(f).update(e.chartCallback),d3.timer.flush(),i&&i(),h},h},d2b.createNameSpace("d2b.UTILS.CHARTS.MEMBERS"),d2b.UTILS.CHARTS.MEMBERS.events=function(a,b,c){return function(d,e){var f=d.split("-");return"element"==f[0]?b.events.addElementListener("main",d,e):b.events.addListener(d,e),c&&c(d,e),a}},d2b.UTILS.CHARTS.MEMBERS.select=function(a,b,c){return function(d){return b.selection=d3.select(d),c&&c(d),a}},d2b.UTILS.CHARTS.MEMBERS.prop=function(a,b,c,d){return function(e){return arguments.length?(b[c]=e,d&&d(e),a):b[c]}},d2b.UTILS.CHARTS.MEMBERS.format=function(a,b,c,d){return function(e){return arguments.length?(b[c]=d2b.UTILS.numberFormat(e),d&&d(e),a):b[c]}},d2b.UTILS.CHARTS.MEMBERS.controls=function(a,b,c){return function(d){if(!arguments.length)return b.controlsData;for(control in d)for(controlProp in d[control])b.controlsData[control][controlProp]=d[control][controlProp];return c&&c(d),a}},d2b.UTILS.chartPage=function(){var a={};a.width=d2b.CONSTANTS.DEFAULTWIDTH(),a.selection,a.currentData={},a.modifiedData={},a.computedHeight=0,a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.animateFrom=null,a.events=d2b.UTILS.chartEvents(),a.init=function(b){(a.animateFrom||!a.selection.currentPage)&&(a.selection.selectAll(".d2b-chart-page").classed("d2b-chart-page-old",!0),a.selection.currentPage=a.selection.append("div").attr("class","d2b-chart-page").style("left",b.left+"px").style("top",b.top+"px"))},a.updateGrid=function(b){{var c=a.selection.currentPage.selectAll("div.d2b-page-chart-layout").data(b,function(a,b){return a.chart.key||b});c.enter().append("div").attr("class","d2b-page-chart-layout").each(function(b){d2b.UTILS.chartLayoutAdapter(b.chart.type,b.chart),this.chart=b.chart.chart,this.chartLayout=b.chart.chartLayout,this.chartLayout.select(this).width(a.width*b.width).height(b.height).animationDuration(0)})}c.each(function(b){this.chart.data(b.chart.properties.data),this.chartLayout.animationDuration(a.animationDuration).width(a.width*b.width).update(b.chart.chartLayoutData.chartCallback)}).style("left",function(b){return a.width*b.x+"px"}).style("top",function(a){return a.y+"px"}).each(function(b){a.computedHeight=Math.max(a.computedHeight,b.y+b.height)}),c.exit().transition().duration(a.animationDuration).remove(),a.selection.currentPage.transition().duration(a.animationDuration).style("left","0px").style("top","0px")};var b={};a.getPosition=function(){var b={top:0,left:0};switch(a.animateFrom){case"right":b.top=0,b.left=a.width;break;case"left":b.top=0,b.left=-a.width;break;case"top":b.top=-a.computedHeight,b.left=0;break;case"bottom":b.top=a.computedHeight,b.left=0}return b};var b={};return b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.width=function(c){return arguments.length?(a.width=c,b):a.width},b.computedHeight=function(){return a.computedHeight},b.selection=function(c){return arguments.length?(a.selection=c,b):a.selection},b.select=function(c){return arguments.length?(a.selection=d3.select(c),b):a.selection},b.animationDuration=function(c){return arguments.length?(a.animationDuration=c,b):a.animationDuration},b.animateFrom=function(c){return arguments.length?(a.animateFrom=c,b):a.animateFrom},b.data=function(c,d){return arguments.length?(a.currentData=c,a.currentData.charts||(a.currentData.charts=[]),a.currentData.controls||(a.currentData.controls=[]),b):a.currentData},b.update=function(c){if(!a.selection)return console.warn("page was not given a selection");var d=a.getPosition();if(a.animateFrom&&a.selection.currentPage&&(a.selection.oldPage=a.selection.currentPage),a.init(d),a.computedHeight=0,a.currentData.charts.length<1&&!a.currentData.url)console.warn("chart page was not provided any charts or url");else{a.modifiedData.charts=a.currentData.charts,a.modifiedData.controls=a.currentData.controls;var e={controls:{}};if(a.currentData.controls.forEach(function(a){e.controls[a.key]=a}),e.sectionName=a.currentData.sectionName,e.categoryName=a.currentData.categoryName||a.currentData.name,e.pageName=a.currentData.name,a.currentData.url){var f=d3.xhr(a.currentData.url+".json");f.post(JSON.stringify(e),function(b,c){var d=JSON.parse(c.response);d.charts&&(a.modifiedData.charts=d.charts.concat(a.modifiedData.charts)),a.updateGrid(a.modifiedData.charts)})}else a.updateGrid(a.modifiedData.charts)}return a.selection.selectAll(".d2b-chart-page-old").transition().duration(a.animationDuration).style("opacity",0).style("left",-d.left+"px").style("top",-d.top+"px").remove(),d3.timer.flush(),c&&c(),a.events.dispatch("update",a.selection,[a.modifiedData]),b},b},d2b.createNameSpace("d2b.UTILS.CONTROLS"),d2b.UTILS.CONTROLS.checkbox=function(){var a={};a.scale=5,a.selection,a.container,a.computedWidth=0,a.computedHeight=0,a.currentData={label:"",state:!1},a.events=d2b.UTILS.chartEvents();var b={};return b.scale=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"scale"),b.select=d2b.UTILS.CHARTS.MEMBERS.select(b,a),b.selection=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"selection"),b.container=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"container"),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.checked=function(c){return arguments.length?(a.currentData.state=c,b.update()):a.currentData.state},b.computedHeight=function(){return a.computedHeight},b.computedWidth=function(){return a.computedWidth},b.data=function(c,d){return arguments.length?(a.currentData=c,b):a.currentData},b.update=function(c){if(!a.selection&&!a.container)return console.warn("checkbox was not given a selection or html container"),b;if(!a.currentData)return console.warn("checkbox data is null"),b;a.selection||(a.selection=a.container.append("svg"),a.container.svg=a.selection);var d=a.selection.selectAll("g.d2b-checkbox-container").data([a.currentData]),e=d.enter().append("g").attr("class","d2b-checkbox-container").on("click.d2b-click",function(c,d){a.currentData.state=!a.currentData.state,a.events.dispatch("change",this,[c,d]),b.update()}).call(a.events.addElementDispatcher,"main","d2b-checkbox");e.append("rect").attr("rx",1),e.append("path"),e.append("text").text(function(a){return a.label});var f="translate("+.4*a.scale+","+.4*a.scale+")",g=d.select("path").attr("transform",f).attr("d","M"+.38*a.scale+","+1.06*a.scale+" l"+.7*a.scale+","+.5*a.scale+" l"+.58*a.scale+","+-1.19*a.scale).style("stroke-width",.25*a.scale).attr("stroke-dasharray",2.2*a.scale);g.transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("stroke-dashoffset",a.currentData.state?0:2.2*a.scale);var h=(d.select("rect").attr("width",2.1*a.scale+"px").attr("height",2.1*a.scale+"px").attr("transform",f).style("stroke-width",.25*a.scale),d.select("text").attr("y",2.4*a.scale).attr("x",3.2*a.scale).style("font-size",2.5*a.scale+"px")),i=h.node().getComputedTextLength(),j=a.scale;return i+=j,a.computedWidth=i+2.5*a.scale,a.computedHeight=2.9*a.scale,a.container&&a.container.svg&&a.container.svg.attr("width",a.computedWidth).attr("height",a.computedHeight),c&&c(),b},b},d2b.UTILS.CONTROLS.radioButtons=function(){var a={};a.scale=5,a.container,a.selection,a.computedWidth=0,a.computedHeight=0,a.currentData={label:"",values:[],selected:null},a.events=d2b.UTILS.chartEvents(),a.resetValues=function(){a.currentData.values.forEach(function(a){a.selected=!1})};var b={};return b.scale=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"scale"),b.select=d2b.UTILS.CHARTS.MEMBERS.select(b,a),b.selection=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"selection"),b.container=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"container"),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.computedHeight=function(){return a.computedHeight},b.computedWidth=function(){return a.computedWidth},b.data=function(c,d){if(!arguments.length)return a.currentData;a.currentData=c;var e=!1;return a.currentData.values.forEach(function(b){e&&(b.selected=!1),b.selected&&(a.currentData.selected=b,e=!0)}),e||(a.currentData.selected=a.currentData.values[0],a.currentData.values[0].selected=!0),b},b.update=function(c){if(!a.selection&&!a.container)return console.warn("radio buttons was not given a selection or html container"),b;if(!a.currentData)return console.warn("radio buttons data is null"),b;a.selection||(a.selection=a.container.append("svg"),a.container.svg=a.selection);var d=a.selection.selectAll("g.d2b-radio-button-container").data(a.currentData.values,function(a){return a.label}),e=d.enter().append("g").attr("class","d2b-radio-button-container").on("click.d2b-click",function(c,d){a.resetValues(),c.selected=!0,a.currentData.selected=c,a.events.dispatch("change",a.selection.node(),[a.currentData,d]),b.update()}).call(a.events.addElementDispatcher,"main","d2b-radio-button");d.attr("transform",function(b,c){return"translate(0,"+3.3*c*a.scale+")"}),e.append("circle").attr("class","d2b-radio-button-inner").style("fill-opacity",0),e.append("circle").attr("class","d2b-radio-button-outer"),e.append("text").text(function(a){return a.label});{var f=d.select("circle.d2b-radio-button-inner").attr("cy",1.4*a.scale).attr("cx",1.4*a.scale);d.select("circle.d2b-radio-button-outer").attr("r",1*a.scale+"px").attr("cy",1.4*a.scale).attr("cx",1.4*a.scale).style("stroke-width",.25*a.scale)}f.transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).style("fill-opacity",function(a){return a.selected?1:0}).attr("r",function(b){return b.selected?.5*a.scale:0});var g=d.select("text").attr("y",2.4*a.scale).attr("x",3.2*a.scale).style("font-size",2.5*a.scale+"px"),h=0;return g.each(function(){h=Math.max(h,this.getComputedTextLength())}),a.computedWidth=h+3.4*a.scale,a.computedHeight=a.currentData.values.length*a.scale*3.2,a.container&&a.container.svg&&a.container.svg.attr("width",a.computedWidth).attr("height",a.computedHeight),c&&c(),b},b},d2b.UTILS.CONTROLS.htmlControls=function(){var a={};a.maxWidth=d2b.CONSTANTS.DEFAULTWIDTH(),a.currentData,a.computedWidth=0,a.computedHeight=0,a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.controlsHash={},a.selection,a.scale=5,a.makeControlsHash=function(){a.controlsHash={},a.currentData.controls.forEach(function(b){a.controlsHash[b.key]=b})},a.events=d2b.UTILS.chartEvents();var b={};return b.select=d2b.UTILS.CHARTS.MEMBERS.select(b,a),b.width=function(c){return arguments.length?(a.maxWidth=c,b):a.maxWidth},b.computedHeight=function(){return a.computedHeight},b.computedWidth=function(){return a.computedWidth},b.selection=function(c){return arguments.length?(a.selection=c,b):a.selection},b.scale=function(c){return arguments.length?(a.scale=c,b):a.scale},b.animationDuration=function(c){return arguments.length?(a.animationDuration=c,b):a.animationDuration},b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.data=function(c,d){return arguments.length?(a.currentData=c,a.makeControlsHash(),b):a.currentData},b.update=function(c){if(!a.selection)return console.warn("controls was not given a selection");a.selection.controlContainer=a.selection.selectAll("div.d2b-control-container").data(a.currentData.controls,function(a){return a.type+"-"+a.key});var d=a.selection.controlContainer.enter().append("div").attr("class","d2b-control-container");return d.append("div").attr("class","d2b-control-label").text(function(a){return a.label+":"}),d.append("div").attr("class","d2b-control").each(function(a){this.control=new d2b.UTILS.CONTROLS[a.type],this.control.container(d3.select(this))}),a.selection.controlContainer.control=a.selection.controlContainer.select(".d2b-control").each(function(b){this.control.scale(a.scale).data(b).on("change.d2b-change",function(b,c){a.events.dispatch("change",a.selection,[a.controlsHash,b,c])}).update()}),a.selection.controlContainer.exit().remove(),b},b},d2b.UTILS.CONTROLS.controls=function(){var a={};a.maxWidth=d2b.CONSTANTS.DEFAULTWIDTH(),a.currentData,a.computedWidth=0,a.computedHeight=0,a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.events=d2b.UTILS.chartEvents(),a.selection,a.scale=5;var b={};return b.scale=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"scale"),b.select=d2b.UTILS.CHARTS.MEMBERS.select(b,a),b.selection=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"selection"),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"width"),b.computedHeight=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"computedHeight"),b.computedWidth=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"computedWidth"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration"),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.data=function(c,d){return arguments.length?(a.currentData=c,b):a.currentData},b.update=function(b){if(!a.selection)return console.warn("controls was not given a $$.selection");var c=3*a.scale,d=a.scale;if(a.computedHeight=0,a.computedWidth=0,a.currentData.length>0){var e=a.selection.selectAll("g.d2b-control").data(a.currentData,function(a){return a.label+","+a.type});e.enter().append("g").attr("class","d2b-control").each(function(b){b.control=(new d2b.UTILS.CONTROLS[b.type]).selection(d3.select(this)),a.events.translateEvents(b.control)});var f=0,g=0;e.each(function(b){b.control.scale(a.scale).data(b.data).update(),a.computedWidth+b.control.computedWidth()>a.maxWidth&&(a.computedWidth=0,a.computedHeight+=f+d,f=0),d3.select(this).transition().duration(a.animationDuration).style("opacity",1).attr("transform","translate("+a.computedWidth+","+a.computedHeight+")"),a.computedWidth+=b.control.computedWidth()+c,f<b.control.computedHeight()&&(f=b.control.computedHeight()),g<a.computedWidth&&(g=a.computedWidth)}),a.computedWidth=g-c,a.computedHeight+=f,e.exit().transition().duration(a.animationDuration).style("opacity",0).remove()}return e},b},d2b.UTILS.dashboardCategory=function(){var a={};a.width=d2b.CONSTANTS.DEFAULTWIDTH(),a.selection,a.chartPageSelection,a.currentData,a.computedHeight=0,a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.animateFrom=null,a.charts=[],a.events=d2b.UTILS.chartEvents(),a.init=function(b){(a.animateFrom||!a.selection.currentCategory)&&(a.currentPageIndex=0,a.selection.selectAll(".d2b-category").classed("d2b-category-old",!0),a.selection.currentCategory=a.selection.append("div").attr("class","d2b-category").style("left",b.left+"px").style("top",b.top+"px"),a.selection.currentCategory.label=a.selection.currentCategory.append("div").attr("class","d2b-category-label"),a.selection.currentCategory.label.section=a.selection.currentCategory.label.append("div").attr("class","d2b-category-label-section"),a.selection.currentCategory.label.category=a.selection.currentCategory.label.append("div").attr("class","d2b-category-label-category"),a.selection.currentCategory.label.pages=a.selection.currentCategory.label.append("div").attr("class","d2b-category-label-pages"),a.chartPageSelection=a.selection.chartPage=a.selection.currentCategory.append("div").attr("class","d2b-chart-page-container"),a.currentData.pages.length>0?(pageData=a.currentData.pages[0],a.selection.currentCategory.label.pages.style("display","")):(pageData=a.currentData,a.selection.currentCategory.label.pages.style("display","none")),a.events.dispatch("page-change",a.selection,[pageData,0,0]))},a.getPosition=function(){var b={top:0,left:0};switch(a.animateFrom){case"right":b.top=0,b.left=a.width;break;case"left":b.top=0,b.left=-a.width;break;case"top":b.top=-a.computedHeight,b.left=0;break;case"bottom":b.top=a.computedHeight,b.left=0}return b};var b={};return b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.chartPageSelection=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"chartPageSelection"),b.width=function(c){return arguments.length?(a.width=c,b):a.width},b.computedHeight=function(){return a.computedHeight},b.selection=function(c){return arguments.length?(a.selection=c,b):a.selection},b.select=function(c){return arguments.length?(a.selection=d3.select(c),b):a.selection},b.animationDuration=function(c){return arguments.length?(a.animationDuration=c,b):a.animationDuration},b.animateFrom=function(c){return arguments.length?(a.animateFrom=c,b):a.animateFrom},b.data=function(c,d){return arguments.length?(a.currentData=c.data,a.currentData.pages||(a.currentData.pages=[]),b):a.currentData},b.update=function(c){if(!a.selection)return console.warn("category was not given a $$.selection");var d=a.getPosition();return a.animateFrom&&a.selection.currentCategory&&(a.selection.oldCategory=a.selection.currentCategory),a.init(d),a.computedHeight=0,a.selection.currentCategory.label.section.text(a.currentData.sectionName),a.selection.currentCategory.label.category.text(a.currentData.name),a.selection.currentCategory.label.pages.tab=a.selection.currentCategory.label.pages.selectAll(".d2b-page-tab").data(a.currentData.pages),a.selection.currentCategory.label.pages.tab.enter().append("div").attr("class","d2b-page-tab").text(function(a){return a.name}).each(function(a,b){d3.select(this).classed("d2b-tab-selected",!b)}),a.selection.currentCategory.label.pages.tab.on("click",function(b,c){a.selection.currentCategory.label.pages.tab.classed("d2b-tab-selected",!1),d3.select(this).classed("d2b-tab-selected",!0),a.events.dispatch("page-change",a.selection,[b,a.currentPageIndex,c]),a.currentPageIndex=c}),a.selection.selectAll(".d2b-category-old").transition().duration(a.animationDuration).style("opacity",0).style("left",-d.left+"px").style("top",-d.top+"px").remove(),a.selection.currentCategory.transition().duration(a.animationDuration).style("opacity",1).style("left","0px").style("top","0px"),d3.timer.flush(),a.events.dispatch("update",a.selection),c&&c(),b},b},d2b.UTILS.customEvents=function(){var a={};return a.events={},{addListener:function(b,c){var b=b.split("."),d=b[0],e=b[1];a.events[d]||(a.events[d]={}),a.events[d][e]=c},dispatch:function(b,c,d){for(var e in a.events[b])a.events[b][e]&&a.events[b][e].apply(c,d)},events:function(){return a.events}}},d2b.UTILS.chartEvents=function(){var a={};a.elementDispatchers={},a.elementListeners={},a.setElementEvents=function(a,b,c,d,e){var f;f=c?function(){var a=Array.prototype.slice.call(arguments);a.unshift(e),c.apply(this,a)}:null,a.on(b.split("-")[1]+"."+d+".d2b-element-event",f)};var b=d2b.UTILS.customEvents();return b.addElementListener=function(b,c,d){a.elementListeners[c]=d;for(var e in a.elementDispatchers[b])a.setElementEvents(a.elementDispatchers[b][e].selection,c,d,b,a.elementDispatchers[b][e].type)},b.addElementDispatcher=function(b,c,d){a.elementDispatchers[c]=a.elementDispatchers[c]||{},a.elementDispatchers[c][d]={selection:b,type:d.split(".")[0]};for(var e in a.elementListeners)a.setElementEvents(b,e,a.elementListeners[e],c,a.elementDispatchers[c][d].type)},b.allEvents=function(c){var d=[],e=b.events();for(var f in e)for(var g in e[f])d.push({key:f+"."+g,listener:e[f][g]});for(var f in a.elementListeners)d.push({key:f,listener:a.elementListeners[f]});return d},b.translateEvents=function(a){b.allEvents().forEach(function(b){a.on(b.key,b.listener)})},b},Function.prototype.clone=function(){var a=this,b=function(){return a.apply(this,arguments)};for(var c in this)this.hasOwnProperty(c)&&(b[c]=this[c]);return b},d2b.number=function(a){return null===a?0/0:+a},d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},Array.prototype._reverse=function(){var a=[];return Array.prototype.push.apply(a,this),a.reverse()},d2b.UTILS.visualLength=function(a,b){return a.toString().indexOf("%")>-1?b*parseFloat(a)/100:parseFloat(a)},d2b.UTILS.defined=function(a){return null!=a&&void 0!=a},d2b.UTILS.applyProperties=function(a){for(var b in a)this[b](a[b]);for(b in a)null!=a[b]&&a[b].args?this[b].apply(this,a[b].args):this[b](a[b])},d2b.UTILS.checkNested=function(a){for(var b=Array.prototype.slice.call(arguments,1),c=0;c<b.length;c++){if(!a||!a.hasOwnProperty(b[c]))return!1;a=a[b[c]]}return!0},d2b.UTILS.getColor=function(a,b,c,d){return c=c||[],function(e){var f=c.slice(0);f.push(e),d||(f=f.reverse());for(var g=0;g<f.length;g++)if(f[g].colorKey)return a(f[g].colorKey);return a(f[f.length-1][b])}},d2b.UTILS.scrollOffset=function(){var a=document.documentElement,b=(window.pageXOffset||a.scrollLeft)-(a.clientLeft||0),c=(window.pageYOffset||a.scrollTop)-(a.clientTop||0);return{top:c,left:b}},d2b.UTILS.getValues=function(a){var b=[];for(var c in a)a[c].key=c,b.push(a[c]);return b},d2b.UTILS.niceFormat=function(a,b){b||(b=0);var c=d3.format("."+b+"f");return absValue=Math.abs(a),isNaN(a)?a:absValue<Math.pow(10,3)?c(absValue):absValue<Math.pow(10,6)?c(absValue/Math.pow(10,3))+" thousand":absValue<Math.pow(10,9)?c(absValue/Math.pow(10,6))+" million":absValue<Math.pow(10,12)?c(absValue/Math.pow(10,9))+" billion":absValue<Math.pow(10,15)?c(absValue/Math.pow(10,12))+" trillion":absValue<Math.pow(10,18)?c(absValue/Math.pow(10,15))+" quadrillion":absValue<Math.pow(10,21)?c(absValue/Math.pow(10,18))+" quintillion":absValue<Math.pow(10,24)?c(absValue/Math.pow(10,21))+" sextillion":absValue<Math.pow(10,27)?c(absValue/Math.pow(10,24))+" septillion":absValue<Math.pow(10,30)?c(absValue/Math.pow(10,27))+" octillion":absValue<Math.pow(10,33)?c(absValue/Math.pow(10,30))+" nonillion":absValue<Math.pow(10,36)?c(absValue/Math.pow(10,33))+" decillion":absValue<Math.pow(10,39)?c(absValue/Math.pow(10,36))+" undecillion":absValue<Math.pow(10,42)?c(absValue/Math.pow(10,39))+" duodecillion":absValue<Math.pow(10,45)?c(absValue/Math.pow(10,42))+" tredecillion":absValue<Math.pow(10,48)?c(absValue/Math.pow(10,45))+" quattuordecillion":absValue<Math.pow(10,51)?c(absValue/Math.pow(10,48))+" quindecillion":absValue<Math.pow(10,54)?c(absValue/Math.pow(10,51))+" sexdecillion":absValue<Math.pow(10,57)?c(absValue/Math.pow(10,54))+" septendecillion":absValue<Math.pow(10,60)?c(absValue/Math.pow(10,57))+" octdecillion":absValue<Math.pow(10,63)?c(absValue/Math.pow(10,60))+" novemdecillion":absValue<Math.pow(10,303)?c(absValue/Math.pow(10,63))+" vigintillion":c(absValue/Math.pow(10,303))+" centillion"},d2b.UTILS.numberFormat=function(a){var b,c,d="";return c=a.units?{before:a.units.before?a.units.before:"",after:a.units.after?a.units.after:""}:{before:"",after:""},a.nice?function(b){return c.before+d2b.UTILS.niceFormat(b,a.precision)+c.after}:(a.siPrefixed?(a.precision>-1&&(d+="."+a.precision),d+="s"):(a.separateThousands&&(d+=","),a.precision>-1&&(d+="."+a.precision+"f")),b=d3.format(d),function(a){return isNaN(a)?c.before+a+c.after:c.before+b(a)+c.after})},d2b.UTILS.textWrap=function(a,b){a.each(function(){for(var a,c=d3.select(this),d=c.text().split(/\s+/).reverse(),e=[],f=0,g=1.1,h=c.attr("y"),i=parseFloat(c.attr("dy"))||0,j=c.text(null).append("tspan").attr("x",0).attr("y",h).attr("dy",i+"em");a=d.pop();)e.push(a),j.text(e.join(" ")),j.node().getComputedTextLength()>b&&(e.pop(),j.text(e.join(" ")),e=[a],j=c.append("tspan").attr("x",0).attr("y",h).attr("dy",++f*g+i+"em").text(a))})},d2b.createNameSpace("d2b.UTILS.TWEENS"),d2b.UTILS.TWEENS.arcTween=function(a,b){a.attrTween("d",function(a){function c(a){return d.oldArc=e(a),b(d.oldArc)}var d=this;d.oldArc=d.oldArc||d.newArc;var e=d3.interpolate(d.oldArc,d.newArc);return c})},d2b.UTILS.grid=function(a,b,c){var d=a/b,e={};return e.columns=Math.min(c,Math.max(1,Math.round(Math.sqrt(c)*d))),e.rows=Math.ceil(c/e.columns),e},d2b.UTILS.domain=function(a,b,c){var d=[];return b&&b.rangeBand?(d=d3.set(a).values(),c=null):d=0==a.length?[0,1]:1==a.length?[a[0]/2,1.5*a[0]]:d3.extent(a),c&&(d[0]-=c[0],d[1]+=c[1]),d},d2b.createNameSpace("d2b.UTILS.LAYOUTS"),d2b.UTILS.LAYOUTS.partition=function(){var a={};a.group=function(b,c){var d,e=c.shift(),f={},g=[];b.forEach(function(a){d=f[a[e.column]]=f[a[e.column]]||{allChildren:[]},d.allChildren.push(a)});for(key in f)d=f[key],d.name=key,d.top=e.top,c.length>0&&(d.children=a.group(d.allChildren,c.slice(0))),0==c.length&&(d.size=d3.sum(d.allChildren,function(a){return a.count})),d.name?g.push(d):g=g.concat(d.children);return g};var b=function(b,c,d){return{name:d,top:!0,children:a.group(b,c.slice(0))}};return b},d2b.createNameSpace("d2b.UTILS.LEGENDS"),d2b.UTILS.LEGENDS.legend=function(){var a={};a.maxWidth=d2b.CONSTANTS.DEFAULTWIDTH(),a.maxHeight=d2b.CONSTANTS.DEFAULTHEIGHT(),a.color=d2b.CONSTANTS.DEFAULTCOLOR(),a.currentLegendData,a.computedWidth=0,a.computedHeight=0,a.animationDuration=d2b.CONSTANTS.ANIMATIONLENGTHS().normal,a.orientation="horizontal",a.padding=5,a.active=!1,a.scale=5,a.events=d2b.UTILS.chartEvents(),a.getPathForeground=function(b){var c=Math.pow(a.scale/1.7,1.5);return b.open?b.path.size(4*c)(b):b.path.size(15*c)(b)},a.getPathBackground=function(b){var c=Math.pow(a.scale/1.7,1.5);return b.open||!b.hovered?b.path.size(15*c)(b):b.hovered?b.path.size(35*c)(b):void 0},a.enterElements=function(){a.computedHeight=0,a.computedWidth=0,a.innerMaxHeight=a.maxHeight-2*a.padding,a.innerMaxWidth=a.maxWidth-2*a.padding,a.selection.item=a.selection.selectAll("g.d2b-legend-item").data(a.currentLegendData.items,function(a){return a.label});var b=a.selection.item.enter().append("g").attr("class","d2b-legend-item").style("opacity",0).on("mouseover.d2b-mouseover",function(b,c){b.hovered=!0;var d=d3.select(this);a.active&&(b.open?d.select("path.d2b-legend-symbol-foreground").transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).style("fill-opacity",.4):d.select("path.d2b-legend-symbol-background").transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("d",a.getPathBackground(b)))}).on("mouseout.d2b-mouseout",function(b,c){b.hovered=!1;var d=d3.select(this);d.select("path.d2b-legend-symbol-foreground").transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).style("fill-opacity",function(a){return a.open?0:.8}),d.select("path.d2b-legend-symbol-background").transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("d",a.getPathBackground(b))}).call(a.events.addElementDispatcher,"main","d2b-legend-item");b.append("path").attr("class","d2b-legend-symbol-background").style("stroke",d2b.UTILS.getColor(a.color,"label")),b.append("path").attr("class","d2b-legend-symbol-foreground").style("fill",d2b.UTILS.getColor(a.color,"label")),b.append("text").text(function(a){return a.label})},a.updateElements=function(){var b=a.selection.item.select("path.d2b-legend-symbol-background");b.transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).style("stroke",d2b.UTILS.getColor(a.color,"label")).style("stroke-width",1).attr("transform","translate(0,"+a.scale/10+")").attr("d",function(b){return a.getPathBackground(b)});var c=a.selection.item.select("path.d2b-legend-symbol-foreground");c.transition().duration(d2b.CONSTANTS.ANIMATIONLENGTHS()["short"]).attr("transform","translate(0,"+a.scale/10+")").style("fill",d2b.UTILS.getColor(a.color,"label")).style("fill-opacity",function(a){return a.open?a.hovered?.4:0:.8}).attr("d",function(b){return a.getPathForeground(b)}),a.selection.item.classed("d2b-active",a.active?!0:!1),a.selection.item.text=a.selection.item.select("text").style("font-size",2.5*a.scale+"px").attr("x",2*a.scale).attr("y",a.scale)},a.updatePositions=function(){var b=a.scale+a.padding,c=a.scale+a.padding,d=0,e=0;if(a.currentLegendData.items.length>0)if("vertical"==a.orientation)a.selection.item.transition().duration(a.animationDuration).style("opacity",1).attr("transform",function(f,g){var h="translate("+b+","+c+")";return c>e&&(e=c),c+=4*a.scale,d=Math.max(d,d3.select(this).select("text").node().getComputedTextLength()),c+a.scale>a.innerMaxHeight&&(c=a.scale+a.padding,b+=d+6*a.scale,d=0),h}),a.computedWidth=b+d+2*a.scale+a.padding,a.computedHeight=e+a.scale+a.padding;else{var d=0;a.selection.item.text.each(function(a){var b=this.getComputedTextLength();b>d&&(d=b)}),d+=6*a.scale;var f=Math.floor((a.innerMaxWidth+3*a.scale)/d);a.selection.item.transition().duration(a.animationDuration).style("opacity",1).attr("transform",function(e,g){
g%f==0&&g>0&&(b=a.scale+a.padding,c+=4*a.scale);var h="translate("+b+","+c+")";return b+=d,h}),a.computedHeight=c+a.scale+a.padding,a.computedWidth=a.selection.item.size()>f?d*f-3*a.scale+2*a.padding:d*a.selection.item.size()-3*a.scale+2*a.padding}},a.exitElements=function(){a.selection.item.exit().transition().duration(a.animationDuration).style("opacity",0).remove()};var b={};return b.select=d2b.UTILS.CHARTS.MEMBERS.select(b,a,function(){a.generateRequired=!0}),b.selection=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"selection",function(){a.generateRequired=!0}),b.width=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"maxWidth"),b.height=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"maxHeight"),b.animationDuration=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"animationDuration"),b.legendOrientation=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"legendOrientation"),b.on=d2b.UTILS.CHARTS.MEMBERS.events(b,a),b.color=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"color"),b.padding=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"padding"),b.scale=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"scale"),b.orientation=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"orientation"),b.active=d2b.UTILS.CHARTS.MEMBERS.prop(b,a,"active"),b.computedHeight=function(){return a.computedHeight},b.computedWidth=function(){return a.computedWidth},b.data=function(c,d){return arguments.length?(a.currentLegendData=c.data,a.currentLegendData.items.forEach(function(a){a.path=d2b.UTILS.symbol().type(a.symbol||"circle")}),b):a.currentLegendData},b.update=function(c){return a.selection?(a.enterElements(),a.updateElements(),a.updatePositions(),a.exitElements(),a.events.dispatch("update",a.selection),c&&c(),b):console.warn("legend was not given a selection")},b},d2b.UTILS.loader=function(){var a={};a.inProgress=0,a.files={},a.stack=[],a.flushStack=function(){if(0!=a.stack.length){var b=a.stack.shift(),c={};b.paths.forEach(function(b){c[b.key]=a.files[b.key]}),b.callback&&b.callback(c),a.flushStack()}};var b=function(c,d){return a.stack.push({callback:d,paths:c}),c.forEach(function(b){var c=b.file.split(".");b.key=b.key||b.file,b.path=b.path||"http://d2b.s3-website-us-west-2.amazonaws.com/",b.type=b.type||c[c.length-1],a.files[b.key]||(a.files[b.key]=!0,a.inProgress++,d3[b.type](b.path+b.file,function(c){a.inProgress--,a.files[b.key]=c,a.inProgress||a.flushStack()}))}),a.inProgress||a.flushStack(),b};return b},d2b.UTILS.load=new d2b.UTILS.loader,d2b.UTILS.bindTooltip=function(a,b,c,d){b?a.on("mouseover.d2b-mouseover-tooltip",function(a,e){var f="function"==typeof c?c.apply(this,arguments):c||a,g="function"==typeof b?b.apply(this,[f,e]):b,h="function"==typeof d?d.apply(this,arguments):d;d2b.UTILS.createTooltip(d3.select(this),g,h)}).on("mouseout.d2b-mouseout-tooltip",function(a,b){d2b.UTILS.removeTooltip()}):d2b.UTILS.unbindTooltip()},d2b.UTILS.unbindTooltip=function(a){d2b.UTILS.removeTooltip(),a.on("mouseover.d2b-mouseover-tooltip",null).on("mouseout.d2b-mouseout-tooltip",null).on("mousemove.d2b-mousemove-tooltip",null)},d2b.UTILS.createTooltip=function(a,b,c){c=c||"#555",d3.selectAll(".d2b-general-tooltip").remove();var d=d3.select("body"),e=d.append("div").attr("class","d2b-general-tooltip").html(b).style("background",c).style("border-color",d3.rgb(c).darker(1)).style("opacity",0);return e.transition().duration(50).style("opacity",1),e.call(d2b.UTILS.moveTooltip),a.on("mousemove.d2b-mousemove-tooltip",function(){e.transition().duration(50).ease("linear").call(d2b.UTILS.moveTooltip)}),e},d2b.UTILS.removeTooltip=function(){d3.selectAll(".d2b-general-tooltip").remove()},d2b.UTILS.moveTooltip=function(a){var b=d3.select("body"),c=15,d=d2b.UTILS.scrollOffset(),e=b.node().getBoundingClientRect().width,f=d.left+d3.event.clientX<e/2,g=a.node().getBoundingClientRect(),h=f?d.left+d3.event.clientX+c:d.left+d3.event.clientX-g.width-c,i=d.top+d3.event.clientY-g.height/2;a.each(function(a){elem=d3.select(this),elemUpdate=d3.transition(elem),elem.classed("d2b-general-tooltip-left",!f).classed("d2b-general-tooltip-right",f),elemUpdate.style("opacity",1).style("top",i+"px").style("left",h+"px")}),d3.timer.flush()};